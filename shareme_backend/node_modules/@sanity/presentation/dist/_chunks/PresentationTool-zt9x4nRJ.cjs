"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),o=require("sanity/router"),a=require("styled-components"),s=require("./index-UDMbkpVt.cjs"),c=require("sanity/structure"),l=require("./DisplayedDocumentBroadcaster-76msq6-g.cjs"),d=require("@sanity/icons"),u=require("@sanity/preview-url-secret/create-secret"),p=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),f=require("fast-deep-equal"),m=require("@sanity/preview-url-secret/define-preview-url"),v=require("suspend-react");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var x=g(a),w=g(f);let y;const b=new Uint8Array(16);function j(){if(!y&&(y="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(b)}const k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));var S={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function P(e,t,n){if(S.randomUUID&&!t&&!e)return S.randomUUID();const r=(e=e||{}).random||(e.rng||j)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]}(r)}const C=1e3,E=1e3,z=500,I=["handshake/syn","handshake/syn-ack","handshake/ack"],T=e=>I.some((t=>t===e)),R=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function D(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(T(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const o=t=>{var r,i,o;const{data:a}=t;if(!T(a.type)&&n.find((e=>e.id===a.connectionId))){const t=n.find((e=>e.config.id===a.from));if(t){const n=[a.type,a.data];null==(i=(r=t.config).onEvent)||i.call(r,...n),null==(o=e.onEvent)||o.call(e,...n),d(t,"channel/response",{responseTo:a.id},!1)}}};function a(t){var r;if(R(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;null==(r=n.find((t=>t.config.id===e.from)))||r.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){var a,c,u;t.status=n,null==(c=(a=t.config).onStatusUpdate)||c.call(a,n,t.config.id),null==(u=e.onStatusUpdate)||u.call(e,n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=P(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),z)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:E;e.heartbeat=window.setInterval((()=>{d(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{d(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:P(),to:n.config.id,type:r};try{null==t||t.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error("Failed to postMessage '".concat(o.id,"' on '").concat(e.id,"'"))}}function d(n,r,i,o=!0){const a=P();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn("Received no response to message '".concat(s.type,"' on client '").concat(e.id,"' (ID: '").concat(s.id,"').")))}),C),o=e=>{var n;const{data:r}=e;"channel/response"===r.type&&(null==(n=r.data)?void 0:n.responseTo)&&r.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{null==t||t.postMessage(s,{targetOrigin:e.targetOrigin})}catch(t){throw new Error("Failed to postMessage '".concat(s.id,"' on client '").concat(e.id,"'"))}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(d(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");d(i,t,r)}))}}}const L=/^([A-Za-z]+):([0-9]+)$/,O=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,M=/^([A-Za-z]+):([a-z0-9]+)$/;const U={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function F(e){return"Alt"===e.key}function B(e){var t;if(void 0===e)return;const n=null==(t=decodeURIComponent(e))?void 0:t.split(".");return"drafts"===n[0]&&n.shift(),n.join(".")}function W(e){if(void 0!==e)return t.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=L.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=O.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=M.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function A(t){const{children:r,message:i,onRetry:o,onContinueAnyway:a,...s}=t,c=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),l=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:a,text:"Continue anyway"});return e.jsx(n.Card,{height:"fill",...s,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,o&&a?e.jsxs(n.Inline,{space:2,children:[c,l]}):o?e.jsx(n.Box,{children:c}):a?e.jsx(n.Box,{children:l}):null]})})})})}function q(){const e=r.useContext(s.P);if(!e)throw new Error("Presentation context is missing");return e}function _(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>"".concat(e,"=").concat(t))).join("&");return t.length?"?".concat(t):""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const N=r.forwardRef((function(t,n){const{deskParams:r,params:i}=q();return e.jsx(o.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),K=r.forwardRef((function(t,n){const{documentId:r,documentType:i,parentRefPath:a,template:s,...c}=t;return e.jsx(o.StateLink,{...c,ref:n,state:{id:r,type:i},title:void 0})}));function V(t){const{children:n,params:a,onDeskParams:s,previewUrl:l,refs:d}=t,{state:u,resolvePathFromState:p}=o.useRouter(),h=i.useUnique(Object.fromEntries(u._searchParams||[])),f=r.useCallback((e=>{const t=p(u),n=_({...h,...e});return"".concat(t).concat(n)}),[p,h,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:a,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,a=null==d?void 0:d.find((e=>i.getPublishedId(e._id)===n));return a?e.jsx(o.StateLink,{...r,state:{id:a._id,type:a._type,_searchParams:Object.entries({preview:l})}}):e.jsx("div",{...r})},BackLink:N,ReferenceChildLink:K,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var t;s({...e,inspect:null!=(t=e.inspect)?t:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:f})),[f,s,a,l,d]);return e.jsx(c.PaneRouterContext.Provider,{value:m,children:n})}var $,G,J,H=Object.freeze,X=Object.defineProperty,Z=(e,t)=>H(X(e,"raw",{value:H(t||e.slice())}));const Q=x.default(c.PaneLayout)($||($=Z(["\n  height: 100%;\n"]))),Y=x.default(n.Flex)(G||(G=Z(["\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n"]))),ee=x.default(n.Code)(J||(J=Z(["\n  white-space: pre-wrap;\n"])));function te(t){const{onDeskParams:i,previewUrl:o,refs:a}=t,{devMode:s}=q(),l=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[d,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),[h]=r.useState((()=>({})));return r.useEffect((()=>u(null)),[a]),d?e.jsx(A,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(ee,{size:1,children:d.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(Q,{children:e.jsx(c.StructureToolProvider,{children:e.jsx(V,{params:h,onDeskParams:i,previewUrl:o,refs:a,children:e.jsx(Y,{direction:"column",flex:1,children:e.jsx(c.DocumentListPane,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}function ne(t){const{onDeskParams:n,previewUrl:i,refs:o}=t,a=r.useMemo((()=>o.map((({_id:e,_type:t})=>({_id:B(e),_type:t})))),[o]);return e.jsx(te,{onDeskParams:n,previewUrl:i,refs:a})}var re,ie=Object.freeze,oe=Object.defineProperty;const ae=x.default(n.Code)(re||(re=ie(oe(se=["\n  white-space: pre-wrap;\n"],"raw",{value:ie(ce||se.slice())}))));var se,ce;function le(t){const{documentId:i,documentType:o,params:a,onDeskParams:s,onFocusPath:l}=t,{devMode:d}=q(),u=r.useMemo((()=>({id:i,options:{id:i,type:o},title:"",type:"document"})),[i,o]),[p,h]=r.useState(null),f=r.useCallback((()=>h(null)),[]);r.useEffect((()=>{h(null)}),[i,o,a]);const{setLayoutCollapsed:m}=c.useStructureTool(),v=r.useCallback((()=>m(!0)),[m]),g=r.useCallback((()=>m(!1)),[m]);return p?e.jsx(A,{flex:1,message:"Could not render the document editor",onRetry:f,children:d&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(ae,{size:1,children:p.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:h,children:e.jsx(c.PaneLayout,{style:{height:"100%"},onExpand:g,onCollapse:v,children:e.jsx(V,{onDeskParams:s,params:a,children:e.jsx(c.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:l})})})})}function de(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}=t;return e.jsx(c.StructureToolProvider,{children:e.jsx(le,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:a})})}function ue(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,previewUrl:s,refs:c}=t;return r&&i?e.jsx(de,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}):e.jsx(ne,{onDeskParams:o,previewUrl:s,refs:c})}const pe=r.createContext(null);pe.displayName="PanelsContext";var he,fe=Object.freeze,me=Object.defineProperty;const ve=x.default.div(he||(he=((e,t)=>fe(me(e,"raw",{value:fe(t||e.slice())})))(["\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n"]))),ge=function({children:t,defaultSize:n=null,id:i,minWidth:o,maxWidth:a,order:s=0}){const c=r.useContext(pe);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:d,unregisterElement:u}=c,p=l(i);return r.useLayoutEffect((()=>(d(i,{id:i,type:"panel",defaultSize:n,maxWidth:null!=a?a:null,minWidth:null!=o?o:0,order:s}),()=>{u(i)})),[i,n,s,a,o,d,u]),e.jsx(ve,{style:p,children:t})};var xe,we,ye=Object.freeze,be=Object.defineProperty,je=(e,t)=>ye(be(e,"raw",{value:ye(t||e.slice())}));const ke=x.default.div(xe||(xe=je(["\n  position: relative;\n"]))),Se=x.default.div(we||(we=je(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ",";\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ","\n"])),(({$disabled:e})=>e?"auto":"ew-resize"),(({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  ")),Pe=function({id:t,order:n,disabled:i=!1}){const o=r.useRef(null),a=r.useContext(pe);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return r.useRef(e||P()).current}(t),{activeResizer:c,drag:l,startDragging:d,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{d(s,e.nativeEvent)}),[s,d]),v=r.useCallback((e=>{l(s,e)}),[s,l]),g=r.useCallback((()=>{o.current.blur(),u()}),[u]);return r.useEffect((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),r.useLayoutEffect((()=>(p(s,{id:s,order:n,type:"resizer",el:o}),()=>{h(s)})),[s,n,p,h]),e.jsx(ke,{onMouseDown:m,ref:o,children:e.jsxs(Se,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function Ce(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Ee="presentation/panels",ze=()=>JSON.parse(localStorage.getItem(Ee)||"{}"),Ie=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Te(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Ee,JSON.stringify(e))})({...ze(),[Ie(e)]:t})};return{get:e=>ze()[Ie(e)],set:e,setDebounced:Ce(e,100)}}),[])}function Re(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function De(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Le(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Oe(e){return"panel"===e.type}function Me(e){return"resizer"===e.type}function Ue(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function Fe(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Re(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}var Be,We=Object.freeze,Ae=Object.defineProperty;const qe=x.default.div(Be||(Be=((e,t)=>We(Ae(e,"raw",{value:We(t||e.slice())})))(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n"]))),_e=function({children:t}){const n=r.useRef(null),[i,o]=r.useState(new Map),a=r.useMemo((()=>Ue(i).filter(Oe)),[i]),[s,c]=r.useState([]),[l,d]=r.useState(null),u=r.useRef({elements:i,panels:a,widths:s}),p=r.useCallback((e=>({flexGrow:De(a,e,s),pointerEvents:null===l?void 0:"none"})),[l,a,s]),h=r.useCallback(((e,t)=>{o((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),f=r.useCallback((e=>{o((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=Ue(i),r=n.findIndex((t=>t.id===e)),o=i.get(e);if(!o||!Me(o))return;const a=o.el.current;a&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>Oe(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Oe(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Le(t,a),resizerRect:a.getBoundingClientRect(),widths:u.current.widths},d(e))}),[i]),g=r.useCallback((()=>{d(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:o,panelBefore:a,panelAfter:s,resizerRect:l}=m.current;if(null==a||null==s)return;const d=i.get(e);if(!d||!Me(d))return;const p=d.el.current;if(!p)return;const h=Le(t,p,o,l);if(0===h)return;const{widths:f}=u.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,l=c||s,d=[...l];{const i=e<0?r:n,o=l[a.findIndex((e=>e.id===i.id))],s=Re(i,o+Math.abs(e),t);if(o===s)return l;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,h=a.findIndex((e=>e.id===p.id));for(;;){const n=a[h],r=l[h],i=Re(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,d[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?l:(p=e<0?r:n,h=a.findIndex((e=>e.id===p.id)),d[h]=l[h]+u,d)}(h/n.current.getBoundingClientRect().width*100,r,a,s,u.current,m.current),g=f.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=a,u.current.widths=s}),[i,a,s]);const w=Te();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===a.length)return;const t=w.get(a);if(t){const e=Fe(a,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(a);c(n)}),[w,a]),r.useEffect((()=>{s.length&&w.setDebounced(a,s)}),[w,a,s]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=Fe(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=r.useMemo((()=>({activeResizer:l,drag:x,getPanelStyle:p,registerElement:h,startDragging:v,stopDragging:g,unregisterElement:f})),[l,x,p,h,v,g,f]);return e.jsx(pe.Provider,{value:y,children:e.jsx(qe,{ref:n,children:t})})},Ne=function(t){const{children:n,navigate:i}=t,o=r.useCallback(((e,t=void 0)=>{i(t||{},e?{preview:e}:{})}),[i]);return e.jsx(s.a.Provider,{value:o,children:n})};function Ke(t){const{unstable_navigator:n}=t,i=!!(null==n?void 0:n.component),[o,a]=function(e,t){const[n,i]=r.useState((()=>{var n;return JSON.parse(null!=(n=localStorage.getItem(e))?n:JSON.stringify(t))}));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",i),s=!!i&&o,c=r.useMemo((()=>{if(i)return()=>a((e=>!e))}),[i,a]),l=r.useCallback((function(){return e.jsx(e.Fragment,{children:s&&e.jsx(Ve,{...n})})}),[s,n]);return[{navigatorEnabled:s,toggleNavigator:c},l]}const Ve=r.memo((function(t){const{minWidth:n,maxWidth:r,component:i}=t,o=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(ge,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(Pe,{order:2,disabled:o})]})})),$e=function(t){const{children:n,params:i}=t,o=r.useMemo((()=>i),[i]);return e.jsx(s.b.Provider,{value:o,children:n})},Ge=function(t){const{children:n,deskParams:i,devMode:o,name:a,navigate:c,params:l}=t,d=r.useMemo((()=>({deskParams:i,devMode:o,name:a,navigate:c,params:l})),[i,o,a,c,l]);return e.jsx(s.P.Provider,{value:d,children:n})};var Je,He=Object.freeze,Xe=Object.defineProperty;const Ze=h.motion(x.default.iframe(Je||(Je=((e,t)=>He(Xe(e,"raw",{value:He(t||e.slice())})))(["\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n"])))),Qe=function(t){var o;const{basePath:a="/"}=(null==(o=i.useActiveWorkspace())?void 0:o.activeWorkspace)||{},{fontSize:s=1,onChange:c,origin:l,padding:u=3,value:p}=t,h=r.useRef(null),[f,m]=r.useState(void 0),[v,g]=r.useState(void 0),x=r.useCallback((e=>{m(e.currentTarget.value)}),[]),w=r.useCallback((e=>{var t;if("Enter"===e.key){if(void 0===f)return;const e=f.startsWith("/")||""===f?"".concat(l).concat(f):f;if(!e.startsWith(l+"/")&&e!==l)return void g("URL must start with ".concat(l));if(!l&&(e.startsWith("".concat(a,"/"))||e===a))return void g("URL can't have the same base path as the Studio ".concat(a));const n=e===l?l+"/":e;g(void 0),m(void 0),c(n.slice(l.length)),null==(t=h.current)||t.blur()}"Escape"===e.key&&(g(void 0),m(void 0))}),[a,c,l,f]),y=r.useCallback((()=>{g(void 0),m(void 0)}),[]);r.useEffect((()=>{g(void 0),m(void 0)}),[l,p]);const b=r.useMemo((()=>({icon:d.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:v?b:void 0,customValidity:v,fontSize:s,onBlur:y,onClear:()=>{g(void 0),m(l+p)},onChange:x,onKeyDownCapture:w,padding:u,style:{zIndex:1},radius:2,ref:h,space:u,value:void 0===f?"".concat(l).concat(p):f})})};var Ye,et=Object.freeze,tt=Object.defineProperty;const nt=h.motion(n.Flex),rt=x.default(n.Switch)(Ye||(Ye=((e,t)=>et(tt(e,"raw",{value:et(t||e.slice())})))(["\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n"]))),it={previewDrafts:"Drafts",published:"Published",raw:"Raw"},ot="caution",at="positive",st={previewDrafts:d.EditIcon,published:d.PublishIcon,raw:d.DatabaseIcon},ct=r.forwardRef((function(t,o){const{initialUrl:a,targetOrigin:c,navigatorEnabled:l,onPathChange:u,openPopup:f,overlayEnabled:m,params:v,perspective:g,setPerspective:x,toggleNavigator:w,toggleOverlay:y,loadersConnection:b,overlaysConnection:j,previewKitConnection:k}=t,{devMode:S}=q(),[P,C]=r.useState("desktop"),E=n.usePrefersReducedMotion(),z=r.useCallback((()=>C("desktop")),[C]),I=r.useCallback((()=>C("mobile")),[C]),[T,R]=r.useState(!0),[D,L]=r.useState(!1),[O,M]=r.useState(!1),[U,F]=r.useState(!1),B=T||O||"connecting"===j,W=r.useMemo((()=>c===location.origin?"":c),[c]),_=r.useCallback((()=>{"function"!=typeof o&&(null==o?void 0:o.current)&&(o.current.src="".concat(c).concat(v.preview||"/"),M(!0))}),[v.preview,c,o]),N=r.useCallback((()=>{"function"!=typeof o&&(null==o?void 0:o.current)&&(o.current.src=a.toString(),M(!0))}),[o,a]),K=r.useCallback((()=>{$(!0)}),[]),[V,$]=r.useState(!1),[G,J]=r.useState(!1);r.useEffect((()=>{if(!(T||O||"connecting"!==j&&"reconnecting"!==j)){const e=setTimeout((()=>{J(!0)}),1e3);return()=>clearTimeout(e)}}),[j,T,O,J]),r.useEffect((()=>{if(!T&&!O&&G){if("connected"===j&&(F(!1),J(!1),L(!1),$(!1)),"connecting"===j){const e=setTimeout((()=>{L(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),s.M);return()=>clearTimeout(e)}if("reconnecting"===j){const e=setTimeout((()=>{L(!0),F(!0)}),s.M);return()=>clearTimeout(e)}"disconnected"===j&&F(!0)}}),[T,j,O,G]);const H=r.useMemo((()=>{const e=new URL(v.preview||"/",c),{pathname:t,search:n}=p.withoutSecretSearchParams(e);return"".concat(t).concat(n)}),[v.preview,c]),X=r.useCallback((()=>{R(!1),M(!1)}),[]);return e.jsx(h.MotionConfig,{transition:E?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[w&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:d.PanelLeftIcon,mode:"bleed",onClick:w,padding:3,selected:l})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsxs(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:m?"Disable edit overlay":"Enable edit overlay"})}),e.jsx(n.Box,{paddingY:1,children:e.jsx(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:m?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(rt,{checked:m,onChange:y,disabled:B})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),S&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:O?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:d.RefreshIcon,mode:"bleed",loading:O,onClick:_,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(Qe,{onChange:u,origin:W,value:H})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:d.ShareIcon,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e.jsx(n.Menu,{children:e.jsx(ht,{initialUrl:a,openPopup:f,previewLocationOrigin:W,previewLocationRoute:H})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:d.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:it[g],loading:B||"connecting"===b&&"connected"!==k,disabled:"connected"!==b}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("previewDrafts"),padding:3,pressed:"previewDrafts"===g,tone:ot,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(st.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:it.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===g?1:0},children:e.jsx(d.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("published"),padding:3,pressed:"published"===g,tone:at,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(st.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:it.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===g?1:0},children:e.jsx(d.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:d.DesktopIcon,mode:"bleed",onClick:z,padding:3,selected:"desktop"===P})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:d.MobileDeviceIcon,mode:"bleed",onClick:I,padding:3,selected:"mobile"===P})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===P?0:2,sizing:"border",style:{position:"relative",cursor:B?"wait":void 0},children:[e.jsx(h.AnimatePresence,{children:U||T||O||!G||V?!T&&!B||V?U&&!V?e.jsx(nt,{initial:"initial",animate:"animate",exit:"exit",variants:ut,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e.jsx(A,{flex:1,message:"Could not connect to the preview",onRetry:N,onContinueAnyway:K,children:S&&e.jsxs(e.Fragment,{children:["connected"!==j&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:j})]})}),"connected"!==b&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:b})]})})]})})}):null:e.jsx(nt,{initial:"initial",animate:"animate",exit:"exit",variants:dt,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...lt[P]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):e.jsx(nt,{initial:"initial",animate:"animate",exit:"exit",variants:dt,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...lt[P]},justify:"center",align:"center",direction:"column",gap:4,children:[D&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:D?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:D?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),D&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:K,text:"Continue anyway"})]})})}),e.jsx(Ze,{ref:o,style:{pointerEvents:B&&!V?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:a.toString(),initial:["background"],variants:pt,animate:[!T&&!B||V?"active":"background",O?"reloading":"idle",P,G&&!V?"timedOut":""],onLoad:X})]})})]})})})),lt={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},dt={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},ut={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},pt={desktop:{...lt.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...lt.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function ht(t){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=t,c=r.useCallback((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return e.jsxs(e.Fragment,{children:[e.jsx(ft,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e.jsx(n.MenuItem,{icon:d.LaunchIcon,text:"Open preview",as:"a",href:"".concat(a).concat(s),onClick:c,rel:"opener",target:"_blank"})]})}function ft(t){const{initialUrl:o,previewLocationOrigin:a,previewLocationRoute:c}=t,{push:l}=n.useToast(),h=i.useClient({apiVersion:s.A}),f=i.useCurrentUser(),[m,v]=r.useState(!1);return e.jsx(n.MenuItem,{disabled:m,onClick:()=>{if(!(null==navigator?void 0:navigator.clipboard))return l({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;v(!0);let t="".concat(a).concat(c);const n=()=>{l({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),v(!1)},r=e=>{l({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),v(!1)};if(p.hasSecretSearchParams(o)&&"undefined"!=typeof ClipboardItem){const i="text/plain",a=new ClipboardItem({[i]:(async()=>{e=l({closable:!0,title:"Copying URL to clipboard…"});const n=await u.createPreviewSecret(h,"@sanity/presentation","undefined"==typeof window?"":location.href,null==f?void 0:f.id),r=p.setSecretSearchParams(o,n.secret,c);return t=r.toString(),new Blob([t],{type:i})})()});navigator.clipboard.write([a]).then(n).catch(r)}else navigator.clipboard.writeText(t).then(n).catch(r)},text:"Copy link",icon:d.CopyIcon})}let mt=!1;function vt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function gt({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:i,previewRef:o}){const a=r.useMemo((()=>{const{id:t,path:r,type:o}={id:B((a=n).id),path:W(a.path),type:a.type};var a;return{id:t,type:o,path:r,preview:i.preview||"".concat(e.pathname).concat(e.search),perspective:i.perspective,inspect:i.inspect,rev:i.rev,since:i.since,template:i.template,view:i.view,pathKey:i.pathKey,instruction:i.instruction,comment:i.comment}}),[n,i,e]),s=r.useMemo((()=>vt({inspect:a.inspect,path:a.path,rev:a.rev,since:a.since,template:a.template,view:a.view,pathKey:a.pathKey,instruction:a.instruction,comment:a.comment})),[a.inspect,a.path,a.rev,a.since,a.template,a.view,a.pathKey,a.instruction,a.comment]),c=r.useRef(n);r.useEffect((()=>{c.current=n}),[n]);return{deskParams:s,navigate:r.useMemo((()=>Ce(((e,n={},r)=>{const{_searchParams:i,...a}=c.current,s=(i||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),l=vt({...a,...e}),d=vt({...s,...n});l._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const u=null!=r?r:d.preview===o.current;t(l,{replace:u})}),50)),[t,o]),params:a}}function xt(e,t,n){var o,a;const c=i.useClient({apiVersion:s.A}),l=i.useActiveWorkspace(),d=(null==(o=null==l?void 0:l.activeWorkspace)?void 0:o.basePath)||"/",p=(null==(a=null==l?void 0:l.activeWorkspace)?void 0:a.name)||"default",h=function(e,t,n){const o=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,null==o?void 0:o.id,wt]),[t,null==o?void 0:o.id,e,n])}(t,d,p),f=function(e,t){const n=i.useClient({apiVersion:s.A}),o=i.useCurrentUser(),[a,c]=r.useState(""),l=e?v.suspend((async()=>await u.createPreviewSecret(n,"@sanity/presentation","undefined"==typeof window?"":location.href,null==o?void 0:o.id)),[...t,a]):null;return r.useEffect((()=>{if(!l)return;const e=setTimeout((()=>{r.startTransition((()=>c(l.expiresAt.toString())))}),l.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[l]),(null==l?void 0:l.secret)||null}("object"==typeof e||"function"==typeof e,h);return v.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith("".concat(d,"/"))&&r.pathname!==d?r:t}const t="object"==typeof e?m.definePreviewUrl(e):e,r=await t({client:c,previewUrlSecret:f,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:d});return new URL(r,location.origin)}),[...h,f])}const wt=Symbol();var yt,bt=Object.freeze,jt=Object.defineProperty;const kt=r.lazy((()=>Promise.resolve().then((function(){return require("./LoaderQueries-pL7WW0DQ.cjs")})))),St=r.lazy((()=>Promise.resolve().then((function(){return require("./RevalidateTags-hpKL66Lo.cjs")})))),Pt=x.default(n.Flex)(yt||(yt=((e,t)=>bt(jt(e,"raw",{value:bt(t||e.slice())})))(["\n  overflow-x: auto;\n"])));exports.default=function(a){var c;const{previewUrl:d,components:u,unstable_emitExperimentalRevalidateTagsLoaderEvent:p}=null!=(c=a.tool.options)?c:{},h=a.tool.name||s.D,{unstable_navigator:f}=u||{},{navigate:m,state:v}=o.useRouter(),g=i.useUnique(Object.fromEntries(v._searchParams||[])),x=xt(d||"/",h,g.preview||null),[y]=r.useState((()=>{var e;const t=null==(e=a.tool.options)?void 0:e.devMode;return"function"==typeof t?t():"boolean"==typeof t?t:"undefined"!=typeof window&&"localhost"===window.location.hostname})),b=r.useMemo((()=>x.origin),[x.origin]),j=r.useRef(null),[k,S]=r.useState(),[P,C]=r.useState({}),E=r.useRef(),{params:z,deskParams:I,navigate:T}=gt({initialPreviewUrl:x,routerNavigate:m,routerState:v,routerSearchParams:g,previewRef:E}),[R,L]=r.useState((()=>"published"===z.perspective?z.perspective:"previewDrafts")),[O,M]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error("Invalid perspective: ".concat(e));const[t,n]=r.useState({}),[i,o]=r.useState({}),a=r.useCallback(((e,t)=>{const r=t.filter((e=>"_projectId"in e&&e._projectId?(mt||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),mt=!0),!1):e));("published"===e?n:o)((e=>{const t={};for(const e of r)t[e._id]=e;return w.default(e,t)?e:t}))}),[]);return[r.useMemo((()=>"published"===e?[...Object.values(t)]:[...Object.values(i)]),[e,i,t]),a]}(R),[B,W]=r.useState(!0),A=i.useProjectId(),q=i.useDataset();r.useEffect((()=>{R!==z.perspective&&T({},{perspective:"published"===R?"published":void 0})}),[z.perspective,R,T]);const[_,N]=r.useState("connecting"),[K,V]=r.useState("connecting"),[$,G]=r.useState("connecting"),[J]=r.useState((()=>new Set)),H=r.useCallback((e=>{const t=window.open(e,"_blank");t&&J.add(t)}),[J]);r.useEffect((()=>{if(J.size&&k)for(const e of J)e&&"closed"in e&&!e.closed&&k.addSource(e)}),[k,J,J.size]),r.useEffect((()=>{var e;const t=null==(e=j.current)?void 0:e.contentWindow;if(!t)return;const n=function(e){const{destroy:t,send:n}=D(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=D({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:t,targetOrigin:b,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:N,onEvent(e,t){if("overlay/focus"===e&&"id"in t)T({type:t.type,id:t.id,path:t.path});else if("overlay/navigate"===e){if(E.current!==t.url){const e=void 0===E.current;E.current=t.url,T(e?{}:{id:void 0,type:void 0},{preview:t.url})}}else"overlay/toggle"===e&&W(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:V,onEvent(e,t){if("loader/documents"===e&&t.projectId===A&&t.dataset===q)M(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===A&&t.dataset===q){if("number"==typeof t.heartbeat&&t.heartbeat<s.c)throw new Error("Loader query listen heartbeat interval must be at least ".concat(s.c,"ms"));C((e=>{var n,r,i;return{...e,[(r=t.query,i=t.params,"".concat(r,"-").concat("string"==typeof i?i:JSON.stringify(i)))]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:null!=(n=t.heartbeat)&&n}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:G,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===A&&t.dataset===q&&M(t.perspective,t.documents)}}]});return S(n),()=>{n.destroy(),S(void 0)}}),[q,A,M,T,b]),r.useEffect((()=>{const e=setInterval((()=>r.startTransition((()=>C((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),s.c);return()=>clearInterval(e)}),[]);const X=r.useCallback((e=>{T({path:t.studioPath.toString(e)},{},!0)}),[T]),Z=r.useCallback((e=>{const t=new URL(e,x.origin),n=t.pathname+t.search;t.origin===x.origin&&n!==z.preview&&T({id:void 0,path:void 0},{preview:n})}),[x,z,T]),Q=r.useCallback((e=>{T({},e)}),[T]);r.useEffect((()=>{z.id&&z.path?null==k||k.send("overlays","presentation/focus",{id:z.id,path:z.path}):null==k||k.send("overlays","presentation/blur",void 0)}),[k,z.id,z.path]),r.useEffect((()=>{E.current&&z.preview&&E.current!==z.preview&&(E.current=z.preview,"connected"!==_&&j.current?j.current.src="".concat(b).concat(z.preview):null==k||k.send("overlays","presentation/navigate",{url:z.preview,type:"replace"}))}),[k,_,b,z.preview]);const Y=r.useCallback((()=>null==k?void 0:k.send("overlays","presentation/toggleOverlay",void 0)),[k]),[ee,te]=r.useState(null);r.useEffect((()=>{const e=e=>{F(e)&&Y()},t=e=>{var t;F(e)&&Y(),t=e,["mod","\\"].every((e=>U[e]?t[U[e]]:t.key===e.toUpperCase()))&&Y()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Y]);const[ne,re]=r.useState(null),[{navigatorEnabled:ie,toggleNavigator:oe},ae]=Ke({unstable_navigator:f}),se=r.useRef(z.id);return r.useEffect((()=>{z.rev&&se.current&&z.id!==se.current&&T({},{rev:void 0}),se.current=z.id})),e.jsxs(e.Fragment,{children:[e.jsx(Ge,{deskParams:I,devMode:y,name:h,params:z,navigate:T,children:e.jsx(Ne,{navigate:T,children:e.jsx($e,{params:z,children:e.jsx(Pt,{height:"fill",children:e.jsxs(_e,{children:[e.jsx(ae,{}),e.jsx(ge,{id:"preview",minWidth:325,defaultSize:ie?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",ref:re,children:e.jsx(n.BoundaryElementProvider,{element:ne,children:e.jsx(ct,{initialUrl:x,navigatorEnabled:ie,onPathChange:Z,openPopup:H,overlayEnabled:B,params:z,perspective:R,ref:j,setPerspective:L,targetOrigin:b,toggleNavigator:oe,toggleOverlay:Y,loadersConnection:K,overlaysConnection:_,previewKitConnection:$})})})}),e.jsx(Pe,{order:4}),e.jsx(ge,{id:"content",minWidth:325,order:5,children:e.jsx(l.D,{documentId:z.id,setDisplayedDocument:te,children:e.jsx(ue,{refs:O,deskParams:I,documentId:z.id,documentType:z.type,onDeskParams:Q,onFocusPath:X,previewUrl:z.preview})})})]})})})})}),k&&e.jsx(r.Suspense,{children:e.jsx(kt,{channel:k,liveQueries:P,perspective:R,liveDocument:ee,documentsOnPage:O})}),p&&k&&e.jsx(r.Suspense,{children:e.jsx(St,{channel:k})})]})};//# sourceMappingURL=PresentationTool-zt9x4nRJ.cjs.map
