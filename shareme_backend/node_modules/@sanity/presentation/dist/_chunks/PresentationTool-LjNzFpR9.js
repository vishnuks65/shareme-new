import{jsx as e,jsxs as n,Fragment as t}from"react/jsx-runtime";import{studioPath as r}from"@sanity/client/csm";import{Card as i,Flex as o,Container as a,Stack as c,Text as s,Inline as d,Box as l,Button as u,Code as p,Label as h,ErrorBoundary as f,TextInput as m,Switch as v,usePrefersReducedMotion as g,TooltipDelayGroupProvider as w,Tooltip as y,MenuButton as b,Menu as x,MenuItem as k,Spinner as P,useToast as z,BoundaryElementProvider as S}from"@sanity/ui";import{useContext as E,forwardRef as C,useCallback as O,useMemo as I,useState as j,useEffect as D,createContext as U,useLayoutEffect as R,useRef as L,memo as T,createElement as W,startTransition as M,Suspense as A,lazy as _}from"react";import{useUnique as N,getPublishedId as F,useActiveWorkspace as K,Hotkeys as B,useClient as V,useCurrentUser as $,useProjectId as q,useDataset as J}from"sanity";import{StateLink as G,useRouter as X}from"sanity/router";import H from"styled-components";import{P as Z,a as Q,b as Y,M as ee,A as ne,c as te,D as re}from"./index-ykAxZvMU.js";import{PaneRouterContext as ie,PaneLayout as oe,StructureToolProvider as ae,DocumentListPane as ce,useStructureTool as se,DocumentPane as de}from"sanity/structure";import{D as le}from"./DisplayedDocumentBroadcaster-VVQiO-FG.js";import{ResetIcon as ue,PanelLeftIcon as pe,RefreshIcon as he,ShareIcon as fe,ChevronDownIcon as me,CheckmarkIcon as ve,DesktopIcon as ge,MobileDeviceIcon as we,LaunchIcon as ye,CopyIcon as be,EditIcon as xe,PublishIcon as ke,DatabaseIcon as Pe}from"@sanity/icons";import{createPreviewSecret as ze}from"@sanity/preview-url-secret/create-secret";import{withoutSecretSearchParams as Se,hasSecretSearchParams as Ee,setSecretSearchParams as Ce}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as Oe,MotionConfig as Ie,AnimatePresence as je}from"framer-motion";import De from"fast-deep-equal";import{definePreviewUrl as Ue}from"@sanity/preview-url-secret/define-preview-url";import{suspend as Re}from"suspend-react";let Le;const Te=new Uint8Array(16);function We(){if(!Le&&(Le="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Le))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Le(Te)}const Me=[];for(let e=0;e<256;++e)Me.push((e+256).toString(16).slice(1));var Ae={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function _e(e,n,t){if(Ae.randomUUID&&!n&&!e)return Ae.randomUUID();const r=(e=e||{}).random||(e.rng||We)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){t=t||0;for(let e=0;e<16;++e)n[t+e]=r[e];return n}return function(e,n=0){return Me[e[n+0]]+Me[e[n+1]]+Me[e[n+2]]+Me[e[n+3]]+"-"+Me[e[n+4]]+Me[e[n+5]]+"-"+Me[e[n+6]]+Me[e[n+7]]+"-"+Me[e[n+8]]+Me[e[n+9]]+"-"+Me[e[n+10]]+Me[e[n+11]]+Me[e[n+12]]+Me[e[n+13]]+Me[e[n+14]]+Me[e[n+15]]}(r)}const Ne=1e3,Fe=1e3,Ke=500,Be=["handshake/syn","handshake/syn-ack","handshake/ack"],Ve=e=>Be.some((n=>n===e)),$e=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((n=>n in e))&&e.type.startsWith("handshake/");function qe(e){const n=e.target,t=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:n}=e;if(Ve(n.type)){const e=t.find((e=>e.config.id===n.from));e&&"handshake/syn-ack"===n.type&&(s(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=n=>{var r,i,o;const{data:a}=n;if(!Ve(a.type)&&t.find((e=>e.id===a.connectionId))){const n=t.find((e=>e.config.id===a.from));if(n){const t=[a.type,a.data];null==(i=(r=n.config).onEvent)||i.call(r,...t),null==(o=e.onEvent)||o.call(e,...t),l(n,"channel/response",{responseTo:a.id},!1)}}};function a(n){var r;if($e(n))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(n){const{data:r,origin:i}=n;return"sanity/channels"===r.domain&&r.to==e.id&&t.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(n)){const{data:e}=n;null==(r=t.find((n=>n.config.id===e.from)))||r.handler(n)}}function c(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function s(n,t){var a,s,u;n.status=t,null==(s=(a=n.config).onStatusUpdate)||s.call(a,t,n.config.id),null==(u=e.onStatusUpdate)||u.call(e,t,n.config.id),"connecting"===t||"reconnecting"===t?(n.handler=i,c(n),function(e){e.id=_e(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),Ke)}(n)):"connected"===t?(n.handler=o,r(n),function(e){if(c(e),e.config.heartbeat){const n="number"==typeof e.config.heartbeat?e.config.heartbeat:Fe;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),n)}}(n),function(e){const n=[...e.buffer];e.buffer.splice(0,e.buffer.length),n.forEach((({type:n,data:t})=>{l(e,n,t)}))}(n)):"disconnected"===t&&(n.id=null,n.handler=i,r(n),c(n))}function d(t,r,i){if(!t.id)throw new Error("No channel ID set");const o={connectionId:t.id,data:i,domain:"sanity/channels",from:e.id,id:_e(),to:t.config.id,type:r};try{null==n||n.postMessage(o,{targetOrigin:"*"})}catch(n){throw new Error("Failed to postMessage '".concat(o.id,"' on '").concat(e.id,"'"))}}function l(t,r,i,o=!0){const a=_e();if("connecting"===t.status||"reconnecting"===t.status||"disconnected"===t.status)return void t.buffer.push({type:r,data:i});if(!t.id)throw new Error("No channel ID set");const c={connectionId:t.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:t.config.id,type:r};if(o){const n=setTimeout((()=>{c.connectionId===t.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&t.buffer.push({type:r,data:i}),s(t,"reconnecting"),console.warn("Received no response to message '".concat(c.type,"' on client '").concat(e.id,"' (ID: '").concat(c.id,"').")))}),Ne),o=e=>{var t;const{data:r}=e;"channel/response"===r.type&&(null==(t=r.data)?void 0:t.responseTo)&&r.data.responseTo===c.id&&(window.removeEventListener("message",o,!1),clearTimeout(n))};window.addEventListener("message",o,!1)}try{null==n||n.postMessage(c,{targetOrigin:e.targetOrigin})}catch(n){throw new Error("Failed to postMessage '".concat(c.id,"' on client '").concat(e.id,"'"))}}return window.addEventListener("message",a,!1),t.forEach((e=>{s(e,"connecting")})),{destroy:function(){t.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),s(e,"disconnected"))})),window.removeEventListener("message",a,!1),t.forEach((e=>{c(e),r(e)}))},send:function(e,n,r){(e?Array.isArray(e)?[...e]:[e]:t).forEach((e=>{const i=t.find((n=>n.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,n,r)}))}}}const Je=/^([A-Za-z]+):([0-9]+)$/,Ge=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,Xe=/^([A-Za-z]+):([a-z0-9]+)$/;const He={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Ze(e){return"Alt"===e.key}function Qe(e){var n;if(void 0===e)return;const t=null==(n=decodeURIComponent(e))?void 0:n.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function Ye(e){if(void 0!==e)return r.toString(function(e){const n=[];for(const t of e.split(".")){const e=Je.exec(t);if(e){n.push(e[1],Number(e[2]));continue}const r=Ge.exec(t);if(r){n.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=Xe.exec(t);i?n.push(i[1],{_key:i[2]}):n.push(t)}return n}(decodeURIComponent(e)))}function en(t){const{children:r,message:p,onRetry:h,onContinueAnyway:f,...m}=t,v=e(u,{fontSize:1,mode:"ghost",onClick:h,text:"Retry"}),g=e(u,{fontSize:1,mode:"ghost",tone:"critical",onClick:f,text:"Continue anyway"});return e(i,{height:"fill",...m,children:e(o,{align:"center",height:"fill",justify:"center",children:e(a,{padding:4,sizing:"border",width:0,children:n(c,{space:4,children:[n(c,{space:3,children:[e(s,{size:1,weight:"semibold",children:"An error occured"}),e(s,{muted:!0,size:1,children:p})]}),r,h&&f?n(d,{space:2,children:[v,g]}):h?e(l,{children:v}):f?e(l,{children:g}):null]})})})})}function nn(){const e=E(Z);if(!e)throw new Error("Presentation context is missing");return e}function tn(e){const n=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const n=Object.entries(e).map((([e,n])=>"".concat(e,"=").concat(n))).join("&");return n.length?"?".concat(n):""}(Object.entries(e).filter((([e])=>n.includes(e))).reduce(((e,[n,t])=>null==t?e:{...e,[n]:t}),{}))}const rn=C((function(n,t){const{deskParams:r,params:i}=nn();return e(G,{...n,ref:t,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),on=C((function(n,t){const{documentId:r,documentType:i,parentRefPath:o,template:a,...c}=n;return e(G,{...c,ref:t,state:{id:r,type:i},title:void 0})}));function an(n){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:c}=n,{state:s,resolvePathFromState:d}=X(),l=N(Object.fromEntries(s._searchParams||[])),u=O((e=>{const n=d(s),t=tn({...l,...e});return"".concat(n).concat(t)}),[d,l,s]),p=I((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:n=>{const{childId:t,...r}=n,i=null==c?void 0:c.find((e=>F(e._id)===t));return i?e(G,{...r,state:{id:i._id,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:rn,ReferenceChildLink:on,ParameterizedLink:()=>e(t,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var n;o({...e,inspect:null!=(n=e.inspect)?n:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,n,t)=>{console.warn("navigateIntent",e,n,t)},createPathWithParams:u})),[u,o,i,a,c]);return e(ie.Provider,{value:p,children:r})}var cn,sn,dn,ln=Object.freeze,un=Object.defineProperty,pn=(e,n)=>ln(un(e,"raw",{value:ln(n||e.slice())}));const hn=H(oe)(cn||(cn=pn(["\n  height: 100%;\n"]))),fn=H(o)(sn||(sn=pn(["\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n"]))),mn=H(p)(dn||(dn=pn(["\n  white-space: pre-wrap;\n"])));function vn(t){const{onDeskParams:r,previewUrl:o,refs:a}=t,{devMode:s}=nn(),d=I((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[l,u]=j(null),p=O((()=>u(null)),[]),[m]=j((()=>({})));return D((()=>u(null)),[a]),l?e(en,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e(i,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(mn,{size:1,children:l.error.message})]})})}):e(f,{onCatch:u,children:e(hn,{children:e(ae,{children:e(an,{params:m,onDeskParams:r,previewUrl:o,refs:a,children:e(fn,{direction:"column",flex:1,children:e(ce,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}function gn(n){const{onDeskParams:t,previewUrl:r,refs:i}=n,o=I((()=>i.map((({_id:e,_type:n})=>({_id:Qe(e),_type:n})))),[i]);return e(vn,{onDeskParams:t,previewUrl:r,refs:o})}var wn,yn=Object.freeze,bn=Object.defineProperty;const xn=H(p)(wn||(wn=yn(bn(kn=["\n  white-space: pre-wrap;\n"],"raw",{value:yn(Pn||kn.slice())}))));var kn,Pn;function zn(t){const{documentId:r,documentType:o,params:a,onDeskParams:s,onFocusPath:d}=t,{devMode:l}=nn(),u=I((()=>({id:r,options:{id:r,type:o},title:"",type:"document"})),[r,o]),[p,m]=j(null),v=O((()=>m(null)),[]);D((()=>{m(null)}),[r,o,a]);const{setLayoutCollapsed:g}=se(),w=O((()=>g(!0)),[g]),y=O((()=>g(!1)),[g]);return p?e(en,{flex:1,message:"Could not render the document editor",onRetry:v,children:l&&e(i,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(xn,{size:1,children:p.error.message})]})})}):e(f,{onCatch:m,children:e(oe,{style:{height:"100%"},onExpand:y,onCollapse:w,children:e(an,{onDeskParams:s,params:a,children:e(de,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:d})})})})}function Sn(n){const{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}=n;return e(ae,{children:e(zn,{documentId:r,documentType:i,params:t,onDeskParams:o,onFocusPath:a})})}function En(n){const{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,previewUrl:c,refs:s}=n;return r&&i?e(Sn,{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}):e(gn,{onDeskParams:o,previewUrl:c,refs:s})}const Cn=U(null);Cn.displayName="PanelsContext";var On,In=Object.freeze,jn=Object.defineProperty;const Dn=H.div(On||(On=((e,n)=>In(jn(e,"raw",{value:In(n||e.slice())})))(["\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n"]))),Un=function({children:n,defaultSize:t=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const c=E(Cn);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:s,registerElement:d,unregisterElement:l}=c,u=s(r);return R((()=>(d(r,{id:r,type:"panel",defaultSize:t,maxWidth:null!=o?o:null,minWidth:null!=i?i:0,order:a}),()=>{l(r)})),[r,t,a,o,i,d,l]),e(Dn,{style:u,children:n})};var Rn,Ln,Tn=Object.freeze,Wn=Object.defineProperty,Mn=(e,n)=>Tn(Wn(e,"raw",{value:Tn(n||e.slice())}));const An=H.div(Rn||(Rn=Mn(["\n  position: relative;\n"]))),_n=H.div(Ln||(Ln=Mn(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ",";\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ","\n"])),(({$disabled:e})=>e?"auto":"ew-resize"),(({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  ")),Nn=function({id:t,order:r,disabled:i=!1}){const o=L(null),a=E(Cn);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const c=function(e){return L(e||_e()).current}(t),{activeResizer:s,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=s===c;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=O((e=>{l(c,e.nativeEvent)}),[c,l]),v=O((e=>{d(c,e)}),[c,d]),g=O((()=>{o.current.blur(),u()}),[u]);return D((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),R((()=>(p(c,{id:c,order:r,type:"resizer",el:o}),()=>{h(c)})),[c,r,p,h]),e(An,{onMouseDown:m,ref:o,children:n(_n,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function Fn(e,n){let t;return(...r)=>{clearTimeout(t),t=setTimeout((()=>{e.apply(e,r)}),n)}}const Kn="presentation/panels",Bn=()=>JSON.parse(localStorage.getItem(Kn)||"{}"),Vn=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function $n(){return I((()=>{const e=(e,n)=>{(e=>{localStorage.setItem(Kn,JSON.stringify(e))})({...Bn(),[Vn(e)]:n})};return{get:e=>Bn()[Vn(e)],set:e,setDebounced:Fn(e,100)}}),[])}function qn(e,n,t){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/t*100,a=i/t*100;return Math.min(o,Math.max(a,n))}function Jn(e,n,t){if(1===e.length)return"100";const r=t[e.findIndex((e=>e.id===n))];return null==r?"0":r.toPrecision(10)}function Gn(e,n,t=0,r=null){return e.clientX-(r||n.getBoundingClientRect()).left-t}function Xn(e){return"panel"===e.type}function Hn(e){return"resizer"===e.type}function Zn(e){return Array.from(e.values()).sort((({order:e},{order:n})=>null==e&&null==n?0:null==e?-1:null==n?1:e-n))}function Qn(e,n,t){const r=n.reduce(((e,n)=>e+n),0),i=[...n].map((e=>e/r*100));let o=0;for(let n=0;n<e.length;n++){const r=e[n],a=i[n],c=qn(r,a,t);a!=c&&(o+=a-c,i[n]=c)}if("0.000"!==o.toFixed(3))for(let n=0;n<e.length;n++){const r=e[n];let{maxWidth:a,minWidth:c}=r;c=c/t*100,null!=a&&(a=a/t*100);const s=Math.min(null!=a?a:100,Math.max(c,i[n]+o));if(s!==i[n]&&(o-=s-i[n],i[n]=s,"0.000"===Math.abs(o).toFixed(3)))break}return i}var Yn,et=Object.freeze,nt=Object.defineProperty;const tt=H.div(Yn||(Yn=((e,n)=>et(nt(e,"raw",{value:et(n||e.slice())})))(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n"]))),rt=function({children:n}){const t=L(null),[r,i]=j(new Map),o=I((()=>Zn(r).filter(Xn)),[r]),[a,c]=j([]),[s,d]=j(null),l=L({elements:r,panels:o,widths:a}),u=O((e=>({flexGrow:Jn(o,e,a),pointerEvents:null===s?void 0:"none"})),[s,o,a]),p=O(((e,n)=>{i((t=>{if(t.has(e))return t;const r=new Map(t);return r.set(e,n),r}))}),[]),h=O((e=>{i((n=>{if(!n.has(e))return n;const t=new Map(n);return t.delete(e),t}))}),[]),f=L({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=O(((e,n)=>{const t=Zn(r),i=t.findIndex((n=>n.id===e)),o=r.get(e);if(!o||!Hn(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:t.reduce(((e,n,t)=>Xn(n)&&t<i?n:e),null),panelAfter:t.reduce(((e,n,t)=>null===e&&Xn(n)&&t>i?n:e),null),containerWidth:window.innerWidth,startX:n.pageX,dragOffset:Gn(n,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=O((()=>{d(null)}),[]),g=O(((e,n)=>{n.preventDefault(),n.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:s,resizerRect:d}=f.current;if(null==a||null==s)return;const u=r.get(e);if(!u||!Hn(u))return;const p=u.el.current;if(!p)return;const h=Gn(n,p,o,d);if(0===h)return;const{widths:m}=l.current,v=function(e,n,t,r,i,o){const{panels:a,widths:c}=i,{widths:s}=o,d=s||c,l=[...d];{const i=e<0?r:t,o=d[a.findIndex((e=>e.id===i.id))],c=qn(i,o+Math.abs(e),n);if(o===c)return d;e=e<0?o-c:c-o}let u=0,p=e<0?t:r,h=a.findIndex((e=>e.id===p.id));for(;;){const t=a[h],r=d[h],i=qn(t,r-(Math.abs(e)-Math.abs(u)),n);if(r!==i&&(u+=r-i,l[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?d:(p=e<0?r:t,h=a.findIndex((e=>e.id===p.id)),l[h]=d[h]+u,l)}(h/t.current.getBoundingClientRect().width*100,i,a,s,l.current,f.current),g=m.some(((e,n)=>e!==v[n]));g&&c(v)}),[r]);R((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const w=$n();R((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const n=w.get(o);if(n){const e=Qn(o,n,window.innerWidth);return void c(e)}const t=function(e){let n=e.length,t=100;const r=e.map((e=>e.defaultSize?(t-=e.defaultSize,n-=1,e.defaultSize):null)),i=t/n;return r.map((e=>null===e?i:e))}(o);c(t)}),[w,o]),D((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),R((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:n}=l.current,t=Qn(e,n,window.innerWidth),r=n.some(((e,n)=>e!==t[n]));r&&c(t)}));return e.observe(t.current),()=>{e.disconnect()}}),[]);const y=I((()=>({activeResizer:s,drag:g,getPanelStyle:u,registerElement:p,startDragging:m,stopDragging:v,unregisterElement:h})),[s,g,u,p,m,v,h]);return e(Cn.Provider,{value:y,children:e(tt,{ref:t,children:n})})},it=function(n){const{children:t,navigate:r}=n,i=O(((e,n=void 0)=>{r(n||{},e?{preview:e}:{})}),[r]);return e(Q.Provider,{value:i,children:t})};function ot(n){const{unstable_navigator:r}=n,i=!!(null==r?void 0:r.component),[o,a]=function(e,n){const[t,r]=j((()=>{var t;return JSON.parse(null!=(t=localStorage.getItem(e))?t:JSON.stringify(n))}));return D((()=>{localStorage.setItem(e,JSON.stringify(t))}),[e,t]),[t,r]}("presentation/navigator",i),c=!!i&&o,s=I((()=>{if(i)return()=>a((e=>!e))}),[i,a]),d=O((function(){return e(t,{children:c&&e(at,{...r})})}),[c,r]);return[{navigatorEnabled:c,toggleNavigator:s},d]}const at=T((function(r){const{minWidth:i,maxWidth:o,component:a}=r,c=null!=i&&null!=o&&i===o;return n(t,{children:[e(Un,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Nn,{order:2,disabled:c})]})})),ct=function(n){const{children:t,params:r}=n,i=I((()=>r),[r]);return e(Y.Provider,{value:i,children:t})},st=function(n){const{children:t,deskParams:r,devMode:i,name:o,navigate:a,params:c}=n,s=I((()=>({deskParams:r,devMode:i,name:o,navigate:a,params:c})),[r,i,o,a,c]);return e(Z.Provider,{value:s,children:t})};var dt,lt=Object.freeze,ut=Object.defineProperty;const pt=Oe(H.iframe(dt||(dt=((e,n)=>lt(ut(e,"raw",{value:lt(n||e.slice())})))(["\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n"])))),ht=function(n){var r;const{basePath:i="/"}=(null==(r=K())?void 0:r.activeWorkspace)||{},{fontSize:o=1,onChange:a,origin:c,padding:s=3,value:d}=n,l=L(null),[u,p]=j(void 0),[h,f]=j(void 0),v=O((e=>{p(e.currentTarget.value)}),[]),g=O((e=>{var n;if("Enter"===e.key){if(void 0===u)return;const e=u.startsWith("/")||""===u?"".concat(c).concat(u):u;if(!e.startsWith(c+"/")&&e!==c)return void f("URL must start with ".concat(c));if(!c&&(e.startsWith("".concat(i,"/"))||e===i))return void f("URL can't have the same base path as the Studio ".concat(i));const t=e===c?c+"/":e;f(void 0),p(void 0),a(t.slice(c.length)),null==(n=l.current)||n.blur()}"Escape"===e.key&&(f(void 0),p(void 0))}),[i,a,c,u]),w=O((()=>{f(void 0),p(void 0)}),[]);D((()=>{f(void 0),p(void 0)}),[c,d]);const y=I((()=>({icon:ue})),[]);return e(t,{children:e(m,{clearButton:h?y:void 0,customValidity:h,fontSize:o,onBlur:w,onClear:()=>{f(void 0),p(c+d)},onChange:v,onKeyDownCapture:g,padding:s,style:{zIndex:1},radius:2,ref:l,space:s,value:void 0===u?"".concat(c).concat(d):u})})};var ft,mt=Object.freeze,vt=Object.defineProperty;const gt=Oe(o),wt=H(v)(ft||(ft=((e,n)=>mt(vt(e,"raw",{value:mt(n||e.slice())})))(["\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n"]))),yt={previewDrafts:"Drafts",published:"Published",raw:"Raw"},bt="caution",xt="positive",kt={previewDrafts:xe,published:ke,raw:Pe},Pt=C((function(r,a){const{initialUrl:d,targetOrigin:f,navigatorEnabled:m,onPathChange:v,openPopup:z,overlayEnabled:S,params:E,perspective:C,setPerspective:U,toggleNavigator:R,toggleOverlay:L,loadersConnection:T,overlaysConnection:M,previewKitConnection:A}=r,{devMode:_}=nn(),[N,F]=j("desktop"),K=g(),V=O((()=>F("desktop")),[F]),$=O((()=>F("mobile")),[F]),[q,J]=j(!0),[G,X]=j(!1),[H,Z]=j(!1),[Q,Y]=j(!1),ne=q||H||"connecting"===M,te=I((()=>f===location.origin?"":f),[f]),re=O((()=>{"function"!=typeof a&&(null==a?void 0:a.current)&&(a.current.src="".concat(f).concat(E.preview||"/"),Z(!0))}),[E.preview,f,a]),ie=O((()=>{"function"!=typeof a&&(null==a?void 0:a.current)&&(a.current.src=d.toString(),Z(!0))}),[a,d]),oe=O((()=>{ce(!0)}),[]),[ae,ce]=j(!1),[se,de]=j(!1);D((()=>{if(!(q||H||"connecting"!==M&&"reconnecting"!==M)){const e=setTimeout((()=>{de(!0)}),1e3);return()=>clearTimeout(e)}}),[M,q,H,de]),D((()=>{if(!q&&!H&&se){if("connected"===M&&(Y(!1),de(!1),X(!1),ce(!1)),"connecting"===M){const e=setTimeout((()=>{X(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),ee);return()=>clearTimeout(e)}if("reconnecting"===M){const e=setTimeout((()=>{X(!0),Y(!0)}),ee);return()=>clearTimeout(e)}"disconnected"===M&&Y(!0)}}),[q,M,H,se]);const le=I((()=>{const e=new URL(E.preview||"/",f),{pathname:n,search:t}=Se(e);return"".concat(n).concat(t)}),[E.preview,f]),ue=O((()=>{J(!1),Z(!1)}),[]);return e(Ie,{transition:K?{duration:0}:void 0,children:n(w,{delay:1e3,children:[e(i,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:n(o,{align:"center",gap:2,style:{minHeight:0},children:[R&&e(y,{animate:!0,content:e(s,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Toggle navigator",fontSize:1,icon:pe,mode:"bleed",onClick:R,padding:3,selected:m})}),e(y,{animate:!0,content:n(o,{align:"center",style:{whiteSpace:"nowrap"},children:[e(l,{padding:1,children:e(s,{size:1,children:S?"Disable edit overlay":"Enable edit overlay"})}),e(l,{paddingY:1,children:e(B,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(i,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:S?"positive":void 0,children:n(o,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(wt,{checked:S,onChange:L,disabled:ne})}),e(l,{children:e(s,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),_&&e(y,{animate:!0,content:e(s,{size:1,children:H?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Refresh preview",fontSize:1,icon:he,mode:"bleed",loading:H,onClick:re,padding:3})}),e(l,{flex:1,children:e(ht,{onChange:v,origin:te,value:le})}),e(o,{align:"center",flex:"none",gap:1,children:e(b,{button:e(u,{fontSize:1,iconRight:fe,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e(x,{children:e(Ot,{initialUrl:d,openPopup:z,previewLocationOrigin:te,previewLocationRoute:le})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e(o,{align:"center",flex:"none",gap:1,children:e(b,{button:e(u,{fontSize:1,iconRight:me,mode:"bleed",padding:3,space:2,text:yt[C],loading:ne||"connecting"===T&&"connected"!==A,disabled:"connected"!==T}),id:"perspective-menu",menu:n(x,{style:{maxWidth:240},children:[e(k,{fontSize:1,onClick:()=>U("previewDrafts"),padding:3,pressed:"previewDrafts"===C,tone:bt,children:n(o,{align:"flex-start",gap:3,children:[e(l,{flex:"none",children:e(s,{size:1,children:W(kt.previewDrafts)})}),n(c,{flex:1,space:2,children:[e(s,{size:1,weight:"medium",children:yt.previewDrafts}),e(s,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(l,{flex:"none",children:e(s,{muted:!0,size:1,style:{opacity:"previewDrafts"===C?1:0},children:e(ve,{})})})]})}),e(k,{fontSize:1,onClick:()=>U("published"),padding:3,pressed:"published"===C,tone:xt,children:n(o,{align:"flex-start",gap:3,children:[e(l,{flex:"none",children:e(s,{size:1,children:W(kt.published)})}),n(c,{flex:1,space:2,children:[e(s,{size:1,weight:"medium",children:yt.published}),e(s,{muted:!0,size:1,children:"View this page with published content"})]}),e(l,{flex:"none",children:e(s,{muted:!0,size:1,style:{opacity:"published"===C?1:0},children:e(ve,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),n(o,{align:"center",flex:"none",gap:1,children:[e(y,{animate:!0,content:e(s,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Full viewport",fontSize:1,icon:ge,mode:"bleed",onClick:V,padding:3,selected:"desktop"===N})}),e(y,{animate:!0,content:e(s,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Narrow viewport",fontSize:1,icon:we,mode:"bleed",onClick:$,padding:3,selected:"mobile"===N})})]})]})}),e(i,{flex:1,tone:"transparent",children:n(o,{align:"center",height:"fill",justify:"center",padding:"desktop"===N?0:2,sizing:"border",style:{position:"relative",cursor:ne?"wait":void 0},children:[e(je,{children:Q||q||H||!se||ae?!q&&!ne||ae?Q&&!ae?e(gt,{initial:"initial",animate:"animate",exit:"exit",variants:Et,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e(en,{flex:1,message:"Could not connect to the preview",onRetry:ie,onContinueAnyway:oe,children:_&&n(t,{children:["connected"!==M&&e(i,{padding:3,radius:2,tone:"critical",children:n(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Overlay connection status"}),e(p,{size:1,children:M})]})}),"connected"!==T&&e(i,{padding:3,radius:2,tone:"critical",children:n(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Loader connection status"}),e(p,{size:1,children:T})]})})]})})}):null:e(gt,{initial:"initial",animate:"animate",exit:"exit",variants:St,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:n(o,{style:{...zt[N]},justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(s,{muted:!0,size:1,children:"Loading…"})]})}):e(gt,{initial:"initial",animate:"animate",exit:"exit",variants:St,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:n(o,{style:{...zt[N]},justify:"center",align:"center",direction:"column",gap:4,children:[G&&e(u,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e(i,{radius:2,tone:G?"caution":"inherit",padding:4,shadow:1,children:n(o,{justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(s,{muted:!0,size:1,children:G?e(t,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),G&&e(u,{fontSize:1,tone:"critical",onClick:oe,text:"Continue anyway"})]})})}),e(pt,{ref:a,style:{pointerEvents:ne&&!ae?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:d.toString(),initial:["background"],variants:Ct,animate:[!q&&!ne||ae?"active":"background",H?"reloading":"idle",N,se&&!ae?"timedOut":""],onLoad:ue})]})})]})})})),zt={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},St={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Et={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Ct={desktop:{...zt.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...zt.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Ot(r){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:c}=r,s=O((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return n(t,{children:[e(It,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:c}),e(k,{icon:ye,text:"Open preview",as:"a",href:"".concat(a).concat(c),onClick:s,rel:"opener",target:"_blank"})]})}function It(n){const{initialUrl:t,previewLocationOrigin:r,previewLocationRoute:i}=n,{push:o}=z(),a=V({apiVersion:ne}),c=$(),[s,d]=j(!1);return e(k,{disabled:s,onClick:()=>{if(!(null==navigator?void 0:navigator.clipboard))return o({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;d(!0);let n="".concat(r).concat(i);const s=()=>{o({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),d(!1)},l=e=>{o({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),d(!1)};if(Ee(t)&&"undefined"!=typeof ClipboardItem){const r="text/plain",d=new ClipboardItem({[r]:(async()=>{e=o({closable:!0,title:"Copying URL to clipboard…"});const s=await ze(a,"@sanity/presentation","undefined"==typeof window?"":location.href,null==c?void 0:c.id),d=Ce(t,s.secret,i);return n=d.toString(),new Blob([n],{type:r})})()});navigator.clipboard.write([d]).then(s).catch(l)}else navigator.clipboard.writeText(n).then(s).catch(l)},text:"Copy link",icon:be})}let jt=!1;function Dt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function Ut({initialPreviewUrl:e,routerNavigate:n,routerState:t,routerSearchParams:r,previewRef:i}){const o=I((()=>{const{id:n,path:i,type:o}={id:Qe((a=t).id),path:Ye(a.path),type:a.type};var a;return{id:n,type:o,path:i,preview:r.preview||"".concat(e.pathname).concat(e.search),perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[t,r,e]),a=I((()=>Dt({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]),c=L(t);D((()=>{c.current=t}),[t]);return{deskParams:a,navigate:I((()=>Fn(((e,t={},r)=>{const{_searchParams:o,...a}=c.current,s=(o||[]).reduce(((e,[n,t])=>(e[n]=t,e)),{}),d=Dt({...a,...e}),l=Dt({...s,...t});d._searchParams=Object.entries(l).reduce(((e,[n,t])=>[...e,[n,t]]),[]);const u=null!=r?r:l.preview===i.current;n(d,{replace:u})}),50)),[n,i]),params:o}}function Rt(e,n,t){var r,i;const o=V({apiVersion:ne}),a=K(),c=(null==(r=null==a?void 0:a.activeWorkspace)?void 0:r.basePath)||"/",s=(null==(i=null==a?void 0:a.activeWorkspace)?void 0:i.name)||"default",d=function(e,n,t){const r=$();return I((()=>["@sanity/presentation",n,t,e,null==r?void 0:r.id,Lt]),[n,null==r?void 0:r.id,e,t])}(n,c,s),l=function(e,n){const t=V({apiVersion:ne}),r=$(),[i,o]=j(""),a=e?Re((async()=>await ze(t,"@sanity/presentation","undefined"==typeof window?"":location.href,null==r?void 0:r.id)),[...n,i]):null;return D((()=>{if(!a)return;const e=setTimeout((()=>{M((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),(null==a?void 0:a.secret)||null}("object"==typeof e||"function"==typeof e,d);return Re((async()=>{if("string"==typeof e){const n=new URL(e,location.origin);let r=n;try{if(t){const e=new URL(t,n);e.origin===n.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===n.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith("".concat(c,"/"))&&r.pathname!==c?r:n}const n="object"==typeof e?Ue(e):e,r=await n({client:o,previewUrlSecret:l,previewSearchParam:t,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:c});return new URL(r,location.origin)}),[...d,l])}const Lt=Symbol();var Tt,Wt=Object.freeze,Mt=Object.defineProperty;const At=_((()=>import("./LoaderQueries-UgnF0IsK.js"))),_t=_((()=>import("./RevalidateTags-3WUDGLhj.js"))),Nt=H(o)(Tt||(Tt=((e,n)=>Wt(Mt(e,"raw",{value:Wt(n||e.slice())})))(["\n  overflow-x: auto;\n"])));function Ft(i){var a;const{previewUrl:c,components:s,unstable_emitExperimentalRevalidateTagsLoaderEvent:d}=null!=(a=i.tool.options)?a:{},l=i.tool.name||re,{unstable_navigator:u}=s||{},{navigate:p,state:h}=X(),f=N(Object.fromEntries(h._searchParams||[])),m=Rt(c||"/",l,f.preview||null),[v]=j((()=>{var e;const n=null==(e=i.tool.options)?void 0:e.devMode;return"function"==typeof n?n():"boolean"==typeof n?n:"undefined"!=typeof window&&"localhost"===window.location.hostname})),g=I((()=>m.origin),[m.origin]),w=L(null),[y,b]=j(),[x,k]=j({}),P=L(),{params:z,deskParams:E,navigate:C}=Ut({initialPreviewUrl:m,routerNavigate:p,routerState:h,routerSearchParams:f,previewRef:P}),[U,R]=j((()=>"published"===z.perspective?z.perspective:"previewDrafts")),[T,W]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error("Invalid perspective: ".concat(e));const[n,t]=j({}),[r,i]=j({}),o=O(((e,n)=>{const r=n.filter((e=>"_projectId"in e&&e._projectId?(jt||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),jt=!0),!1):e));("published"===e?t:i)((e=>{const n={};for(const e of r)n[e._id]=e;return De(e,n)?e:n}))}),[]);return[I((()=>"published"===e?[...Object.values(n)]:[...Object.values(r)]),[e,r,n]),o]}(U),[_,F]=j(!0),K=q(),B=J();D((()=>{U!==z.perspective&&C({},{perspective:"published"===U?"published":void 0})}),[z.perspective,U,C]);const[V,$]=j("connecting"),[G,H]=j("connecting"),[Z,Q]=j("connecting"),[Y]=j((()=>new Set)),ee=O((e=>{const n=window.open(e,"_blank");n&&Y.add(n)}),[Y]);D((()=>{if(Y.size&&y)for(const e of Y)e&&"closed"in e&&!e.closed&&y.addSource(e)}),[y,Y,Y.size]),D((()=>{var e;const n=null==(e=w.current)?void 0:e.contentWindow;if(!n)return;const t=function(e){const{destroy:n,send:t}=qe(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{n();for(const e of o)e()},send:(e,n,o)=>{t(e,n,o);for(const t of r)t&&"closed"in t&&!t.closed&&i.has(t)&&i.get(t)(e,n,o)},addSource(n){if(r.has(n))return;if(!("closed"in n))throw console.warn("Source is unsupported",{source:n}),new Error("Source is unsupported");if(n.closed)throw new Error("Source is closed");const{send:t,destroy:a}=qe({...e,target:n,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:n,onEvent:t,...r}=e;return{...r,onEvent:t?(e,n)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return t(e,n)}:void 0}}))});o.add(a),i.set(n,t),r.add(n)}}}({id:"presentation",target:n,targetOrigin:g,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:$,onEvent(e,n){if("overlay/focus"===e&&"id"in n)C({type:n.type,id:n.id,path:n.path});else if("overlay/navigate"===e){if(P.current!==n.url){const e=void 0===P.current;P.current=n.url,C(e?{}:{id:void 0,type:void 0},{preview:n.url})}}else"overlay/toggle"===e&&F(n.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:H,onEvent(e,n){if("loader/documents"===e&&n.projectId===K&&n.dataset===B)W(n.perspective,n.documents);else if("loader/query-listen"===e&&n.projectId===K&&n.dataset===B){if("number"==typeof n.heartbeat&&n.heartbeat<te)throw new Error("Loader query listen heartbeat interval must be at least ".concat(te,"ms"));k((e=>{var t,r,i;return{...e,[(r=n.query,i=n.params,"".concat(r,"-").concat("string"==typeof i?i:JSON.stringify(i)))]:{perspective:n.perspective,query:n.query,params:n.params,receivedAt:Date.now(),heartbeat:null!=(t=n.heartbeat)&&t}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:Q,onEvent(e,n){"preview-kit/documents"===e&&n.projectId===K&&n.dataset===B&&W(n.perspective,n.documents)}}]});return b(t),()=>{t.destroy(),b(void 0)}}),[B,K,W,C,g]),D((()=>{const e=setInterval((()=>M((()=>k((e=>{if(Object.keys(e).length<1)return e;const n=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&n>e.receivedAt+e.heartbeat)))return e;const t={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&n>i.receivedAt+i.heartbeat||(t[r]=i);return t}))))),te);return()=>clearInterval(e)}),[]);const ne=O((e=>{C({path:r.toString(e)},{},!0)}),[C]),ie=O((e=>{const n=new URL(e,m.origin),t=n.pathname+n.search;n.origin===m.origin&&t!==z.preview&&C({id:void 0,path:void 0},{preview:t})}),[m,z,C]),oe=O((e=>{C({},e)}),[C]);D((()=>{z.id&&z.path?null==y||y.send("overlays","presentation/focus",{id:z.id,path:z.path}):null==y||y.send("overlays","presentation/blur",void 0)}),[y,z.id,z.path]),D((()=>{P.current&&z.preview&&P.current!==z.preview&&(P.current=z.preview,"connected"!==V&&w.current?w.current.src="".concat(g).concat(z.preview):null==y||y.send("overlays","presentation/navigate",{url:z.preview,type:"replace"}))}),[y,V,g,z.preview]);const ae=O((()=>null==y?void 0:y.send("overlays","presentation/toggleOverlay",void 0)),[y]),[ce,se]=j(null);D((()=>{const e=e=>{Ze(e)&&ae()},n=e=>{var n;Ze(e)&&ae(),n=e,["mod","\\"].every((e=>He[e]?n[He[e]]:n.key===e.toUpperCase()))&&ae()};return window.addEventListener("keydown",n),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",e)}}),[ae]);const[de,ue]=j(null),[{navigatorEnabled:pe,toggleNavigator:he},fe]=ot({unstable_navigator:u}),me=L(z.id);return D((()=>{z.rev&&me.current&&z.id!==me.current&&C({},{rev:void 0}),me.current=z.id})),n(t,{children:[e(st,{deskParams:E,devMode:v,name:l,params:z,navigate:C,children:e(it,{navigate:C,children:e(ct,{params:z,children:e(Nt,{height:"fill",children:n(rt,{children:[e(fe,{}),e(Un,{id:"preview",minWidth:325,defaultSize:pe?50:75,order:3,children:e(o,{direction:"column",flex:1,height:"fill",ref:ue,children:e(S,{element:de,children:e(Pt,{initialUrl:m,navigatorEnabled:pe,onPathChange:ie,openPopup:ee,overlayEnabled:_,params:z,perspective:U,ref:w,setPerspective:R,targetOrigin:g,toggleNavigator:he,toggleOverlay:ae,loadersConnection:G,overlaysConnection:V,previewKitConnection:Z})})})}),e(Nn,{order:4}),e(Un,{id:"content",minWidth:325,order:5,children:e(le,{documentId:z.id,setDisplayedDocument:se,children:e(En,{refs:T,deskParams:E,documentId:z.id,documentType:z.type,onDeskParams:oe,onFocusPath:ne,previewUrl:z.preview})})})]})})})})}),y&&e(A,{children:e(At,{channel:y,liveQueries:x,perspective:U,liveDocument:ce,documentsOnPage:T})}),d&&y&&e(A,{children:e(_t,{channel:y})})]})}export{Ft as default};//# sourceMappingURL=PresentationTool-LjNzFpR9.js.map
