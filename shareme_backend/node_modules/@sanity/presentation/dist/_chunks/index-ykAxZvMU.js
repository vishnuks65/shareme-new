import{jsx as e,jsxs as n,Fragment as t}from"react/jsx-runtime";import{createContext as i,useState as o,useEffect as r,useContext as a,useCallback as s,createElement as c,useRef as l,useMemo as d,lazy as u,Suspense as p}from"react";import{useDocumentStore as m,defineDocumentFieldAction as h,useWorkspace as f,pathToString as v,isRecord as y,getPublishedId as g,definePlugin as w,isDocumentSchemaType as x}from"sanity";import{ComposeIcon as b,ChevronRightIcon as T,DesktopIcon as I,InfoOutlineIcon as P,WarningOutlineIcon as _,ErrorOutlineIcon as z,MasterDetailIcon as j}from"@sanity/icons";import{Card as S,Flex as A,Box as D,Text as k,Stack as O}from"@sanity/ui";import{useIntentLink as B,useRouter as C,route as E}from"sanity/router";import{isObservable as H,of as N}from"rxjs";import{uuid as L}from"@sanity/uuid";const M=b,U="presentation",q="Presentation",F=3e3,G="2023-10-16",J=1e3,K=100,Q=2048,R=i(null),V={locations:[]};const W={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},X={positive:P,caution:_,critical:z};function Y(i){const{documentId:l,options:d,schemaType:u,showPresentationTitle:p}=i,h=a(R),{message:f,locations:v,tone:y}=function(e){const{id:n,locate:t,type:i}=e,a=m(),[s,c]=o(V);return r((()=>{if(!t)return;const e=t({id:n,type:i},{documentStore:a}),o=(H(e)?e:N(e)).subscribe((e=>c(e||V)));return()=>o.unsubscribe()}),[a,n,t,i]),s}({id:l,locate:d.locate,type:u.name}),g=(null==v?void 0:v.length)||0,[w,x]=o(!1),b=s((()=>x((e=>!e))),[]),I=f||(g?n(t,{children:["Used on ",W[g]||g," ",e(t,1===g?{children:"page"}:{children:"pages"})]}):null);return 0!==g||I?e(S,{padding:1,radius:3,border:!0,tone:y,children:n("div",{style:{margin:-1},children:[!v&&n(A,{align:"flex-start",gap:3,padding:3,children:[y&&e(D,{flex:"none",children:e(k,{size:1,children:c(X[y])})}),e(D,{flex:1,children:n(k,{size:1,weight:"medium",children:[p&&n(t,{children:[d.title||q," · "]}),I]})})]}),v&&n(t,{children:[e(S,{as:"button",onClick:b,padding:3,radius:2,tone:"inherit",children:n(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(T,{style:{transform:"rotate(".concat(w?"90deg":0,")"),transition:"transform 100ms ease-in-out"}})})}),e(D,{flex:1,children:n(k,{size:1,weight:"medium",children:[p&&n(t,{children:[d.title||q," · "]}),I]})})]})}),e(O,{hidden:!w,marginTop:1,space:1,children:v.map(((n,t)=>e(Z,{active:(d.name||U)===(null==h?void 0:h.name)&&n.href===(null==h?void 0:h.params.preview),documentId:l,documentType:u.name,node:n,toolName:d.name||U},t)))})]})]})}):null}function Z(t){const{documentId:i,documentType:o,node:r,active:l,toolName:d}=t,u=a(R),p=null==u?void 0:u.navigate,m=B({intent:"edit",params:{id:i,type:o,mode:"presentation",presentation:d,...null==u?void 0:u.deskParams,preview:r.href}}),h=s((()=>{null==p||p({},{preview:r.href})}),[r.href,p]);return c(S,{...u?{}:m,as:u?"button":"a",key:r.href,onClick:h,padding:3,radius:2,pressed:l,tone:"inherit"},n(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(I,{})})}),n(O,{flex:1,space:2,children:[e(k,{size:1,weight:"medium",children:r.title}),e(k,{muted:!0,size:1,textOverflow:"ellipsis",children:r.href})]})]}))}const $=i(null);function ee(n){var t;const{documentId:i,options:o,schemaType:r}=n,s=a($);if(s&&s.options[0]!==o)return null;const c=(null==(t=null==s?void 0:s.options)?void 0:t.length)||0;return e(O,{marginBottom:5,space:5,children:e(O,{space:2,children:null==s?void 0:s.options.map(((n,t)=>e(Y,{documentId:i,options:n,schemaType:r,showPresentationTitle:c>1},t)))})})}function ne(n){const{children:t,options:i}=n,c=a($),u=null==c?void 0:c.register,[p,m]=o((()=>[])),h=s((e=>u?u(e):(m((n=>[e].concat(n))),()=>{m((n=>n.filter((n=>n!==e))))})),[u]),f=l(h);f.current=h;const v=d((()=>({options:(null==c?void 0:c.options)||p,register:h})),[p,c,h]);return r((()=>f.current(i)),[i]),e($.Provider,{value:v,children:t})}const te=h({name:"presentation/openInStructure",useAction({documentId:e,documentType:n,path:t}){const i=f(),{navigateIntent:o}=C(),r=a(R),s=d((()=>function(e,n,t){var i;const o=e.map((e=>{var i;return{tool:e,match:null==(i=e.canHandleIntent)?void 0:i.call(e,"edit",{id:n,type:t,mode:"structure"},{})}})),r=o.filter((e=>y(e.match)&&e.match.mode));if(r.length>0)return r[0].tool;const a=o.filter((e=>e.match));return null==(i=a[0])?void 0:i.tool}(i.tools,e,n)),[e,n,i.tools]);return{type:"action",hidden:!r||t.length>0||!s,icon:(null==s?void 0:s.icon)||j,title:"Open in ".concat((null==s?void 0:s.title)||"Structure"),onAction(){o("edit",{id:e,type:n,mode:"structure",path:v(t)})},renderAsButton:!0}}});function ie(e,n,t,i){const{id:o,mode:r,path:a,presentation:s,type:c,...l}=n;return"edit"===e&&o?{type:c||"*",id:g(o),path:a,_searchParams:Object.entries(l)}:"create"===e?(l.preview=l.preview||"/",{type:c||"*",id:o||L(),_searchParams:Object.entries(l)}):{intent:e,params:n,payload:i}}const oe=E.create("/",{__unsafe_disableScopedSearchParams:!0},[E.intents("/intent"),E.create("/:type",[E.create("/:id"),E.create("/:id/:path")])]),re=u((()=>import("./PresentationTool-LjNzFpR9.js"))),ae=u((()=>import("./BroadcastDisplayedDocument-UvW2hJqz.js"))),se=w((t=>{const i=t.name||U;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==te.name)),te]},form:{components:{input:function(i){const o=i.value,r=(null==o?void 0:o._id)?g(null==o?void 0:o._id):void 0;return x(i.schemaType)?n(ne,{options:t,children:[r&&e(ee,{documentId:r,options:t,schemaType:i.schemaType}),i.renderDefault(i),e(p,{children:e(ae,{value:o})},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:t.icon||M,name:i,title:t.title,component:re,options:t,canHandleIntent:(e,n)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===i)&&(!("template"in e)||{template:!0})}(n):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===i)&&(!("mode"in e)||{mode:"presentation"===e.mode})}(n),getIntentState:ie,router:oe}]}})),ce=i(null);function le(){const e=a(ce);if(!e)throw new Error("Presentation navigate context is missing");return e}const de=i(null);function ue(){const e=a(de);if(!e)throw new Error("Presentation params context is missing");return e}export{G as A,U as D,Q as L,F as M,R as P,ce as a,de as b,J as c,K as d,ue as e,se as p,le as u};//# sourceMappingURL=index-ykAxZvMU.js.map
