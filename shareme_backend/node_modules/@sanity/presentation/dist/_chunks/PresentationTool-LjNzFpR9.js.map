{"version":3,"file":"PresentationTool-LjNzFpR9.js","sources":["../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/rng.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/stringify.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/native.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/v4.js","../../../channels/src/constants.ts","../../../channels/src/helpers.ts","../../../channels/src/controller.ts","../../../visual-editing-helpers/dist/_chunks/urlStringToPath-53ZuVkUF.js","../../../visual-editing-helpers/dist/index.js","../../src/lib/parse.ts","../../src/components/ErrorCard.tsx","../../src/usePresentationTool.ts","../../src/editor/PresentationPaneRouterProvider.tsx","../../src/editor/DocumentListPane.tsx","../../src/editor/DocumentListPanel.tsx","../../src/editor/DocumentPane.tsx","../../src/editor/DocumentPanel.tsx","../../src/editor/ContentEditor.tsx","../../src/panels/PanelsContext.tsx","../../src/panels/Panel.tsx","../../src/panels/PanelResizer.tsx","../../src/panels/usePanelId.ts","../../src/lib/debounce.ts","../../src/panels/usePanelsStorage.ts","../../src/panels/util.ts","../../src/panels/Panels.tsx","../../src/PresentationNavigateProvider.tsx","../../src/PresentationNavigator.tsx","../../src/useLocalState.ts","../../src/PresentationParamsProvider.tsx","../../src/PresentationProvider.tsx","../../src/preview/IFrame.tsx","../../src/preview/PreviewLocationInput.tsx","../../src/preview/PreviewFrame.tsx","../../src/useDocumentsOnPage.ts","../../src/useParams.ts","../../src/usePreviewUrl.ts","../../src/PresentationTool.tsx"],"sourcesContent":["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import type { ChannelMsgType } from './types'\n\nexport const RESPONSE_TIMEOUT = 1000\nexport const HEARTBEAT_INTERVAL = 1000\nexport const HANDSHAKE_INTERVAL = 500\n\nexport const INTERNAL_MSG_TYPES = [\n  'channel/disconnect',\n  'channel/response',\n  'channel/heartbeat',\n] satisfies ChannelMsgType[]\n\nexport const HANDSHAKE_MSG_TYPES = [\n  'handshake/syn',\n  'handshake/syn-ack',\n  'handshake/ack',\n] satisfies ChannelMsgType[]\n","import { HANDSHAKE_MSG_TYPES, INTERNAL_MSG_TYPES } from './constants'\nimport { ChannelMsgType, HandshakeMsgType, InternalMsgType } from './types'\n\nexport const isInternalMessage = (\n  type: ChannelMsgType | InternalMsgType,\n): type is InternalMsgType => {\n  return INTERNAL_MSG_TYPES.some((t) => t === type)\n}\n\nexport const isHandshakeMessage = (\n  type: ChannelMsgType | InternalMsgType,\n): type is HandshakeMsgType => {\n  return HANDSHAKE_MSG_TYPES.some((t) => t === type)\n}\n\nexport const isLegacyHandshakeMessage = ({\n  data = {},\n}: MessageEvent): boolean => {\n  return (\n    // Check data is a record type\n    typeof data === 'object' &&\n    data !== null &&\n    !Array.isArray(data) &&\n    // The \"domain\" key was introduced in commit 4854e7f\n    !('domain' in data) &&\n    // Check the rest of the object shape is present\n    ['id', 'type', 'from', 'to'].every((key) => key in data) &&\n    // Prior to 4854e7f only handshake events were emitted prior to an established connection\n    data.type.startsWith('handshake/')\n  )\n}\n","import { v4 as uuid } from 'uuid'\n\nimport {\n  HANDSHAKE_INTERVAL,\n  HEARTBEAT_INTERVAL,\n  RESPONSE_TIMEOUT,\n} from './constants'\nimport { isHandshakeMessage, isLegacyHandshakeMessage } from './helpers'\nimport type {\n  ChannelMsg,\n  ChannelsController,\n  ChannelsControllerChannel,\n  ChannelsControllerOptions,\n  ChannelStatus,\n  InternalMsgType,\n  ProtocolMsg,\n  ToArgs,\n} from './types'\n\nexport function createChannelsController<T extends ChannelMsg>(\n  config: ChannelsControllerOptions<T>,\n): ChannelsController {\n  const { destroy, send } = createChannelsControllerInternal(config)\n  const sources = new Set<MessageEventSource>()\n  const sendToSource = new WeakMap<\n    MessageEventSource,\n    ChannelsController['send']\n  >()\n  const destroySource = new Set<ChannelsController['destroy']>()\n\n  const sendToMany = ((id, type, data) => {\n    send(id, type, data)\n    for (const source of sources) {\n      if (\n        source &&\n        'closed' in source &&\n        !source.closed &&\n        sendToSource.has(source)\n      ) {\n        const send = sendToSource.get(source)\n        send!(id, type, data)\n      }\n    }\n  }) satisfies ChannelsController['send']\n\n  const destroyMany = (() => {\n    destroy()\n    for (const destroy of destroySource) {\n      destroy()\n    }\n  }) satisfies ChannelsController['destroy']\n\n  return {\n    destroy: destroyMany,\n    send: sendToMany,\n    addSource(source) {\n      if (sources.has(source)) {\n        return\n      }\n      if (!('closed' in source)) {\n        // eslint-disable-next-line no-console\n        console.warn('Source is unsupported', { source })\n        throw new Error('Source is unsupported')\n      }\n      if (source.closed) {\n        throw new Error('Source is closed')\n      }\n      const { send, destroy } = createChannelsControllerInternal({\n        ...config,\n        target: source,\n        // @TODO temporary workaround for onStatusUpdate and onEvent not differentiating\n        //       iframes from popups\n        connectTo: config.connectTo.map((prevConnectTo) => {\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          const { onStatusUpdate, onEvent, ...connectTo } = prevConnectTo\n\n          return {\n            ...connectTo,\n            onEvent: onEvent\n              ? (((type, data) => {\n                  if (\n                    type === 'preview-kit/documents' ||\n                    type === 'overlay/navigate' ||\n                    type === 'loader/documents'\n                  ) {\n                    return\n                  }\n\n                  // @ts-expect-error -- figure out ToArgs complaining\n                  return onEvent(type, data)\n                }) satisfies typeof onEvent)\n              : undefined,\n          }\n        }),\n      })\n      destroySource.add(destroy)\n      sendToSource.set(source, send)\n      sources.add(source)\n    },\n  }\n}\n\nfunction createChannelsControllerInternal<T extends ChannelMsg>(\n  config: ChannelsControllerOptions<T>,\n): Omit<ChannelsController, 'addSource'> {\n  const target = config.target\n\n  const channels: ChannelsControllerChannel<T>[] = config.connectTo.map(\n    (config) => ({\n      buffer: [],\n      config,\n      id: '',\n      handler: handshakeHandler,\n      status: 'connecting',\n      interval: undefined,\n      heartbeat: undefined,\n    }),\n  )\n\n  function startHandshake(channel: ChannelsControllerChannel<T>) {\n    channel.id = uuid()\n    channel.interval = window.setInterval(() => {\n      sendHandshake(channel, 'handshake/syn', { id: channel.id })\n    }, HANDSHAKE_INTERVAL)\n  }\n\n  function stopHandshake(channel: ChannelsControllerChannel<T>) {\n    window.clearInterval(channel.interval)\n  }\n\n  function isValidMessageEvent(\n    e: MessageEvent,\n  ): e is MessageEvent<ProtocolMsg<T>> {\n    const { data, origin } = e\n    return (\n      data.domain === 'sanity/channels' &&\n      data.to == config.id &&\n      channels.map((channel) => channel.config.id).includes(data.from) &&\n      data.type !== 'channel/response' &&\n      origin === config.targetOrigin\n    )\n  }\n\n  function handshakeHandler(e: MessageEvent<ProtocolMsg<T>>) {\n    const { data } = e\n    if (isHandshakeMessage(data.type)) {\n      const channel = channels.find(\n        (channel) => channel.config.id === data.from,\n      )\n      if (channel && data.type === 'handshake/syn-ack') {\n        setChannelStatus(channel, 'connected')\n        sendHandshake(channel, 'handshake/ack', { id: channel.id })\n      }\n    }\n  }\n\n  const messageHandler = (e: MessageEvent<ProtocolMsg<T>>) => {\n    const { data } = e\n    if (\n      !isHandshakeMessage(data.type) &&\n      channels.find((channel) => channel.id === data.connectionId)\n    ) {\n      const channel = channels.find(\n        (channel) => channel.config.id === data.from,\n      )\n      if (channel) {\n        // eslint-disable-next-line no-warning-comments\n        // @todo Ugly type casting\n        const args = [data.type, data.data] as ToArgs<T>\n        channel.config.onEvent?.(...args)\n        config.onEvent?.(...args)\n        send(channel, 'channel/response', { responseTo: data.id }, false)\n      }\n    }\n  }\n\n  function handleEvents(e: MessageEvent<ProtocolMsg<T>>) {\n    if (isLegacyHandshakeMessage(e)) {\n      // eslint-disable-next-line no-console\n      console.error(\n        'Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\\nhttps://github.com/sanity-io/visual-editing',\n      )\n      return\n    }\n\n    if (isValidMessageEvent(e)) {\n      const { data } = e\n      channels.find((channel) => channel.config.id === data.from)?.handler(e)\n    }\n  }\n\n  function flush(channel: ChannelsControllerChannel<T>) {\n    const toFlush = [...channel.buffer]\n    channel.buffer.splice(0, channel.buffer.length)\n    toFlush.forEach(({ type, data }) => {\n      send(channel, type, data)\n    })\n  }\n\n  function startHeartbeat(channel: ChannelsControllerChannel<T>) {\n    stopHeartbeat(channel)\n    if (channel.config.heartbeat) {\n      const heartbeatInverval =\n        typeof channel.config.heartbeat === 'number'\n          ? channel.config.heartbeat\n          : HEARTBEAT_INTERVAL\n      channel.heartbeat = window.setInterval(() => {\n        send(channel, 'channel/heartbeat')\n      }, heartbeatInverval)\n    }\n  }\n\n  function stopHeartbeat(channel: ChannelsControllerChannel<T>) {\n    if (channel.heartbeat) {\n      window.clearInterval(channel.heartbeat)\n    }\n  }\n\n  function setChannelStatus(\n    channel: ChannelsControllerChannel<T>,\n    next: ChannelStatus,\n  ) {\n    channel.status = next\n    channel.config.onStatusUpdate?.(next, channel.config.id)\n    config.onStatusUpdate?.(next, channel.config.id)\n    if (next === 'connecting' || next === 'reconnecting') {\n      channel.handler = handshakeHandler\n      stopHeartbeat(channel)\n      startHandshake(channel)\n    } else if (next === 'connected') {\n      channel.handler = messageHandler\n      stopHandshake(channel)\n      startHeartbeat(channel)\n      flush(channel)\n    } else if (next === 'disconnected') {\n      channel.id = null\n      channel.handler = handshakeHandler\n      stopHandshake(channel)\n      stopHeartbeat(channel)\n    }\n  }\n\n  function sendHandshake<K extends T['type']>(\n    channel: ChannelsControllerChannel<T>,\n    type: K,\n    data?: Extract<T, { type: K }>['data'],\n  ) {\n    if (!channel.id) {\n      throw new Error('No channel ID set')\n    }\n\n    const msg: ProtocolMsg<T> = {\n      connectionId: channel.id,\n      data,\n      domain: 'sanity/channels',\n      from: config.id,\n      id: uuid(),\n      to: channel.config.id,\n      type,\n    }\n\n    try {\n      target?.postMessage(msg, { targetOrigin: '*' })\n    } catch (e) {\n      throw new Error(`Failed to postMessage '${msg.id}' on '${config.id}'`)\n    }\n  }\n\n  function send<K extends T['type']>(\n    channel: ChannelsControllerChannel<T>,\n    type: K | InternalMsgType,\n    data?: Extract<T, { type: K }>['data'],\n    expectResponse = true,\n  ) {\n    const id = uuid()\n\n    // If there is no active channel, push to the buffer\n    if (\n      channel.status === 'connecting' ||\n      channel.status === 'reconnecting' ||\n      channel.status === 'disconnected'\n    ) {\n      channel.buffer.push({ type, data })\n      return\n    }\n\n    if (!channel.id) {\n      throw new Error('No channel ID set')\n    }\n\n    const msg: ProtocolMsg<T> = {\n      connectionId: channel.id,\n      data,\n      domain: 'sanity/channels',\n      from: config.id,\n      id,\n      to: channel.config.id,\n      type,\n    }\n\n    if (expectResponse) {\n      const maxWait = setTimeout(() => {\n        // The channel may have changed, so only reject if the IDs match\n        if (msg.connectionId === channel.id) {\n          // Cleanup the transaction listener\n          window.removeEventListener('message', transact, false)\n          // Push the message to the buffer\n          if (type !== 'channel/heartbeat') {\n            channel.buffer.push({ type, data })\n          }\n          // Try to reconnect\n          setChannelStatus(channel, 'reconnecting')\n          // eslint-disable-next-line no-console\n          console.warn(\n            `Received no response to message '${msg.type}' on client '${config.id}' (ID: '${msg.id}').`,\n          )\n        }\n      }, RESPONSE_TIMEOUT)\n\n      const transact = (e: MessageEvent<ChannelMsg>) => {\n        const { data: eventData } = e\n        if (\n          eventData.type === 'channel/response' &&\n          eventData.data?.responseTo &&\n          eventData.data.responseTo === msg.id\n        ) {\n          window.removeEventListener('message', transact, false)\n          clearTimeout(maxWait)\n        }\n      }\n      window.addEventListener('message', transact, false)\n    }\n\n    try {\n      target?.postMessage(msg, { targetOrigin: config.targetOrigin })\n    } catch (e) {\n      throw new Error(\n        `Failed to postMessage '${msg.id}' on client '${config.id}'`,\n      )\n    }\n  }\n\n  function disconnect() {\n    channels.forEach((channel) => {\n      if (['disconnected'].includes(channel.status)) return\n      send(channel, 'channel/disconnect', { id: channel.id }, false)\n      setChannelStatus(channel, 'disconnected')\n    })\n  }\n\n  function destroy() {\n    disconnect()\n    window.removeEventListener('message', handleEvents, false)\n    channels.forEach((channel) => {\n      stopHeartbeat(channel)\n      stopHandshake(channel)\n    })\n  }\n\n  function initialise() {\n    window.addEventListener('message', handleEvents, false)\n    channels.forEach((channel) => {\n      setChannelStatus(channel, 'connecting')\n    })\n  }\n\n  initialise()\n\n  function sendPublic<K extends T['type']>(\n    id: string | string[] | undefined,\n    type: K,\n    data?: Extract<T, { type: K }>['data'],\n  ) {\n    const channelsToSend = id ? (Array.isArray(id) ? [...id] : [id]) : channels\n\n    channelsToSend.forEach((id) => {\n      const channel = channels.find((channel) => channel.config.id === id)\n      if (!channel) throw new Error('Invalid channel ID')\n      send(channel, type, data)\n    })\n  }\n\n  return {\n    destroy,\n    send: sendPublic,\n  }\n}\n","function n(n){return\"object\"==typeof n&&null!==n&&!Array.isArray(n)}function t(n){return null!==n&&Array.isArray(n)}function o(n){let o=\"\";for(const e of n)\"string\"!=typeof e?\"number\"!=typeof e?t(e)?(o&&(o+=\":\"),o+=\"\".concat(e.join(\",\"),\"}\")):e._key&&(o&&(o+=\":\"),o+=\"\".concat(e._key)):(o&&(o+=\":\"),o+=\"\".concat(e)):(o&&(o+=\".\"),o+=e);return o}const e=/^([A-Za-z]+):([0-9]+)$/,r=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,c=/^([A-Za-z]+):([a-z0-9]+)$/;function u(n){const t=[];for(const o of n.split(\".\")){const n=e.exec(o);if(n){t.push(n[1],Number(n[2]));continue}const u=r.exec(o);if(u){t.push(u[1],[Number(u[2]),Number(u[3])]);continue}const s=c.exec(o);s?t.push(s[1],{_key:s[2]}):t.push(o)}return t}export{t as a,n as i,o as p,u};//# sourceMappingURL=urlStringToPath-53ZuVkUF.js.map\n","export{p as pathToUrlString,u as urlStringToPath}from\"./_chunks/urlStringToPath-53ZuVkUF.js\";function t(t,n){return\"\".concat(t,\"-\").concat(\"string\"==typeof n?n:JSON.stringify(n))}const n=\"undefined\"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),r={alt:\"altKey\",ctrl:\"ctrlKey\",mod:n?\"metaKey\":\"ctrlKey\",shift:\"shiftKey\"};function e(t,n){return t.every((t=>r[t]?n[r[t]]:n.key===t.toUpperCase()))}function o(t){return t.key===(n?\"Meta\":\"Ctrl\")}function i(t){return\"Alt\"===t.key}export{t as getQueryCacheKey,i as isAltKey,e as isHotkey,o as isModKey};//# sourceMappingURL=index.js.map\n","import { studioPath } from '@sanity/client/csm'\nimport { urlStringToPath } from '@sanity/visual-editing-helpers'\n\nimport type { PresentationStateParams } from '../types'\n\nexport function parseId(rawId: string | undefined): string | undefined {\n  if (rawId === undefined) {\n    return undefined\n  }\n\n  const segments = decodeURIComponent(rawId)?.split('.')\n\n  if (segments[0] === 'drafts') {\n    segments.shift()\n  }\n\n  return segments.join('.')\n}\n\nexport function parsePath(rawPath: string | undefined): string | undefined {\n  if (rawPath === undefined) {\n    return undefined\n  }\n\n  return studioPath.toString(urlStringToPath(decodeURIComponent(rawPath)))\n}\n\nexport function parseRouterState(\n  state: PresentationStateParams,\n): PresentationStateParams {\n  return {\n    id: parseId(state.id),\n    path: parsePath(state.path),\n    type: state.type,\n  }\n}\n","import {\n  Box,\n  Button,\n  Card,\n  CardProps,\n  Container,\n  Flex,\n  Inline,\n  Stack,\n  Text,\n} from '@sanity/ui'\nimport { ReactElement, ReactNode } from 'react'\n\nexport function ErrorCard(\n  props: {\n    children?: ReactNode\n    message: string\n    onRetry?: () => void\n    onContinueAnyway?: () => void\n  } & CardProps,\n): ReactElement {\n  const { children, message, onRetry, onContinueAnyway, ...restProps } = props\n\n  const retryButton = (\n    <Button fontSize={1} mode=\"ghost\" onClick={onRetry} text=\"Retry\" />\n  )\n  const continueAnywayButton = (\n    <Button\n      fontSize={1}\n      mode=\"ghost\"\n      tone=\"critical\"\n      onClick={onContinueAnyway}\n      text=\"Continue anyway\"\n    />\n  )\n\n  return (\n    <Card height=\"fill\" {...restProps}>\n      <Flex align=\"center\" height=\"fill\" justify=\"center\">\n        <Container padding={4} sizing=\"border\" width={0}>\n          <Stack space={4}>\n            <Stack space={3}>\n              <Text size={1} weight=\"semibold\">\n                An error occured\n              </Text>\n              <Text muted size={1}>\n                {message}\n              </Text>\n            </Stack>\n\n            {children}\n\n            {onRetry && onContinueAnyway ? (\n              <Inline space={2}>\n                {retryButton}\n                {continueAnywayButton}\n              </Inline>\n            ) : onRetry ? (\n              <Box>{retryButton}</Box>\n            ) : onContinueAnyway ? (\n              <Box>{continueAnywayButton}</Box>\n            ) : null}\n          </Stack>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","import { useContext } from 'react'\n\nimport {\n  PresentationContext,\n  PresentationContextValue,\n} from './PresentationContext'\n\nexport function usePresentationTool(): PresentationContextValue {\n  const presentation = useContext(PresentationContext)\n\n  if (!presentation) {\n    throw new Error('Presentation context is missing')\n  }\n\n  return presentation\n}\n","/* eslint-disable no-console */\n\nimport {\n  forwardRef,\n  PropsWithChildren,\n  ReactElement,\n  useCallback,\n  useMemo,\n} from 'react'\nimport { getPublishedId, useUnique } from 'sanity'\nimport { StateLink, useRouter } from 'sanity/router'\nimport {\n  BackLinkProps,\n  PaneRouterContext,\n  PaneRouterContextValue,\n  ReferenceChildLinkProps,\n} from 'sanity/structure'\n\nimport { DeskDocumentPaneParams, PresentationParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\n\nfunction encodeQueryString(params: Record<string, unknown> = {}): string {\n  const parts = Object.entries(params)\n    .map(([key, value]) => `${key}=${value}`)\n    .join('&')\n\n  return parts.length ? `?${parts}` : ''\n}\n\nfunction resolveQueryStringFromParams(\n  nextParams: Record<string, string | undefined>,\n) {\n  const allowed = [\n    'comment',\n    'inspect',\n    'instruction',\n    'pathKey',\n    'rev',\n    'since',\n    'template',\n    'view',\n  ] satisfies Array<keyof PresentationParams> as string[]\n\n  const safeNextParams = Object.entries(nextParams)\n    .filter(([key]) => allowed.includes(key))\n    .reduce((obj, [key, value]) => {\n      if (value == undefined) return obj\n      return { ...obj, [key]: value }\n    }, {})\n\n  return encodeQueryString(safeNextParams)\n}\n\nconst BackLink = forwardRef(function BackLink(\n  props: BackLinkProps,\n  ref: React.ForwardedRef<HTMLAnchorElement>,\n) {\n  const { deskParams, params } = usePresentationTool()\n\n  return (\n    <StateLink\n      {...props}\n      ref={ref}\n      state={{\n        type: undefined,\n        _searchParams: Object.entries({\n          ...deskParams,\n          preview: params.preview,\n        }),\n      }}\n      title={undefined}\n    />\n  )\n})\n\nconst ReferenceChildLink = forwardRef(function ReferenceChildLink(\n  props: ReferenceChildLinkProps,\n  ref: React.ForwardedRef<HTMLAnchorElement>,\n) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { documentId, documentType, parentRefPath, template, ...restProps } =\n    props\n\n  return (\n    <StateLink\n      {...restProps}\n      ref={ref}\n      state={{ id: documentId, type: documentType }}\n      title={undefined}\n    />\n  )\n})\n\nexport function PresentationPaneRouterProvider(\n  props: PropsWithChildren<{\n    onDeskParams: (params: DeskDocumentPaneParams) => void\n    params: DeskDocumentPaneParams\n    previewUrl?: string\n    refs?: { _id: string; _type: string }[]\n  }>,\n): ReactElement {\n  const { children, params, onDeskParams, previewUrl, refs } = props\n\n  const { state: routerState, resolvePathFromState } = useRouter()\n\n  const routerSearchParams = useUnique(\n    Object.fromEntries(routerState._searchParams || []),\n  )\n\n  const createPathWithParams: PaneRouterContextValue['createPathWithParams'] =\n    useCallback(\n      (nextParams) => {\n        const path = resolvePathFromState(routerState)\n        const qs = resolveQueryStringFromParams({\n          ...routerSearchParams,\n          ...nextParams,\n        })\n        return `${path}${qs}`\n      },\n      [resolvePathFromState, routerSearchParams, routerState],\n    )\n\n  const context: PaneRouterContextValue = useMemo(() => {\n    return {\n      index: 0,\n      groupIndex: 0,\n      siblingIndex: 0,\n      payload: {},\n      params: params as any,\n      hasGroupSiblings: false,\n      groupLength: 1,\n      routerPanesState: [],\n      ChildLink: (childLinkProps) => {\n        const { childId, ...restProps } = childLinkProps\n        const ref = refs?.find((r) => getPublishedId(r._id) === childId)\n\n        if (ref) {\n          return (\n            <StateLink\n              {...restProps}\n              state={{\n                id: ref._id,\n                type: ref._type,\n                _searchParams: Object.entries({ preview: previewUrl }),\n              }}\n            />\n          )\n        }\n\n        return <div {...restProps} />\n      },\n      BackLink,\n      ReferenceChildLink,\n      ParameterizedLink: () => <>ParameterizedLink</>,\n      closeCurrentAndAfter: () => {\n        console.warn('closeCurrentAndAfter')\n      },\n      handleEditReference: (options) => {\n        console.warn('handleEditReference', options)\n      },\n      replaceCurrent: (pane) => {\n        console.warn('replaceCurrent', pane)\n      },\n      closeCurrent: () => {\n        console.warn('closeCurrent')\n      },\n      duplicateCurrent: (pane) => {\n        console.warn('duplicateCurrent', pane)\n      },\n      setView: (viewId) => {\n        console.warn('setView', viewId)\n      },\n      setParams: (nextParams) => {\n        // eslint-disable-next-line no-warning-comments\n        // @todo set inspect param to undefined manually as param is missing from object when closing inspector\n        onDeskParams({\n          ...nextParams,\n          inspect: nextParams.inspect ?? undefined,\n        } as DeskDocumentPaneParams)\n      },\n      setPayload: (payload) => {\n        console.warn('setPayload', payload)\n      },\n      navigateIntent: (intentName, intentParams, options) => {\n        console.warn('navigateIntent', intentName, intentParams, options)\n      },\n      createPathWithParams,\n    }\n  }, [createPathWithParams, onDeskParams, params, previewUrl, refs])\n\n  return (\n    <PaneRouterContext.Provider value={context}>\n      {children}\n    </PaneRouterContext.Provider>\n  )\n}\n","import { Card, Code, ErrorBoundary, Flex, Label, Stack } from '@sanity/ui'\nimport {\n  ErrorInfo,\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport {\n  DocumentListPane as DeskDocumentListPane,\n  PaneLayout,\n  PaneNode,\n  StructureToolProvider,\n} from 'sanity/structure'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { DeskDocumentPaneParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { PresentationPaneRouterProvider } from './PresentationPaneRouterProvider'\n\nconst RootLayout = styled(PaneLayout)`\n  height: 100%;\n`\n\nconst Root = styled(Flex)`\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n`\n\nconst WrappedCode = styled(Code)`\n  white-space: pre-wrap;\n`\n\nexport function DocumentListPane(props: {\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const { onDeskParams, previewUrl, refs } = props\n  const { devMode } = usePresentationTool()\n\n  const pane: Extract<PaneNode, { type: 'documentList' }> = useMemo(\n    () => ({\n      id: '$root',\n      options: {\n        filter: '_id in $ids',\n        params: { ids: refs.map((r) => r._id) },\n        // defaultOrdering: [{ field: '_updatedAt', direction: 'desc' }],\n      },\n      schemaTypeName: '',\n      title: 'Documents on this page',\n      type: 'documentList',\n    }),\n    [refs],\n  )\n\n  const [errorParams, setErrorParams] = useState<{\n    info: ErrorInfo\n    error: Error\n  } | null>(null)\n\n  const handleRetry = useCallback(() => setErrorParams(null), [])\n\n  const [deskParams] = useState(() => ({}))\n\n  // Reset error state when `refs` value schanges\n  useEffect(() => setErrorParams(null), [refs])\n\n  if (errorParams) {\n    return (\n      <ErrorCard\n        flex={1}\n        message=\"Could not render the document list\"\n        onRetry={handleRetry}\n      >\n        {devMode && (\n          // show runtime error message in dev mode\n          <Card overflow=\"auto\" padding={3} radius={2} tone=\"critical\">\n            <Stack space={3}>\n              <Label muted size={0}>\n                Error message\n              </Label>\n              <WrappedCode size={1}>{errorParams.error.message}</WrappedCode>\n            </Stack>\n          </Card>\n        )}\n      </ErrorCard>\n    )\n  }\n\n  return (\n    <ErrorBoundary onCatch={setErrorParams}>\n      <RootLayout>\n        <StructureToolProvider>\n          <PresentationPaneRouterProvider\n            params={deskParams}\n            onDeskParams={onDeskParams}\n            previewUrl={previewUrl}\n            refs={refs}\n          >\n            <Root direction=\"column\" flex={1}>\n              <DeskDocumentListPane\n                index={0}\n                itemId=\"$root\"\n                pane={pane}\n                paneKey=\"$root\"\n              />\n            </Root>\n          </PresentationPaneRouterProvider>\n        </StructureToolProvider>\n      </RootLayout>\n    </ErrorBoundary>\n  )\n}\n","import { ReactElement, useMemo } from 'react'\n\nimport { parseId } from '../lib/parse'\nimport { DeskDocumentPaneParams } from '../types'\nimport { DocumentListPane } from './DocumentListPane'\n\nexport function DocumentListPanel(props: {\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const { onDeskParams, previewUrl, refs } = props\n\n  const refsWithParsedIds = useMemo(\n    () =>\n      refs.map(({ _id, _type }) => ({\n        _id: parseId(_id)!,\n        _type,\n      })),\n    [refs],\n  )\n\n  return (\n    <DocumentListPane\n      onDeskParams={onDeskParams}\n      previewUrl={previewUrl}\n      refs={refsWithParsedIds}\n    />\n  )\n}\n","import { Card, Code, ErrorBoundary, Label, Stack } from '@sanity/ui'\nimport {\n  ErrorInfo,\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { Path } from 'sanity'\nimport {\n  DocumentPane as DeskDocumentPane,\n  DocumentPaneNode,\n  PaneLayout,\n  useStructureTool,\n} from 'sanity/structure'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { DeskDocumentPaneParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { PresentationPaneRouterProvider } from './PresentationPaneRouterProvider'\n\nconst WrappedCode = styled(Code)`\n  white-space: pre-wrap;\n`\n\nexport function DocumentPane(props: {\n  documentId: string\n  documentType: string\n  params: DeskDocumentPaneParams\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (path: Path) => void\n}): ReactElement {\n  const { documentId, documentType, params, onDeskParams, onFocusPath } = props\n  const { devMode } = usePresentationTool()\n\n  const paneDocumentNode: DocumentPaneNode = useMemo(\n    () => ({\n      id: documentId,\n      options: {\n        id: documentId,\n        type: documentType,\n      },\n      title: '',\n      type: 'document',\n    }),\n    [documentId, documentType],\n  )\n\n  const [errorParams, setErrorParams] = useState<{\n    info: ErrorInfo\n    error: Error\n  } | null>(null)\n\n  const handleRetry = useCallback(() => setErrorParams(null), [])\n\n  // Reset error state when parameters change\n  useEffect(() => {\n    setErrorParams(null)\n  }, [documentId, documentType, params])\n\n  const { setLayoutCollapsed } = useStructureTool()\n  const handleRootCollapse = useCallback(\n    () => setLayoutCollapsed(true),\n    [setLayoutCollapsed],\n  )\n  const handleRootExpand = useCallback(\n    () => setLayoutCollapsed(false),\n    [setLayoutCollapsed],\n  )\n\n  if (errorParams) {\n    return (\n      <ErrorCard\n        flex={1}\n        message=\"Could not render the document editor\"\n        onRetry={handleRetry}\n      >\n        {devMode && (\n          // show runtime error message in dev mode\n          <Card overflow=\"auto\" padding={3} radius={2} tone=\"critical\">\n            <Stack space={3}>\n              <Label muted size={0}>\n                Error message\n              </Label>\n              <WrappedCode size={1}>{errorParams.error.message}</WrappedCode>\n            </Stack>\n          </Card>\n        )}\n      </ErrorCard>\n    )\n  }\n\n  return (\n    <ErrorBoundary onCatch={setErrorParams}>\n      <PaneLayout\n        style={{ height: '100%' }}\n        onExpand={handleRootExpand}\n        onCollapse={handleRootCollapse}\n      >\n        <PresentationPaneRouterProvider\n          onDeskParams={onDeskParams}\n          params={params}\n        >\n          <DeskDocumentPane\n            paneKey=\"document\"\n            index={1}\n            itemId=\"document\"\n            pane={paneDocumentNode}\n            onFocusPath={onFocusPath}\n          />\n        </PresentationPaneRouterProvider>\n      </PaneLayout>\n    </ErrorBoundary>\n  )\n}\n","import { type ReactElement } from 'react'\nimport { type Path } from 'sanity'\nimport { StructureToolProvider } from 'sanity/structure'\n\nimport { DeskDocumentPaneParams } from '../types'\nimport { DocumentPane } from './DocumentPane'\n\nexport function DocumentPanel(props: {\n  deskParams: DeskDocumentPaneParams\n  documentId: string\n  documentType: string\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (path: Path) => void\n}): ReactElement {\n  const { deskParams, documentId, documentType, onDeskParams, onFocusPath } =\n    props\n  return (\n    <StructureToolProvider>\n      <DocumentPane\n        documentId={documentId}\n        documentType={documentType}\n        params={deskParams}\n        onDeskParams={onDeskParams}\n        onFocusPath={onFocusPath}\n      />\n    </StructureToolProvider>\n  )\n}\n","import { type ReactElement } from 'react'\nimport { type Path } from 'sanity'\n\nimport type { DeskDocumentPaneParams } from '../types'\nimport { DocumentListPanel } from './DocumentListPanel'\nimport { DocumentPanel } from './DocumentPanel'\n\nexport function ContentEditor(props: {\n  deskParams: DeskDocumentPaneParams\n  documentId?: string\n  documentType?: string\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (path: Path) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const {\n    deskParams,\n    documentId,\n    documentType,\n    onDeskParams,\n    onFocusPath,\n    previewUrl,\n    refs,\n  } = props\n\n  if (documentId && documentType) {\n    return (\n      <DocumentPanel\n        deskParams={deskParams}\n        documentId={documentId}\n        documentType={documentType}\n        onDeskParams={onDeskParams}\n        onFocusPath={onFocusPath}\n      />\n    )\n  }\n\n  return (\n    <DocumentListPanel\n      onDeskParams={onDeskParams}\n      previewUrl={previewUrl}\n      refs={refs}\n    />\n  )\n}\n","import { createContext, type CSSProperties } from 'react'\n\nimport { PanelElement, ResizerElement } from './types'\n\nexport const PanelsContext = createContext<{\n  activeResizer: string | null\n  drag: (id: string, event: MouseEvent) => void\n  getPanelStyle: (id: string) => CSSProperties\n  registerElement: (id: string, panel: PanelElement | ResizerElement) => void\n  startDragging: (id: string, event: MouseEvent) => void\n  stopDragging: () => void\n  unregisterElement: (id: string) => void\n} | null>(null)\n\nPanelsContext.displayName = 'PanelsContext'\n","import {\n  FunctionComponent,\n  PropsWithChildren,\n  useContext,\n  useLayoutEffect,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\n\ninterface PanelProps extends PropsWithChildren {\n  defaultSize?: number | null\n  id: string\n  minWidth?: number\n  maxWidth?: number\n  order?: number\n}\n\nconst Root = styled.div`\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n`\n\nexport const Panel: FunctionComponent<PanelProps> = function ({\n  children,\n  defaultSize = null,\n  id,\n  minWidth,\n  maxWidth,\n  order = 0,\n}) {\n  const context = useContext(PanelsContext)\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const { getPanelStyle, registerElement, unregisterElement } = context\n\n  const style = getPanelStyle(id)\n\n  useLayoutEffect(() => {\n    registerElement(id, {\n      id,\n      type: 'panel',\n      defaultSize,\n      maxWidth: maxWidth ?? null,\n      minWidth: minWidth ?? 0,\n      order,\n    })\n\n    return () => {\n      unregisterElement(id)\n    }\n  }, [\n    id,\n    defaultSize,\n    order,\n    maxWidth,\n    minWidth,\n    registerElement,\n    unregisterElement,\n  ])\n\n  return <Root style={style}>{children}</Root>\n}\n","import {\n  type FunctionComponent,\n  MouseEvent as ReactMouseEvent,\n  useCallback,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\nimport { usePanelId } from './usePanelId'\n\nconst Resizer = styled.div`\n  position: relative;\n`\nconst ResizerInner = styled.div<{\n  $disabled: boolean\n}>`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ${({ $disabled }) => ($disabled ? 'auto' : 'ew-resize')};\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ${({ $disabled }) =>\n    !$disabled &&\n    `\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  `}\n`\n\nexport const PanelResizer: FunctionComponent<{\n  id?: string\n  order: number\n  disabled?: boolean\n}> = function ({ id: propId, order, disabled = false }) {\n  const el = useRef<HTMLDivElement>(null)\n\n  const context = useContext(PanelsContext)\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const id = usePanelId(propId)\n\n  const {\n    activeResizer,\n    drag,\n    startDragging,\n    stopDragging,\n    registerElement,\n    unregisterElement,\n  } = context\n\n  const isDragging = activeResizer === id\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const onMouseDown = useCallback(\n    (event: ReactMouseEvent) => {\n      startDragging(id, event.nativeEvent)\n    },\n    [id, startDragging],\n  )\n\n  const onDrag = useCallback(\n    (e: MouseEvent) => {\n      drag(id, e)\n    },\n    [id, drag],\n  )\n\n  const onDragStop = useCallback(() => {\n    el.current!.blur()\n    stopDragging()\n  }, [stopDragging])\n\n  useEffect(() => {\n    if (!isDragging || disabled) return\n\n    window.addEventListener('mousemove', onDrag)\n    window.addEventListener('mouseup', onDragStop)\n\n    return () => {\n      window.removeEventListener('mousemove', onDrag)\n      window.removeEventListener('mouseup', onDragStop)\n    }\n  }, [disabled, isDragging, onDrag, onDragStop])\n\n  useLayoutEffect(() => {\n    registerElement(id, { id, order, type: 'resizer', el })\n\n    return () => {\n      unregisterElement(id)\n    }\n  }, [id, order, registerElement, unregisterElement])\n\n  return (\n    <Resizer onMouseDown={onMouseDown} ref={el}>\n      <ResizerInner $disabled={disabled}>\n        <span />\n        <span />\n      </ResizerInner>\n    </Resizer>\n  )\n}\n","import { useRef } from 'react'\nimport { v4 as uuid } from 'uuid'\n\nexport function usePanelId(id?: string): string {\n  const idRef = useRef(id || uuid())\n  return idRef.current\n}\n","export function debounce<F extends (...args: any[]) => void>(\n  fn: F,\n  timeout: number,\n): F {\n  let timer: any\n  return ((...args: any[]) => {\n    clearTimeout(timer)\n    timer = setTimeout(() => {\n      fn.apply(fn, args)\n    }, timeout)\n  }) as F\n}\n","import { useMemo } from 'react'\n\nimport { debounce } from '../lib/debounce'\nimport { PanelElement } from './types'\n\nconst itemKey = 'presentation/panels'\n\ntype StoredPanelsState = Record<string, number[]>\n\nconst getStoredItem = () => {\n  // @todo Validate\n  return JSON.parse(localStorage.getItem(itemKey) || '{}') as StoredPanelsState\n}\nconst setStoredItem = (data: StoredPanelsState) => {\n  localStorage.setItem(itemKey, JSON.stringify(data))\n}\n\nconst getKeyForPanels = (panels: PanelElement[]) => {\n  return panels.map((panel) => [panel.id, panel.order].join(':')).join(',')\n}\n\nexport function usePanelsStorage(): {\n  get: (panels: PanelElement[]) => number[]\n  set: (panels: PanelElement[], widths: number[]) => void\n  setDebounced: (panels: PanelElement[], widths: number[]) => void\n} {\n  return useMemo(() => {\n    const get = (panels: PanelElement[]) => {\n      const stored = getStoredItem()\n      const key = getKeyForPanels(panels)\n      return stored[key]\n    }\n\n    const set = (panels: PanelElement[], widths: number[]) => {\n      const stored = getStoredItem()\n      const key = getKeyForPanels(panels)\n      const data = {\n        ...stored,\n        [key]: widths,\n      }\n      setStoredItem(data)\n    }\n\n    const setDebounced = debounce(set, 100)\n    return {\n      get,\n      set,\n      setDebounced,\n    }\n  }, [])\n}\n","import {\n  ElementMap,\n  InitialDragState,\n  PanelElement,\n  PanelsState,\n  ResizerElement,\n} from './types'\n\nfunction getNextWidth(\n  panel: PanelElement,\n  nextWidth: number,\n  containerWidth: number,\n) {\n  const { maxWidth: maxWidthPx, minWidth: minWidthPx } = panel\n  const maxWidth =\n    maxWidthPx == null ? 100 : (maxWidthPx / containerWidth) * 100\n  const minWidth = (minWidthPx / containerWidth) * 100\n  return Math.min(maxWidth, Math.max(minWidth, nextWidth))\n}\n\nexport function getNextWidths(\n  delta: number,\n  containerWidth: number,\n  panelBefore: PanelElement,\n  panelAfter: PanelElement,\n  panelsState: PanelsState,\n  initialDragState: InitialDragState,\n): number[] {\n  const { panels, widths: prevWidths } = panelsState\n  const { widths: initialWidths } = initialDragState\n\n  const widths = initialWidths || prevWidths\n  const nextWidths = [...widths]\n\n  {\n    const pivotPanel = delta < 0 ? panelAfter : panelBefore\n    const index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n    const width = widths[index]\n    const nextWidth = getNextWidth(\n      pivotPanel,\n      width + Math.abs(delta),\n      containerWidth,\n    )\n    if (width === nextWidth) {\n      return widths\n    } else {\n      delta = delta < 0 ? width - nextWidth : nextWidth - width\n    }\n  }\n\n  let deltaApplied = 0\n  let pivotPanel = delta < 0 ? panelBefore : panelAfter\n  let index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const panel = panels[index]\n    const width = widths[index]\n\n    const deltaRemaining = Math.abs(delta) - Math.abs(deltaApplied)\n\n    const nextWidth = getNextWidth(\n      panel,\n      width - deltaRemaining,\n      containerWidth,\n    )\n\n    if (width !== nextWidth) {\n      deltaApplied += width - nextWidth\n      nextWidths[index] = nextWidth\n\n      if (\n        deltaApplied\n          .toPrecision(10)\n          .localeCompare(Math.abs(delta).toPrecision(10), undefined, {\n            numeric: true,\n          }) >= 0\n      ) {\n        break\n      }\n    }\n\n    if (delta < 0) {\n      if (--index < 0) {\n        break\n      }\n    } else {\n      if (++index >= panels.length) {\n        break\n      }\n    }\n  }\n\n  if (deltaApplied === 0) {\n    return widths\n  }\n\n  pivotPanel = delta < 0 ? panelAfter : panelBefore\n  index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n  nextWidths[index] = widths[index] + deltaApplied\n\n  return nextWidths\n}\n\nexport function getPanelWidth(\n  panels: PanelElement[],\n  id: string,\n  widths: number[],\n): string {\n  if (panels.length === 1) return '100'\n\n  const index = panels.findIndex((panel) => panel.id === id)\n  const width = widths[index]\n\n  if (width == null) return '0'\n\n  return width.toPrecision(10)\n}\n\nexport function getOffset(\n  event: MouseEvent,\n  handleElement: HTMLDivElement,\n  initialOffset: number = 0,\n  initialHandleElementRect: DOMRect | null = null,\n): number {\n  const pointerOffset = event.clientX\n\n  const rect = initialHandleElementRect || handleElement.getBoundingClientRect()\n  const elementOffset = rect.left\n\n  return pointerOffset - elementOffset - initialOffset\n}\n\nexport function isPanel(\n  element: PanelElement | ResizerElement,\n): element is PanelElement {\n  return element.type === 'panel'\n}\n\nexport function isResizer(\n  element: PanelElement | ResizerElement,\n): element is ResizerElement {\n  return element.type === 'resizer'\n}\n\nexport function getSortedElements(\n  elements: ElementMap,\n): Array<PanelElement | ResizerElement> {\n  return Array.from(elements.values()).sort(({ order: a }, { order: b }) => {\n    if (a == null && b == null) return 0\n    if (a == null) return -1\n    if (b == null) return 1\n    return a - b\n  })\n}\n\nexport function validateWidths(\n  panels: PanelElement[],\n  widthsToValidate: number[],\n  containerWidth: number,\n): number[] {\n  // Clamp widths proportionally to total 100\n  const total = widthsToValidate.reduce((total, width) => total + width, 0)\n  const widths = [...widthsToValidate].map((width) => (width / total) * 100)\n\n  let remainingWidth = 0\n\n  for (let index = 0; index < panels.length; index++) {\n    const panel = panels[index]\n    const width = widths[index]\n    const nextWidth = getNextWidth(panel, width, containerWidth)\n    if (width != nextWidth) {\n      remainingWidth += width - nextWidth\n      widths[index] = nextWidth\n    }\n  }\n\n  if (remainingWidth.toFixed(3) !== '0.000') {\n    for (let index = 0; index < panels.length; index++) {\n      const panel = panels[index]\n\n      let { maxWidth, minWidth } = panel\n\n      minWidth = (minWidth / containerWidth) * 100\n      if (maxWidth != null) {\n        maxWidth = (maxWidth / containerWidth) * 100\n      }\n\n      const width = Math.min(\n        maxWidth != null ? maxWidth : 100,\n        Math.max(minWidth, widths[index] + remainingWidth),\n      )\n\n      if (width !== widths[index]) {\n        remainingWidth -= width - widths[index]\n        widths[index] = width\n\n        if (Math.abs(remainingWidth).toFixed(3) === '0.000') {\n          break\n        }\n      }\n    }\n  }\n\n  return widths\n}\n\nexport function getDefaultWidths(panels: PanelElement[]): number[] {\n  let panelsWithoutWidth = panels.length\n  let remainingWidthTotal = 100\n\n  const widthsWithNulls = panels.map((panel) => {\n    if (panel.defaultSize) {\n      remainingWidthTotal = remainingWidthTotal - panel.defaultSize\n      panelsWithoutWidth = panelsWithoutWidth - 1\n      return panel.defaultSize\n    }\n    return null\n  })\n\n  const defaultWidth = remainingWidthTotal / panelsWithoutWidth\n  const widths = widthsWithNulls.map((width) => {\n    if (width === null) return defaultWidth\n    return width\n  })\n\n  return widths\n}\n","// Slightly modified version of react-resizable-panels\n// https://github.com/bvaughn/react-resizable-panels/tree/main/packages/react-resizable-panels\n\nimport {\n  type CSSProperties,\n  type FunctionComponent,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\nimport {\n  ElementMap,\n  InitialDragState,\n  PanelElement,\n  PanelsState,\n  ResizerElement,\n} from './types'\nimport { usePanelsStorage } from './usePanelsStorage'\nimport {\n  getDefaultWidths,\n  getNextWidths,\n  getOffset,\n  getPanelWidth,\n  getSortedElements,\n  isPanel,\n  isResizer,\n  validateWidths,\n} from './util'\n\nconst PanelsWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n`\n\nexport const Panels: FunctionComponent<PropsWithChildren> = function ({\n  children,\n}) {\n  const panelsEl = useRef<HTMLDivElement | null>(null)\n\n  const [elements, setElements] = useState<ElementMap>(new Map())\n\n  const panels = useMemo(\n    () => getSortedElements(elements).filter(isPanel),\n    [elements],\n  )\n\n  const [widths, setWidths] = useState<number[]>([])\n  const [activeResizer, setActiveResizer] = useState<string | null>(null)\n\n  const panelsRef = useRef<PanelsState>({\n    elements,\n    panels,\n    widths,\n  })\n\n  const getPanelStyle = useCallback(\n    (id: string): CSSProperties => {\n      return {\n        flexGrow: getPanelWidth(panels, id, widths),\n        pointerEvents: activeResizer === null ? undefined : 'none',\n      }\n    },\n    [activeResizer, panels, widths],\n  )\n\n  const registerElement = useCallback(\n    (id: string, data: PanelElement | ResizerElement) => {\n      setElements((prev) => {\n        if (prev.has(id)) return prev\n        const next = new Map(prev)\n        next.set(id, data)\n        return next\n      })\n    },\n    [],\n  )\n  const unregisterElement = useCallback((id: string) => {\n    setElements((prev) => {\n      if (!prev.has(id)) return prev\n      const next = new Map(prev)\n      next.delete(id)\n      return next\n    })\n  }, [])\n\n  const dragRef = useRef<InitialDragState>({\n    containerWidth: window.innerWidth,\n    dragOffset: 0,\n    panelAfter: null,\n    panelBefore: null,\n    resizerIndex: -1,\n    resizerRect: null,\n    startX: 0,\n    widths: [],\n  })\n\n  const startDragging = useCallback(\n    (id: string, event: MouseEvent) => {\n      const elementsArr = getSortedElements(elements)\n      const index = elementsArr.findIndex((el) => el.id === id)\n\n      const resizer = elements.get(id)\n      if (!resizer || !isResizer(resizer)) return\n      const resizeElement = resizer.el.current\n      if (!resizeElement) return\n\n      dragRef.current = {\n        resizerIndex: index,\n        panelBefore: elementsArr.reduce(\n          (acc, el, i) => (isPanel(el) && i < index ? el : acc),\n          null as PanelElement | null,\n        ),\n        panelAfter: elementsArr.reduce(\n          (acc, el, i) => (acc === null && isPanel(el) && i > index ? el : acc),\n          null as PanelElement | null,\n        ),\n        containerWidth: window.innerWidth,\n        startX: event.pageX,\n        dragOffset: getOffset(event, resizeElement),\n        resizerRect: resizeElement.getBoundingClientRect(),\n        widths: panelsRef.current.widths,\n      }\n\n      setActiveResizer(id)\n    },\n    [elements],\n  )\n\n  const stopDragging = useCallback(() => {\n    setActiveResizer(null)\n  }, [])\n\n  const drag = useCallback(\n    (id: string, event: MouseEvent) => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      const {\n        containerWidth,\n        dragOffset,\n        panelBefore,\n        panelAfter,\n        resizerRect,\n      } = dragRef.current\n\n      if (panelBefore == null || panelAfter == null) {\n        return\n      }\n\n      const resizer = elements.get(id)\n      if (!resizer || !isResizer(resizer)) return\n      const resizeElement = resizer.el.current\n      if (!resizeElement) return\n\n      const offset = getOffset(event, resizeElement, dragOffset, resizerRect)\n\n      if (offset === 0) {\n        return\n      }\n\n      const { widths: prevWidths } = panelsRef.current\n      const rect = panelsEl.current!.getBoundingClientRect()\n      const delta = (offset / rect.width) * 100\n\n      const nextWidths = getNextWidths(\n        delta,\n        containerWidth,\n        panelBefore,\n        panelAfter,\n        panelsRef.current,\n        dragRef.current,\n      )\n\n      const widthsChanged = prevWidths.some(\n        (prevWidth, i) => prevWidth !== nextWidths[i],\n      )\n\n      if (widthsChanged) {\n        setWidths(nextWidths)\n      }\n    },\n    [elements],\n  )\n\n  // For setting the panels state\n  useLayoutEffect(() => {\n    panelsRef.current.elements = elements\n    panelsRef.current.panels = panels\n    panelsRef.current.widths = widths\n  }, [elements, panels, widths])\n\n  const storage = usePanelsStorage()\n\n  // For setting default sizing when panels are updated\n  useLayoutEffect(() => {\n    const { widths } = panelsRef.current\n\n    if (widths.length === panels.length) {\n      return\n    }\n\n    const storedWidths = storage.get(panels)\n\n    if (storedWidths) {\n      const validatedStoredWidths = validateWidths(\n        panels,\n        storedWidths,\n        window.innerWidth,\n      )\n      setWidths(validatedStoredWidths)\n      return\n    }\n\n    const defaultWidths = getDefaultWidths(panels)\n    setWidths(defaultWidths)\n  }, [storage, panels])\n\n  // For storing current widths in localStorage\n  useEffect(() => {\n    if (!widths.length) return\n    storage.setDebounced(panels, widths)\n  }, [storage, panels, widths])\n\n  useLayoutEffect(() => {\n    const resizeObserver = new ResizeObserver(() => {\n      const { panels, widths: prevWidths } = panelsRef.current\n\n      const nextWidths = validateWidths(panels, prevWidths, window.innerWidth)\n\n      const widthsChanged = prevWidths.some(\n        (prevWidth, i) => prevWidth !== nextWidths[i],\n      )\n      if (widthsChanged) {\n        setWidths(nextWidths)\n      }\n    })\n\n    resizeObserver.observe(panelsEl.current!)\n\n    return () => {\n      resizeObserver.disconnect()\n    }\n  }, [])\n\n  const context = useMemo(\n    () => ({\n      activeResizer,\n      drag,\n      getPanelStyle,\n      registerElement,\n      startDragging,\n      stopDragging,\n      unregisterElement,\n    }),\n    [\n      activeResizer,\n      drag,\n      getPanelStyle,\n      registerElement,\n      startDragging,\n      stopDragging,\n      unregisterElement,\n    ],\n  )\n\n  return (\n    <PanelsContext.Provider value={context}>\n      <PanelsWrapper ref={panelsEl}>{children}</PanelsWrapper>\n    </PanelsContext.Provider>\n  )\n}\n","import { FunctionComponent, PropsWithChildren, useCallback } from 'react'\n\nimport {\n  PresentationNavigateContext,\n  PresentationNavigateContextValue,\n} from './PresentationNavigateContext'\nimport { PresentationNavigate } from './types'\n\nexport const PresentationNavigateProvider: FunctionComponent<\n  PropsWithChildren<{\n    navigate: PresentationNavigate\n  }>\n> = function (props) {\n  const { children, navigate: _navigate } = props\n\n  const navigate = useCallback<PresentationNavigateContextValue>(\n    (preview, document = undefined) => {\n      _navigate(document || {}, preview ? { preview } : {})\n    },\n    [_navigate],\n  )\n\n  return (\n    <PresentationNavigateContext.Provider value={navigate}>\n      {children}\n    </PresentationNavigateContext.Provider>\n  )\n}\n","import { memo, useCallback, useMemo } from 'react'\n\nimport { Panel } from './panels/Panel'\nimport { PanelResizer } from './panels/PanelResizer'\nimport type { NavigatorOptions } from './types'\nimport { useLocalState } from './useLocalState'\n\n/** @internal */\nexport interface UsePresentationNavigatorProps {\n  unstable_navigator?: NavigatorOptions\n}\n\n/** @internal */\nexport interface UsePresentationNavigatorState {\n  navigatorEnabled: boolean\n  toggleNavigator: (() => void) | undefined\n}\n\n/** @internal */\nexport function usePresentationNavigator(\n  props: UsePresentationNavigatorProps,\n): [UsePresentationNavigatorState, () => JSX.Element] {\n  const { unstable_navigator } = props\n\n  const navigatorProvided = !!unstable_navigator?.component\n  const [_navigatorEnabled, setNavigatorEnabled] = useLocalState<boolean>(\n    'presentation/navigator',\n    navigatorProvided,\n  )\n  const navigatorEnabled = navigatorProvided ? _navigatorEnabled : false\n  const toggleNavigator = useMemo(() => {\n    if (!navigatorProvided) return undefined\n\n    return () => setNavigatorEnabled((enabled) => !enabled)\n  }, [navigatorProvided, setNavigatorEnabled])\n\n  const Component = useCallback(\n    function PresentationNavigator() {\n      return <>{navigatorEnabled && <Navigator {...unstable_navigator!} />}</>\n    },\n    [navigatorEnabled, unstable_navigator],\n  )\n\n  return [{ navigatorEnabled, toggleNavigator }, Component]\n}\n\nfunction NavigatorComponent(props: NavigatorOptions) {\n  const { minWidth, maxWidth, component: NavigatorComponent } = props\n  const navigatorDisabled =\n    minWidth != null && maxWidth != null && minWidth === maxWidth\n  return (\n    <>\n      <Panel id=\"navigator\" minWidth={minWidth} maxWidth={maxWidth} order={1}>\n        <NavigatorComponent />\n      </Panel>\n      <PanelResizer order={2} disabled={navigatorDisabled} />\n    </>\n  )\n}\nconst Navigator = memo(NavigatorComponent)\n","import { Dispatch, SetStateAction, useEffect, useState } from 'react'\n\nexport function useLocalState<T>(\n  key: string,\n  defaultValue: T,\n): [T, Dispatch<SetStateAction<T>>] {\n  const [value, setValue] = useState<T>(() =>\n    JSON.parse(localStorage.getItem(key) ?? JSON.stringify(defaultValue)),\n  )\n\n  useEffect(() => {\n    localStorage.setItem(key, JSON.stringify(value))\n  }, [key, value])\n\n  return [value, setValue]\n}\n","import { FunctionComponent, PropsWithChildren, useMemo } from 'react'\n\nimport { PresentationParamsContext } from './PresentationParamsContext'\nimport { PresentationParams } from './types'\n\nexport const PresentationParamsProvider: FunctionComponent<\n  PropsWithChildren<{\n    params: PresentationParams\n  }>\n> = function (props) {\n  const { children, params } = props\n\n  const context = useMemo<PresentationParams>(() => params, [params])\n\n  return (\n    <PresentationParamsContext.Provider value={context}>\n      {children}\n    </PresentationParamsContext.Provider>\n  )\n}\n","import { FunctionComponent, PropsWithChildren, useMemo } from 'react'\n\nimport {\n  PresentationContext,\n  PresentationContextValue,\n} from './PresentationContext'\nimport {\n  DeskDocumentPaneParams,\n  PresentationNavigate,\n  PresentationParams,\n} from './types'\n\nexport const PresentationProvider: FunctionComponent<\n  PropsWithChildren<{\n    deskParams: DeskDocumentPaneParams\n    devMode: boolean\n    name: string\n    navigate: PresentationNavigate\n    params: PresentationParams\n  }>\n> = function (props) {\n  const { children, deskParams, devMode, name, navigate, params } = props\n\n  const context = useMemo<PresentationContextValue>(\n    () => ({\n      deskParams,\n      devMode,\n      name,\n      navigate,\n      params,\n    }),\n    [deskParams, devMode, name, navigate, params],\n  )\n\n  return (\n    <PresentationContext.Provider value={context}>\n      {children}\n    </PresentationContext.Provider>\n  )\n}\n","import { motion } from 'framer-motion'\nimport styled from 'styled-components'\n\nexport const IFrame = motion(styled.iframe`\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n`)\n","import { ResetIcon } from '@sanity/icons'\nimport { TextInput, type TextInputClearButtonProps } from '@sanity/ui'\nimport {\n  ChangeEvent,\n  FunctionComponent,\n  KeyboardEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { useActiveWorkspace } from 'sanity'\n\nexport const PreviewLocationInput: FunctionComponent<{\n  fontSize?: number\n  onChange: (value: string) => void\n  origin: string\n  padding?: number\n  value: string\n}> = function (props) {\n  const { basePath = '/' } = useActiveWorkspace()?.activeWorkspace || {}\n  const { fontSize = 1, onChange, origin, padding = 3, value } = props\n  const inputRef = useRef<HTMLInputElement | null>(null)\n  const [sessionValue, setSessionValue] = useState<string | undefined>(\n    undefined,\n  )\n  const [customValidity, setCustomValidity] = useState<string | undefined>(\n    undefined,\n  )\n\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    setSessionValue(event.currentTarget.value)\n  }, [])\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLInputElement>) => {\n      if (event.key === 'Enter') {\n        if (sessionValue === undefined) {\n          return\n        }\n\n        const absoluteValue =\n          sessionValue.startsWith('/') || sessionValue === ''\n            ? `${origin}${sessionValue}`\n            : sessionValue\n\n        if (\n          !absoluteValue.startsWith(origin + '/') &&\n          absoluteValue !== origin\n        ) {\n          setCustomValidity(`URL must start with ${origin}`)\n          return\n        }\n        // `origin` is an empty string '' if the Studio is embedded, and that's when we need to protect against recursion\n        if (\n          !origin &&\n          (absoluteValue.startsWith(`${basePath}/`) ||\n            absoluteValue === basePath)\n        ) {\n          setCustomValidity(\n            `URL can't have the same base path as the Studio ${basePath}`,\n          )\n          return\n        }\n\n        const nextValue =\n          absoluteValue === origin ? origin + '/' : absoluteValue\n\n        setCustomValidity(undefined)\n        setSessionValue(undefined)\n\n        onChange(nextValue.slice(origin.length))\n\n        inputRef.current?.blur()\n      }\n\n      if (event.key === 'Escape') {\n        setCustomValidity(undefined)\n        setSessionValue(undefined)\n      }\n    },\n    [basePath, onChange, origin, sessionValue],\n  )\n\n  const handleBlur = useCallback(() => {\n    setCustomValidity(undefined)\n    setSessionValue(undefined)\n  }, [])\n\n  useEffect(() => {\n    setCustomValidity(undefined)\n    setSessionValue(undefined)\n  }, [origin, value])\n\n  const resetButton: TextInputClearButtonProps = useMemo(\n    () => ({ icon: ResetIcon }),\n    [],\n  )\n\n  return (\n    <>\n      <TextInput\n        clearButton={customValidity ? resetButton : undefined}\n        customValidity={customValidity}\n        fontSize={fontSize}\n        onBlur={handleBlur}\n        onClear={() => {\n          setCustomValidity(undefined)\n          setSessionValue(origin + value)\n        }}\n        onChange={handleChange}\n        onKeyDownCapture={handleKeyDown}\n        padding={padding}\n        style={{ zIndex: 1 }}\n        radius={2}\n        ref={inputRef}\n        space={padding}\n        value={sessionValue === undefined ? `${origin}${value}` : sessionValue}\n      />\n    </>\n  )\n}\n","import type { ChannelStatus } from '@sanity/channels'\nimport type { ClientPerspective } from '@sanity/client'\nimport {\n  CheckmarkIcon,\n  ChevronDownIcon,\n  CopyIcon,\n  DatabaseIcon,\n  DesktopIcon,\n  EditIcon,\n  LaunchIcon,\n  MobileDeviceIcon,\n  PanelLeftIcon,\n  PublishIcon,\n  RefreshIcon,\n  ShareIcon,\n} from '@sanity/icons'\nimport { createPreviewSecret } from '@sanity/preview-url-secret/create-secret'\nimport {\n  hasSecretSearchParams,\n  setSecretSearchParams,\n  withoutSecretSearchParams,\n} from '@sanity/preview-url-secret/without-secret-search-params'\nimport {\n  Box,\n  Button,\n  ButtonTone,\n  Card,\n  Code,\n  Flex,\n  Label,\n  Menu,\n  MenuButton,\n  MenuItem,\n  Spinner,\n  Stack,\n  Switch,\n  Text,\n  Tooltip,\n  TooltipDelayGroupProvider,\n  usePrefersReducedMotion,\n  useToast,\n} from '@sanity/ui'\nimport { AnimatePresence, motion, MotionConfig } from 'framer-motion'\nimport {\n  ComponentType,\n  createElement,\n  Dispatch,\n  forwardRef,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { Hotkeys, useClient, useCurrentUser } from 'sanity'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { API_VERSION, MAX_TIME_TO_OVERLAYS_CONNECTION } from '../constants'\nimport { PresentationParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { IFrame } from './IFrame'\nimport { PreviewLocationInput } from './PreviewLocationInput'\n\nconst MotionFlex = motion(Flex)\n\nconst StyledSwitch = styled(Switch)`\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n`\n\nconst PERSPECTIVE_TITLES: Record<ClientPerspective, string> = {\n  previewDrafts: 'Drafts',\n  published: 'Published',\n  raw: 'Raw',\n}\n\nconst PERSPECTIVE_TONES: Record<ClientPerspective, ButtonTone> = {\n  previewDrafts: 'caution',\n  published: 'positive',\n  raw: 'default',\n}\n\nconst PERSPECTIVE_ICONS: Record<ClientPerspective, ComponentType> = {\n  previewDrafts: EditIcon,\n  published: PublishIcon,\n  raw: DatabaseIcon,\n}\n\ninterface PreviewFrameProps {\n  initialUrl: URL\n  targetOrigin: string\n  navigatorEnabled: boolean\n  onPathChange: (nextPath: string) => void\n  openPopup: (url: string) => void\n  overlayEnabled: boolean\n  params: PresentationParams\n  perspective: ClientPerspective\n  setPerspective: Dispatch<SetStateAction<ClientPerspective>>\n  toggleNavigator?: () => void\n  toggleOverlay: () => void\n  loadersConnection: ChannelStatus\n  overlaysConnection: ChannelStatus\n  previewKitConnection: ChannelStatus\n}\n\nexport const PreviewFrame = forwardRef<HTMLIFrameElement, PreviewFrameProps>(\n  function PreviewFrame(props, ref) {\n    const {\n      initialUrl,\n      targetOrigin,\n      navigatorEnabled,\n      onPathChange,\n      openPopup,\n      overlayEnabled,\n      params,\n      perspective,\n      setPerspective,\n      toggleNavigator,\n      toggleOverlay,\n      loadersConnection,\n      overlaysConnection,\n      previewKitConnection,\n    } = props\n\n    const { devMode } = usePresentationTool()\n\n    const [mode, setMode] = useState<'desktop' | 'mobile'>('desktop')\n    const prefersReducedMotion = usePrefersReducedMotion()\n\n    const setDesktopMode = useCallback(() => setMode('desktop'), [setMode])\n    const setMobileMode = useCallback(() => setMode('mobile'), [setMode])\n    const [loading, setLoading] = useState(true)\n    const [timedOut, setTimedOut] = useState(false)\n    const [refreshing, setRefreshing] = useState(false)\n    const [somethingIsWrong, setSomethingIsWrong] = useState(false)\n    const iframeIsBusy =\n      loading || refreshing || overlaysConnection === 'connecting'\n\n    const previewLocationOrigin = useMemo(() => {\n      return targetOrigin === location.origin ? '' : targetOrigin\n    }, [targetOrigin])\n\n    const handleRefresh = useCallback(() => {\n      if (typeof ref === 'function' || !ref?.current) {\n        return\n      }\n\n      // Funky way to reload an iframe without CORS issues\n      // eslint-disable-next-line no-self-assign\n      // ref.current.src = ref.current.src\n      ref.current.src = `${targetOrigin}${params.preview || '/'}`\n\n      setRefreshing(true)\n    }, [params.preview, targetOrigin, ref])\n    const handleRetry = useCallback(() => {\n      if (typeof ref === 'function' || !ref?.current) {\n        return\n      }\n\n      ref.current.src = initialUrl.toString()\n\n      setRefreshing(true)\n    }, [ref, initialUrl])\n    const handleContinueAnyway = useCallback(() => {\n      setContinueAnyway(true)\n    }, [])\n\n    const [continueAnyway, setContinueAnyway] = useState(false)\n    const [showOverlaysConnectionStatus, setShowOverlaysConnectionState] =\n      useState(false)\n    useEffect(() => {\n      if (loading || refreshing) {\n        return\n      }\n\n      if (\n        overlaysConnection === 'connecting' ||\n        overlaysConnection === 'reconnecting'\n      ) {\n        const timeout = setTimeout(() => {\n          setShowOverlaysConnectionState(true)\n        }, 1000)\n        return () => clearTimeout(timeout)\n      }\n      return\n    }, [\n      overlaysConnection,\n      loading,\n      refreshing,\n      setShowOverlaysConnectionState,\n    ])\n\n    useEffect(() => {\n      if (loading || refreshing || !showOverlaysConnectionStatus) {\n        return\n      }\n      if (overlaysConnection === 'connected') {\n        setSomethingIsWrong(false)\n        setShowOverlaysConnectionState(false)\n        setTimedOut(false)\n        setContinueAnyway(false)\n      }\n      if (overlaysConnection === 'connecting') {\n        const timeout = setTimeout(() => {\n          setTimedOut(true)\n          // eslint-disable-next-line no-console\n          console.error(\n            `Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly`,\n          )\n        }, MAX_TIME_TO_OVERLAYS_CONNECTION)\n        return () => clearTimeout(timeout)\n      }\n      if (overlaysConnection === 'reconnecting') {\n        const timeout = setTimeout(() => {\n          setTimedOut(true)\n          setSomethingIsWrong(true)\n        }, MAX_TIME_TO_OVERLAYS_CONNECTION)\n        return () => clearTimeout(timeout)\n      }\n      if (overlaysConnection === 'disconnected') {\n        setSomethingIsWrong(true)\n      }\n      return\n    }, [loading, overlaysConnection, refreshing, showOverlaysConnectionStatus])\n\n    const previewLocationRoute = useMemo(() => {\n      const previewUrl = new URL(params.preview || '/', targetOrigin)\n      const { pathname, search } = withoutSecretSearchParams(previewUrl)\n\n      return `${pathname}${search}`\n    }, [params.preview, targetOrigin])\n\n    const onIFrameLoad = useCallback(() => {\n      setLoading(false)\n      setRefreshing(false)\n    }, [])\n\n    return (\n      <MotionConfig\n        transition={prefersReducedMotion ? { duration: 0 } : undefined}\n      >\n        <TooltipDelayGroupProvider delay={1000}>\n          <Card\n            flex=\"none\"\n            padding={2}\n            shadow={1}\n            style={{ position: 'relative' }}\n          >\n            <Flex align=\"center\" gap={2} style={{ minHeight: 0 }}>\n              {toggleNavigator && (\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Toggle navigator</Text>}\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Toggle navigator\"\n                    fontSize={1}\n                    icon={PanelLeftIcon}\n                    mode=\"bleed\"\n                    onClick={toggleNavigator}\n                    padding={3}\n                    selected={navigatorEnabled}\n                  />\n                </Tooltip>\n              )}\n\n              <Tooltip\n                animate\n                content={\n                  <Flex align=\"center\" style={{ whiteSpace: 'nowrap' }}>\n                    <Box padding={1}>\n                      <Text size={1}>\n                        {overlayEnabled\n                          ? 'Disable edit overlay'\n                          : 'Enable edit overlay'}\n                      </Text>\n                    </Box>\n                    <Box paddingY={1}>\n                      <Hotkeys\n                        keys={['Alt']}\n                        style={{ marginTop: -4, marginBottom: -4 }}\n                      />\n                    </Box>\n                  </Flex>\n                }\n                fallbackPlacements={['bottom-start']}\n                padding={1}\n                placement=\"bottom\"\n                portal\n              >\n                <Card\n                  as=\"label\"\n                  flex=\"none\"\n                  padding={3}\n                  style={{\n                    lineHeight: 0,\n                    borderRadius: 999,\n                    userSelect: 'none',\n                  }}\n                  tone={overlayEnabled ? 'positive' : undefined}\n                >\n                  <Flex align=\"center\" gap={2}>\n                    <div style={{ margin: -2 }}>\n                      <StyledSwitch\n                        checked={overlayEnabled}\n                        onChange={toggleOverlay}\n                        disabled={iframeIsBusy}\n                      />\n                    </div>\n                    <Box>\n                      <Text muted size={1} weight=\"medium\">\n                        Edit\n                      </Text>\n                    </Box>\n                  </Flex>\n                </Card>\n              </Tooltip>\n\n              {devMode && (\n                <Tooltip\n                  animate\n                  content={\n                    <Text size={1}>\n                      {refreshing ? 'Refreshing' : 'Refresh preview'}\n                    </Text>\n                  }\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Refresh preview\"\n                    fontSize={1}\n                    icon={RefreshIcon}\n                    mode=\"bleed\"\n                    loading={refreshing}\n                    onClick={handleRefresh}\n                    padding={3}\n                  />\n                </Tooltip>\n              )}\n\n              <Box flex={1}>\n                <PreviewLocationInput\n                  onChange={onPathChange}\n                  origin={previewLocationOrigin}\n                  value={previewLocationRoute}\n                />\n              </Box>\n\n              <Flex align=\"center\" flex=\"none\" gap={1}>\n                <MenuButton\n                  button={\n                    <Button\n                      fontSize={1}\n                      iconRight={ShareIcon}\n                      mode=\"bleed\"\n                      padding={3}\n                      space={2}\n                    />\n                  }\n                  id=\"location-menu\"\n                  menu={\n                    <Menu>\n                      <ShareUrlMenuItems\n                        initialUrl={initialUrl}\n                        openPopup={openPopup}\n                        previewLocationOrigin={previewLocationOrigin}\n                        previewLocationRoute={previewLocationRoute}\n                      />\n                    </Menu>\n                  }\n                  popover={{\n                    animate: true,\n                    constrainSize: true,\n                    placement: 'bottom',\n                    portal: true,\n                  }}\n                />\n              </Flex>\n\n              <Flex align=\"center\" flex=\"none\" gap={1}>\n                <MenuButton\n                  button={\n                    <Button\n                      fontSize={1}\n                      iconRight={ChevronDownIcon}\n                      mode=\"bleed\"\n                      padding={3}\n                      space={2}\n                      text={PERSPECTIVE_TITLES[perspective]}\n                      loading={\n                        iframeIsBusy ||\n                        (loadersConnection === 'connecting' &&\n                          previewKitConnection !== 'connected')\n                      }\n                      disabled={loadersConnection !== 'connected'}\n                    />\n                  }\n                  id=\"perspective-menu\"\n                  menu={\n                    <Menu style={{ maxWidth: 240 }}>\n                      <MenuItem\n                        fontSize={1}\n                        onClick={() => setPerspective('previewDrafts')}\n                        padding={3}\n                        pressed={perspective === 'previewDrafts'}\n                        tone={PERSPECTIVE_TONES['previewDrafts']}\n                      >\n                        <Flex align=\"flex-start\" gap={3}>\n                          <Box flex=\"none\">\n                            <Text size={1}>\n                              {createElement(\n                                PERSPECTIVE_ICONS['previewDrafts'],\n                              )}\n                            </Text>\n                          </Box>\n                          <Stack flex={1} space={2}>\n                            <Text size={1} weight=\"medium\">\n                              {PERSPECTIVE_TITLES['previewDrafts']}\n                            </Text>\n                            <Text muted size={1}>\n                              View this page with latest draft content\n                            </Text>\n                          </Stack>\n                          <Box flex=\"none\">\n                            <Text\n                              muted\n                              size={1}\n                              style={{\n                                opacity:\n                                  perspective === 'previewDrafts' ? 1 : 0,\n                              }}\n                            >\n                              <CheckmarkIcon />\n                            </Text>\n                          </Box>\n                        </Flex>\n                      </MenuItem>\n                      <MenuItem\n                        fontSize={1}\n                        onClick={() => setPerspective('published')}\n                        padding={3}\n                        pressed={perspective === 'published'}\n                        tone={PERSPECTIVE_TONES['published']}\n                      >\n                        <Flex align=\"flex-start\" gap={3}>\n                          <Box flex=\"none\">\n                            <Text size={1}>\n                              {createElement(PERSPECTIVE_ICONS['published'])}\n                            </Text>\n                          </Box>\n                          <Stack flex={1} space={2}>\n                            <Text size={1} weight=\"medium\">\n                              {PERSPECTIVE_TITLES['published']}\n                            </Text>\n                            <Text muted size={1}>\n                              View this page with published content\n                            </Text>\n                          </Stack>\n                          <Box flex=\"none\">\n                            <Text\n                              muted\n                              size={1}\n                              style={{\n                                opacity: perspective === 'published' ? 1 : 0,\n                              }}\n                            >\n                              <CheckmarkIcon />\n                            </Text>\n                          </Box>\n                        </Flex>\n                      </MenuItem>\n                    </Menu>\n                  }\n                  popover={{\n                    animate: true,\n                    constrainSize: true,\n                    placement: 'bottom',\n                    portal: true,\n                  }}\n                />\n              </Flex>\n\n              <Flex align=\"center\" flex=\"none\" gap={1}>\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Full viewport</Text>}\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Full viewport\"\n                    fontSize={1}\n                    icon={DesktopIcon}\n                    mode=\"bleed\"\n                    onClick={setDesktopMode}\n                    padding={3}\n                    selected={mode === 'desktop'}\n                  />\n                </Tooltip>\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Narrow viewport</Text>}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Narrow viewport\"\n                    fontSize={1}\n                    icon={MobileDeviceIcon}\n                    mode=\"bleed\"\n                    onClick={setMobileMode}\n                    padding={3}\n                    selected={mode === 'mobile'}\n                  />\n                </Tooltip>\n              </Flex>\n            </Flex>\n          </Card>\n\n          <Card flex={1} tone=\"transparent\">\n            <Flex\n              align=\"center\"\n              height=\"fill\"\n              justify=\"center\"\n              padding={mode === 'desktop' ? 0 : 2}\n              sizing=\"border\"\n              style={{\n                position: 'relative',\n                cursor: iframeIsBusy ? 'wait' : undefined,\n              }}\n            >\n              <AnimatePresence>\n                {!somethingIsWrong &&\n                !loading &&\n                !refreshing &&\n                showOverlaysConnectionStatus &&\n                !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={spinnerVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      inset: `0`,\n                      position: `absolute`,\n                      backdropFilter: timedOut\n                        ? 'blur(16px) saturate(0.5) grayscale(0.5)'\n                        : 'blur(2px)',\n                      ['transition' as string]:\n                        'backdrop-filter 0.2s ease-in-out',\n                      // @TODO Because of Safari we have to do this\n                      WebkitBackdropFilter: timedOut\n                        ? 'blur(16px) saturate(0.5) grayscale(0.5)'\n                        : 'blur(2px)',\n                      WebkitTransition:\n                        '-webkit-backdrop-filter 0.2s ease-in-out',\n                      zIndex: 1,\n                    }}\n                  >\n                    <Flex\n                      style={{ ...sizes[mode] }}\n                      justify=\"center\"\n                      align=\"center\"\n                      direction=\"column\"\n                      gap={4}\n                    >\n                      {timedOut && (\n                        <Button\n                          disabled\n                          fontSize={1}\n                          mode=\"ghost\"\n                          text=\"Continue anyway\"\n                          style={{ opacity: 0 }}\n                        />\n                      )}\n                      <Card\n                        radius={2}\n                        tone={timedOut ? 'caution' : 'inherit'}\n                        padding={4}\n                        shadow={1}\n                      >\n                        <Flex\n                          justify=\"center\"\n                          align=\"center\"\n                          direction=\"column\"\n                          gap={4}\n                        >\n                          <Spinner muted />\n                          <Text muted size={1}>\n                            {timedOut ? (\n                              <>\n                                Unable to connect, check the browser console for\n                                more information.\n                              </>\n                            ) : (\n                              'Connecting'\n                            )}\n                          </Text>\n                        </Flex>\n                      </Card>\n                      {timedOut && (\n                        <Button\n                          fontSize={1}\n                          // mode=\"ghost\"\n                          tone=\"critical\"\n                          onClick={handleContinueAnyway}\n                          text=\"Continue anyway\"\n                        />\n                      )}\n                    </Flex>\n                  </MotionFlex>\n                ) : (loading || iframeIsBusy) && !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={spinnerVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      inset: `0`,\n                      position: `absolute`,\n                      // boxShadow: '0 0 0 1px var(--card-shadow-outline-color)',\n                    }}\n                  >\n                    <Flex\n                      style={{ ...sizes[mode] }}\n                      justify=\"center\"\n                      align=\"center\"\n                      direction=\"column\"\n                      gap={4}\n                    >\n                      <Spinner muted />\n                      <Text muted size={1}>\n                        Loading\n                      </Text>\n                    </Flex>\n                  </MotionFlex>\n                ) : somethingIsWrong && !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={errorVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      background: 'var(--card-bg-color)',\n                      inset: `0`,\n                      position: `absolute`,\n                      borderTop: '1px solid transparent',\n                      boxShadow: '0 0 0 1px var(--card-border-color)',\n                    }}\n                  >\n                    <ErrorCard\n                      flex={1}\n                      message=\"Could not connect to the preview\"\n                      onRetry={handleRetry}\n                      onContinueAnyway={handleContinueAnyway}\n                    >\n                      {devMode && (\n                        <>\n                          {overlaysConnection !== 'connected' && (\n                            <Card padding={3} radius={2} tone=\"critical\">\n                              <Stack space={3}>\n                                <Label muted size={0}>\n                                  Overlay connection status\n                                </Label>\n                                <Code size={1}>{overlaysConnection}</Code>\n                              </Stack>\n                            </Card>\n                          )}\n\n                          {loadersConnection !== 'connected' && (\n                            <Card padding={3} radius={2} tone=\"critical\">\n                              <Stack space={3}>\n                                <Label muted size={0}>\n                                  Loader connection status\n                                </Label>\n                                <Code size={1}>{loadersConnection}</Code>\n                              </Stack>\n                            </Card>\n                          )}\n                        </>\n                      )}\n                    </ErrorCard>\n                  </MotionFlex>\n                ) : null}\n              </AnimatePresence>\n              <IFrame\n                ref={ref}\n                style={{\n                  pointerEvents:\n                    iframeIsBusy && !continueAnyway ? 'none' : 'auto',\n                  boxShadow: '0 0 0 1px var(--card-border-color)',\n                  borderTop: '1px solid transparent',\n                }}\n                src={initialUrl.toString()}\n                initial={['background']}\n                variants={iframeVariants}\n                animate={[\n                  (loading || iframeIsBusy) && !continueAnyway\n                    ? 'background'\n                    : 'active',\n                  refreshing ? 'reloading' : 'idle',\n                  mode,\n                  showOverlaysConnectionStatus && !continueAnyway\n                    ? 'timedOut'\n                    : '',\n                ]}\n                onLoad={onIFrameLoad}\n              />\n            </Flex>\n          </Card>\n        </TooltipDelayGroupProvider>\n      </MotionConfig>\n    )\n  },\n)\n\nconst sizes = {\n  desktop: {\n    width: '100%',\n    height: '100%',\n  },\n  mobile: {\n    width: 375,\n    height: 650,\n  },\n}\n\nconst spinnerVariants = {\n  initial: { opacity: 1 },\n  animate: { opacity: [0, 0, 1] },\n  exit: { opacity: [1, 0, 0] },\n}\n\nconst errorVariants = {\n  initial: { opacity: 1 },\n  animate: { opacity: [0, 0, 1] },\n  exit: { opacity: [1, 0, 0] },\n}\n\nconst iframeVariants = {\n  desktop: {\n    ...sizes.desktop,\n    boxShadow: '0 0 0 0px var(--card-border-color)',\n  },\n  mobile: {\n    ...sizes.mobile,\n    boxShadow: '0 0 0 1px var(--card-border-color)',\n  },\n  background: {\n    opacity: 0,\n    scale: 1,\n  },\n  idle: {\n    scale: 1,\n  },\n  reloading: {\n    scale: [1, 1, 1, 0.98],\n  },\n  active: {\n    opacity: [0, 0, 1],\n    scale: 1,\n  },\n  timedOut: {\n    opacity: [0, 0, 1],\n  },\n}\n\nfunction ShareUrlMenuItems(\n  props: Pick<PreviewFrameProps, 'initialUrl' | 'openPopup'> & {\n    previewLocationOrigin: string\n    previewLocationRoute: string\n  },\n) {\n  const { initialUrl, openPopup, previewLocationOrigin, previewLocationRoute } =\n    props\n\n  const handleOpenPopup = useCallback(\n    (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n      event.preventDefault()\n      openPopup(event.currentTarget.href)\n    },\n    [openPopup],\n  )\n\n  return (\n    <>\n      <CopyUrlMenuButton\n        initialUrl={initialUrl}\n        previewLocationOrigin={previewLocationOrigin}\n        previewLocationRoute={previewLocationRoute}\n      />\n      <MenuItem\n        icon={LaunchIcon}\n        text=\"Open preview\"\n        as=\"a\"\n        href={`${previewLocationOrigin}${previewLocationRoute}`}\n        onClick={handleOpenPopup as any}\n        rel=\"opener\"\n        target=\"_blank\"\n      />\n    </>\n  )\n}\n\nfunction CopyUrlMenuButton(\n  props: Pick<PreviewFrameProps, 'initialUrl'> & {\n    previewLocationOrigin: string\n    previewLocationRoute: string\n  },\n) {\n  const { initialUrl, previewLocationOrigin, previewLocationRoute } = props\n\n  const { push: pushToast } = useToast()\n  const client = useClient({ apiVersion: API_VERSION })\n  const currentUser = useCurrentUser()\n  const [disabled, setDisabled] = useState(false)\n\n  return (\n    <MenuItem\n      disabled={disabled}\n      onClick={() => {\n        if (!navigator?.clipboard) {\n          pushToast({\n            closable: true,\n            status: 'error',\n            title: 'Clipboard not supported',\n          })\n          return false\n        }\n        setDisabled(true)\n\n        let id: string | undefined = undefined\n        let url = `${previewLocationOrigin}${previewLocationRoute}`\n        const onFinally = () => {\n          pushToast({\n            id,\n            closable: true,\n            status: 'success',\n            title: 'The URL is copied to the clipboard',\n          })\n          setDisabled(false)\n        }\n        const onError = (error: any) => {\n          pushToast({\n            closable: true,\n            status: 'error',\n            title: 'Copy failed',\n            description: error.message || error.toString(),\n          })\n          setDisabled(false)\n        }\n        if (\n          hasSecretSearchParams(initialUrl) &&\n          typeof ClipboardItem !== 'undefined'\n        ) {\n          const type = 'text/plain'\n          const resolvePreviewUrl = async () => {\n            id = pushToast({\n              closable: true,\n              title: 'Copying URL to clipboard',\n            })\n            const previewUrlSecret = await createPreviewSecret(\n              client,\n              '@sanity/presentation',\n              typeof window === 'undefined' ? '' : location.href,\n              currentUser?.id,\n            )\n\n            const newUrl = setSecretSearchParams(\n              initialUrl,\n              previewUrlSecret.secret,\n              previewLocationRoute,\n            )\n            url = newUrl.toString()\n            return new Blob([url], { type })\n          }\n\n          // Try to save to clipboard then save it in the state if worked\n          const item = new ClipboardItem({\n            [type]: resolvePreviewUrl(),\n          })\n          navigator.clipboard.write([item]).then(onFinally).catch(onError)\n        } else {\n          navigator.clipboard.writeText(url).then(onFinally).catch(onError)\n        }\n      }}\n      text=\"Copy link\"\n      icon={CopyIcon}\n    />\n  )\n}\n","import type { ClientPerspective } from '@sanity/client'\nimport isEqual from 'fast-deep-equal'\nimport { useCallback, useMemo, useState } from 'react'\n\nexport type DocumentOnPage = {\n  _id: string\n  _type: string\n}\n\nlet warnedAboutCrossDatasetReference = false\n\nexport function useDocumentsOnPage(\n  perspective: ClientPerspective,\n): [\n  DocumentOnPage[],\n  (perspective: ClientPerspective, state: DocumentOnPage[]) => void,\n] {\n  if (perspective !== 'published' && perspective !== 'previewDrafts') {\n    throw new Error(`Invalid perspective: ${perspective}`)\n  }\n\n  const [published, setPublished] = useState<Record<string, DocumentOnPage>>({})\n  const [previewDrafts, setPreviewDrafts] = useState<\n    Record<string, DocumentOnPage>\n  >({})\n\n  const setDocumentsOnPage = useCallback(\n    (perspective: ClientPerspective, sourceDocuments: DocumentOnPage[]) => {\n      const documents = sourceDocuments.filter((sourceDocument) => {\n        if ('_projectId' in sourceDocument && sourceDocument._projectId) {\n          // @TODO Handle cross dataset references\n          if (!warnedAboutCrossDatasetReference) {\n            // eslint-disable-next-line no-console\n            console.warn(\n              'Cross dataset references are not supported yet, ignoring source document',\n              sourceDocument,\n            )\n            warnedAboutCrossDatasetReference = true\n          }\n          return false\n        }\n        return sourceDocument\n      })\n\n      const setCache =\n        perspective === 'published' ? setPublished : setPreviewDrafts\n\n      setCache((prev) => {\n        const next: Record<string, DocumentOnPage> = {}\n        for (const document of documents) {\n          next[document._id] = document\n        }\n        return isEqual(prev, next) ? prev : next\n      })\n    },\n    [],\n  )\n\n  const documentsOnPage = useMemo(() => {\n    return perspective === 'published'\n      ? [...Object.values(published)]\n      : [...Object.values(previewDrafts)]\n  }, [perspective, previewDrafts, published])\n\n  return [documentsOnPage, setDocumentsOnPage]\n}\n","import { MutableRefObject, useEffect, useMemo, useRef } from 'react'\nimport { RouterContextValue, RouterState, SearchParam } from 'sanity/router'\n\nimport { debounce } from './lib/debounce'\nimport { parseRouterState } from './lib/parse'\nimport {\n  DeskDocumentPaneParams,\n  PresentationNavigate,\n  PresentationParams,\n  PresentationSearchParams,\n  PresentationStateParams,\n} from './types'\n\nfunction pruneObject<T extends RouterState | PresentationParams>(obj: T): T {\n  return Object.fromEntries(\n    Object.entries(obj).filter(\n      ([, value]) => value !== undefined && value !== '' && value !== null,\n    ),\n  ) as T\n}\n\nexport function useParams({\n  initialPreviewUrl,\n  routerNavigate,\n  routerState,\n  routerSearchParams,\n  previewRef,\n}: {\n  initialPreviewUrl: URL\n  routerNavigate: RouterContextValue['navigate']\n  routerState: RouterState & PresentationStateParams\n  routerSearchParams: {\n    [k: string]: string\n  }\n  previewRef: MutableRefObject<string | undefined>\n}): {\n  deskParams: DeskDocumentPaneParams\n  navigate: PresentationNavigate\n  params: PresentationParams\n} {\n  const params = useMemo<PresentationParams>(() => {\n    const { id, path, type } = parseRouterState(routerState)\n\n    return {\n      id,\n      type,\n      path,\n      preview:\n        routerSearchParams.preview ||\n        `${initialPreviewUrl.pathname}${initialPreviewUrl.search}`,\n      perspective: routerSearchParams.perspective,\n      inspect: routerSearchParams.inspect,\n      rev: routerSearchParams.rev,\n      since: routerSearchParams.since,\n      template: routerSearchParams.template,\n      view: routerSearchParams.view,\n      // assist\n      pathKey: routerSearchParams.pathKey,\n      instruction: routerSearchParams.instruction,\n      // comments\n      comment: routerSearchParams.comment,\n    }\n  }, [routerState, routerSearchParams, initialPreviewUrl])\n\n  const deskParams = useMemo<DeskDocumentPaneParams>(() => {\n    const pruned = pruneObject({\n      inspect: params.inspect,\n      path: params.path,\n      rev: params.rev,\n      since: params.since,\n      template: params.template,\n      view: params.view,\n      // assist\n      pathKey: params.pathKey,\n      instruction: params.instruction,\n      // comments\n      comment: params.comment,\n    })\n    return pruned\n  }, [\n    params.inspect,\n    params.path,\n    params.rev,\n    params.since,\n    params.template,\n    params.view,\n    params.pathKey,\n    params.instruction,\n    params.comment,\n  ])\n\n  const routerStateRef = useRef(routerState)\n\n  useEffect(() => {\n    routerStateRef.current = routerState\n  }, [routerState])\n\n  const navigate = useMemo(\n    () =>\n      debounce<PresentationNavigate>(\n        (nextState, nextSearchState = {}, forceReplace) => {\n          // Extract type, id and path as 'routerState'\n          const { _searchParams: routerSearchParams, ...routerState } =\n            routerStateRef.current\n\n          // Convert array of search params to an object\n          const routerSearchState = (routerSearchParams || []).reduce(\n            (acc, [key, value]) => (\n              (acc[key as keyof PresentationSearchParams] = value), acc\n            ),\n            {} as PresentationSearchParams,\n          )\n\n          // Merge routerState and incoming state\n          const state: RouterState = pruneObject({\n            ...routerState,\n            ...nextState,\n          })\n\n          // Merge routerSearchState and incoming searchState\n          const searchState = pruneObject({\n            ...routerSearchState,\n            ...nextSearchState,\n          })\n\n          state._searchParams = Object.entries(searchState).reduce(\n            (acc, [key, value]) => [...acc, [key, value]],\n            [] as SearchParam[],\n          )\n\n          const replace =\n            forceReplace ?? searchState.preview === previewRef.current\n\n          routerNavigate(state, { replace })\n        },\n        50,\n      ),\n    [routerNavigate, previewRef],\n  )\n\n  return {\n    deskParams,\n    navigate,\n    params,\n  }\n}\n","import { createPreviewSecret } from '@sanity/preview-url-secret/create-secret'\nimport { definePreviewUrl } from '@sanity/preview-url-secret/define-preview-url'\nimport { startTransition, useEffect, useMemo, useState } from 'react'\nimport {\n  type SanityClient,\n  useActiveWorkspace,\n  useClient,\n  useCurrentUser,\n} from 'sanity'\nimport { suspend } from 'suspend-react'\n\nimport { API_VERSION } from './constants'\nimport { PreviewUrlOption } from './types'\n\nexport function usePreviewUrl(\n  previewUrl: PreviewUrlOption,\n  toolName: string,\n  previewSearchParam: string | null,\n): URL {\n  const client = useClient({ apiVersion: API_VERSION })\n  const workspace = useActiveWorkspace()\n  const basePath = workspace?.activeWorkspace?.basePath || '/'\n  const workspaceName = workspace?.activeWorkspace?.name || 'default'\n  const deps = useSuspendCacheKeys(toolName, basePath, workspaceName)\n  const previewUrlSecret = usePreviewUrlSecret(\n    typeof previewUrl === 'object' || typeof previewUrl === 'function',\n    deps,\n  )\n  return suspend(async () => {\n    if (typeof previewUrl === 'string') {\n      const resolvedUrl = new URL(previewUrl, location.origin)\n      let resultUrl = resolvedUrl\n      try {\n        if (previewSearchParam) {\n          const restoredUrl = new URL(previewSearchParam, resolvedUrl)\n          if (restoredUrl.origin === resolvedUrl.origin) {\n            resultUrl = restoredUrl\n          }\n        } else if (document.referrer) {\n          const referrerUrl = new URL(document.referrer)\n          if (referrerUrl.origin === resolvedUrl.origin) {\n            resultUrl = referrerUrl\n          }\n        }\n      } catch {\n        // ignore\n      }\n      // Prevent infinite recursion\n      if (\n        location.origin === resultUrl.origin &&\n        (resultUrl.pathname.startsWith(`${basePath}/`) ||\n          resultUrl.pathname === basePath)\n      ) {\n        return resolvedUrl\n      }\n      return resultUrl\n    }\n    const resolvePreviewUrl =\n      typeof previewUrl === 'object'\n        ? definePreviewUrl<SanityClient>(previewUrl)\n        : previewUrl\n    const resolvedUrl = await resolvePreviewUrl({\n      client,\n      previewUrlSecret: previewUrlSecret!,\n      previewSearchParam,\n      referrer: typeof document === 'undefined' ? null : document.referrer,\n      studioBasePath: basePath,\n    })\n    return new URL(resolvedUrl, location.origin)\n  }, [...deps, previewUrlSecret]) satisfies URL\n}\n\n// https://github.com/pmndrs/suspend-react?tab=readme-ov-file#making-cache-keys-unique\nconst resolveUUID = Symbol()\n\nfunction useSuspendCacheKeys(\n  toolName: string,\n  basePath: string,\n  workspaceName: string,\n) {\n  const currentUser = useCurrentUser()\n  return useMemo(\n    () => [\n      // Cache based on a few specific conditions\n      '@sanity/presentation',\n      basePath,\n      workspaceName,\n      toolName,\n      currentUser?.id,\n      resolveUUID,\n    ],\n    [basePath, currentUser?.id, toolName, workspaceName],\n  )\n}\n\nfunction usePreviewUrlSecret(\n  enabled: boolean,\n  deps: (string | symbol | undefined)[],\n) {\n  const client = useClient({ apiVersion: API_VERSION })\n  const currentUser = useCurrentUser()\n  const [secretLastExpiredAt, setSecretLastExpiredAt] = useState<string>('')\n\n  const previewUrlSecret = enabled\n    ? suspend(async () => {\n        return await createPreviewSecret(\n          client,\n          '@sanity/presentation',\n          typeof window === 'undefined' ? '' : location.href,\n          currentUser?.id,\n        )\n      }, [...deps, secretLastExpiredAt])\n    : null\n\n  useEffect(() => {\n    if (!previewUrlSecret) return\n    const timeout = setTimeout(() => {\n      startTransition(() =>\n        setSecretLastExpiredAt(previewUrlSecret.expiresAt.toString()),\n      )\n    }, previewUrlSecret.expiresAt.getTime() - Date.now())\n    return () => clearTimeout(timeout)\n  }, [previewUrlSecret])\n\n  return previewUrlSecret?.secret || null\n}\n","import {\n  type ChannelsController,\n  type ChannelStatus,\n  createChannelsController,\n} from '@sanity/channels'\nimport type { ClientPerspective } from '@sanity/client'\nimport { studioPath } from '@sanity/client/csm'\nimport { BoundaryElementProvider, Flex } from '@sanity/ui'\nimport {\n  getQueryCacheKey,\n  isAltKey,\n  isHotkey,\n  type VisualEditingConnectionIds,\n  type VisualEditingMsg,\n} from '@sanity/visual-editing-helpers'\nimport {\n  lazy,\n  type ReactElement,\n  startTransition,\n  Suspense,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { useUnique } from 'sanity'\nimport {\n  type Path,\n  type SanityDocument,\n  type Tool,\n  useDataset,\n  useProjectId,\n} from 'sanity'\nimport { RouterContextValue, useRouter } from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {\n  DEFAULT_TOOL_NAME,\n  MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL,\n} from './constants'\nimport { ContentEditor } from './editor/ContentEditor'\nimport { DisplayedDocumentBroadcasterProvider } from './loader/DisplayedDocumentBroadcaster'\nimport { Panel } from './panels/Panel'\nimport { PanelResizer } from './panels/PanelResizer'\nimport { Panels } from './panels/Panels'\nimport { PresentationNavigateProvider } from './PresentationNavigateProvider'\nimport { usePresentationNavigator } from './PresentationNavigator'\nimport { PresentationParamsProvider } from './PresentationParamsProvider'\nimport { PresentationProvider } from './PresentationProvider'\nimport { PreviewFrame } from './preview/PreviewFrame'\nimport type {\n  DeskDocumentPaneParams,\n  LiveQueriesState,\n  LiveQueriesStateValue,\n  PresentationPluginOptions,\n  PresentationStateParams,\n} from './types'\nimport { useDocumentsOnPage } from './useDocumentsOnPage'\nimport { useParams } from './useParams'\nimport { usePreviewUrl } from './usePreviewUrl'\n\nconst LoaderQueries = lazy(() => import('./loader/LoaderQueries'))\nconst RevalidateTags = lazy(() => import('./loader/RevalidateTags'))\n\nconst Container = styled(Flex)`\n  overflow-x: auto;\n`\n\nexport default function PresentationTool(props: {\n  tool: Tool<PresentationPluginOptions>\n}): ReactElement {\n  const {\n    previewUrl: _previewUrl,\n    components,\n    unstable_emitExperimentalRevalidateTagsLoaderEvent,\n  } = props.tool.options ?? {}\n  const name = props.tool.name || DEFAULT_TOOL_NAME\n  const { unstable_navigator } = components || {}\n\n  const { navigate: routerNavigate, state: routerState } =\n    useRouter() as RouterContextValue & { state: PresentationStateParams }\n  const routerSearchParams = useUnique(\n    Object.fromEntries(routerState._searchParams || []),\n  )\n\n  const initialPreviewUrl = usePreviewUrl(\n    _previewUrl || '/',\n    name,\n    routerSearchParams.preview || null,\n  )\n\n  const [devMode] = useState(() => {\n    const option = props.tool.options?.devMode\n\n    if (typeof option === 'function') return option()\n    if (typeof option === 'boolean') return option\n\n    return (\n      typeof window !== 'undefined' && window.location.hostname === 'localhost'\n    )\n  })\n\n  const targetOrigin = useMemo(() => {\n    return initialPreviewUrl.origin\n  }, [initialPreviewUrl.origin])\n\n  const iframeRef = useRef<HTMLIFrameElement>(null)\n\n  const [channel, setChannel] = useState<ChannelsController<VisualEditingMsg>>()\n\n  const [liveQueries, setLiveQueries] = useState<LiveQueriesState>({})\n\n  const previewRef = useRef<typeof params.preview>()\n\n  const { params, deskParams, navigate } = useParams({\n    initialPreviewUrl,\n    routerNavigate,\n    routerState,\n    routerSearchParams,\n    previewRef,\n  })\n\n  const [perspective, setPerspective] = useState<ClientPerspective>(() =>\n    params.perspective === 'published' ? params.perspective : 'previewDrafts',\n  )\n\n  const [documentsOnPage, setDocumentsOnPage] = useDocumentsOnPage(perspective)\n\n  const [overlayEnabled, setOverlayEnabled] = useState(true)\n\n  const projectId = useProjectId()\n  const dataset = useDataset()\n\n  // Update the perspective when the param changes\n  useEffect(() => {\n    if (perspective !== params.perspective) {\n      navigate(\n        {},\n        {\n          perspective: perspective === 'published' ? 'published' : undefined,\n        },\n      )\n    }\n  }, [params.perspective, perspective, navigate])\n\n  const [overlaysConnection, setOverlaysConnection] =\n    useState<ChannelStatus>('connecting')\n  const [loadersConnection, setLoadersConnection] =\n    useState<ChannelStatus>('connecting')\n  const [previewKitConnection, setPreviewKitConnection] =\n    useState<ChannelStatus>('connecting')\n\n  const [popups] = useState<Set<Window>>(() => new Set())\n  const handleOpenPopup = useCallback(\n    (url: string) => {\n      const source = window.open(url, '_blank')\n      if (source) {\n        popups.add(source)\n      }\n    },\n    [popups],\n  )\n\n  useEffect(() => {\n    if (popups.size && channel) {\n      // loop popups and call channel.addSource\n      for (const source of popups) {\n        if (source && 'closed' in source && !source.closed) {\n          channel.addSource(source)\n        }\n      }\n    }\n  }, [channel, popups, popups.size])\n\n  useEffect(() => {\n    const target = iframeRef.current?.contentWindow\n\n    if (!target) return\n\n    const nextChannel = createChannelsController<VisualEditingMsg>({\n      id: 'presentation' satisfies VisualEditingConnectionIds,\n      target,\n      targetOrigin,\n      connectTo: [\n        {\n          id: 'overlays' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setOverlaysConnection,\n          onEvent(type, data) {\n            if (type === 'overlay/focus' && 'id' in data) {\n              navigate({\n                type: data.type,\n                id: data.id,\n                path: data.path,\n              })\n            } else if (type === 'overlay/navigate') {\n              if (previewRef.current !== data.url) {\n                const isInitialNavigation = previewRef.current === undefined\n\n                previewRef.current = data.url\n                if (isInitialNavigation) {\n                  navigate({}, { preview: data.url })\n                } else {\n                  navigate(\n                    { id: undefined, type: undefined },\n                    { preview: data.url },\n                  )\n                }\n              }\n            } else if (type === 'overlay/toggle') {\n              setOverlayEnabled(data.enabled)\n            }\n          },\n        },\n        {\n          id: 'loaders' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setLoadersConnection,\n          onEvent(type, data) {\n            if (\n              type === 'loader/documents' &&\n              data.projectId === projectId &&\n              data.dataset === dataset\n            ) {\n              setDocumentsOnPage(data.perspective, data.documents)\n            } else if (\n              type === 'loader/query-listen' &&\n              data.projectId === projectId &&\n              data.dataset === dataset\n            ) {\n              if (\n                typeof data.heartbeat === 'number' &&\n                data.heartbeat! < MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL\n              ) {\n                throw new Error(\n                  `Loader query listen heartbeat interval must be at least ${MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL}ms`,\n                )\n              }\n              setLiveQueries((prev) => ({\n                ...prev,\n                [getQueryCacheKey(data.query, data.params)]: {\n                  perspective: data.perspective,\n                  query: data.query,\n                  params: data.params,\n                  receivedAt: Date.now(),\n                  heartbeat: data.heartbeat ?? false,\n                } satisfies LiveQueriesStateValue,\n              }))\n            }\n          },\n        },\n        {\n          id: 'preview-kit' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setPreviewKitConnection,\n          onEvent(type, data) {\n            if (\n              type === 'preview-kit/documents' &&\n              data.projectId === projectId &&\n              data.dataset === dataset\n            ) {\n              setDocumentsOnPage(data.perspective, data.documents)\n            }\n          },\n        },\n      ],\n    })\n    setChannel(nextChannel)\n\n    return () => {\n      nextChannel.destroy()\n      setChannel(undefined)\n    }\n  }, [dataset, projectId, setDocumentsOnPage, navigate, targetOrigin])\n\n  useEffect(() => {\n    const interval = setInterval(\n      () =>\n        startTransition(() =>\n          setLiveQueries((liveQueries) => {\n            if (Object.keys(liveQueries).length < 1) {\n              return liveQueries\n            }\n\n            const now = Date.now()\n            const hasAnyExpired = Object.values(liveQueries).some(\n              (liveQuery) =>\n                liveQuery.heartbeat !== false &&\n                now > liveQuery.receivedAt + liveQuery.heartbeat,\n            )\n            if (!hasAnyExpired) {\n              return liveQueries\n            }\n            const next = {} as LiveQueriesState\n            for (const [key, value] of Object.entries(liveQueries)) {\n              if (\n                value.heartbeat !== false &&\n                now > value.receivedAt + value.heartbeat\n              ) {\n                continue\n              }\n              next[key] = value\n            }\n            return next\n          }),\n        ),\n      MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL,\n    )\n    return () => clearInterval(interval)\n  }, [])\n\n  const handleFocusPath = useCallback(\n    (nextPath: Path) => {\n      // Dont need to explicitly set the id here because it was either already set via postMessage or is the same if navigating in the document pane\n      navigate({ path: studioPath.toString(nextPath) }, {}, true)\n    },\n    [navigate],\n  )\n\n  const handlePreviewPath = useCallback(\n    (nextPath: string) => {\n      const url = new URL(nextPath, initialPreviewUrl.origin)\n      const preview = url.pathname + url.search\n      if (\n        url.origin === initialPreviewUrl.origin &&\n        preview !== params.preview\n      ) {\n        navigate({ id: undefined, path: undefined }, { preview })\n      }\n    },\n    [initialPreviewUrl, params, navigate],\n  )\n\n  const handleDeskParams = useCallback(\n    (deskParams: DeskDocumentPaneParams) => {\n      navigate({}, deskParams)\n    },\n    [navigate],\n  )\n\n  useEffect(() => {\n    if (params.id && params.path) {\n      channel?.send('overlays', 'presentation/focus', {\n        id: params.id,\n        path: params.path,\n      })\n    } else {\n      channel?.send('overlays', 'presentation/blur', undefined)\n    }\n  }, [channel, params.id, params.path])\n\n  // Dispatch a navigation message when the preview param changes\n  useEffect(() => {\n    if (\n      previewRef.current &&\n      params.preview &&\n      previewRef.current !== params.preview\n    ) {\n      previewRef.current = params.preview\n      if (overlaysConnection !== 'connected' && iframeRef.current) {\n        iframeRef.current.src = `${targetOrigin}${params.preview}`\n      } else {\n        channel?.send('overlays', 'presentation/navigate', {\n          url: params.preview,\n          type: 'replace',\n        })\n      }\n    }\n  }, [channel, overlaysConnection, targetOrigin, params.preview])\n\n  const toggleOverlay = useCallback(\n    () => channel?.send('overlays', 'presentation/toggleOverlay', undefined),\n    [channel],\n  )\n\n  const [displayedDocument, setDisplayedDocument] = useState<\n    Partial<SanityDocument> | null | undefined\n  >(null)\n\n  useEffect(() => {\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        toggleOverlay()\n      }\n    }\n    const handleKeydown = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        toggleOverlay()\n      }\n\n      if (isHotkey(['mod', '\\\\'], e)) {\n        toggleOverlay()\n      }\n    }\n    window.addEventListener('keydown', handleKeydown)\n    window.addEventListener('keyup', handleKeyUp)\n    return () => {\n      window.removeEventListener('keydown', handleKeydown)\n      window.removeEventListener('keyup', handleKeyUp)\n    }\n  }, [toggleOverlay])\n\n  const [boundaryElement, setBoundaryElement] = useState<HTMLDivElement | null>(\n    null,\n  )\n\n  const [{ navigatorEnabled, toggleNavigator }, PresentationNavigator] =\n    usePresentationNavigator({ unstable_navigator })\n\n  // Handle edge case where the `&rev=` parameter gets \"stuck\"\n  const idRef = useRef<string | undefined>(params.id)\n  useEffect(() => {\n    if (params.rev && idRef.current && params.id !== idRef.current) {\n      navigate({}, { rev: undefined })\n    }\n    idRef.current = params.id\n  })\n\n  return (\n    <>\n      <PresentationProvider\n        deskParams={deskParams}\n        devMode={devMode}\n        name={name}\n        params={params}\n        navigate={navigate}\n      >\n        <PresentationNavigateProvider navigate={navigate}>\n          <PresentationParamsProvider params={params}>\n            <Container height=\"fill\">\n              <Panels>\n                <PresentationNavigator />\n                <Panel\n                  id=\"preview\"\n                  minWidth={325}\n                  defaultSize={navigatorEnabled ? 50 : 75}\n                  order={3}\n                >\n                  <Flex\n                    direction=\"column\"\n                    flex={1}\n                    height=\"fill\"\n                    ref={setBoundaryElement}\n                  >\n                    <BoundaryElementProvider element={boundaryElement}>\n                      <PreviewFrame\n                        initialUrl={initialPreviewUrl}\n                        navigatorEnabled={navigatorEnabled}\n                        onPathChange={handlePreviewPath}\n                        openPopup={handleOpenPopup}\n                        overlayEnabled={overlayEnabled}\n                        params={params}\n                        perspective={perspective}\n                        ref={iframeRef}\n                        setPerspective={setPerspective}\n                        targetOrigin={targetOrigin}\n                        toggleNavigator={toggleNavigator}\n                        toggleOverlay={toggleOverlay}\n                        loadersConnection={loadersConnection}\n                        overlaysConnection={overlaysConnection}\n                        previewKitConnection={previewKitConnection}\n                      />\n                    </BoundaryElementProvider>\n                  </Flex>\n                </Panel>\n                <PanelResizer order={4} />\n                <Panel id=\"content\" minWidth={325} order={5}>\n                  <DisplayedDocumentBroadcasterProvider\n                    documentId={params.id}\n                    setDisplayedDocument={setDisplayedDocument}\n                  >\n                    <ContentEditor\n                      refs={documentsOnPage}\n                      deskParams={deskParams}\n                      documentId={params.id}\n                      documentType={params.type}\n                      onDeskParams={handleDeskParams}\n                      onFocusPath={handleFocusPath}\n                      previewUrl={params.preview}\n                    />\n                  </DisplayedDocumentBroadcasterProvider>\n                </Panel>\n              </Panels>\n            </Container>\n          </PresentationParamsProvider>\n        </PresentationNavigateProvider>\n      </PresentationProvider>\n      {channel && (\n        <Suspense>\n          <LoaderQueries\n            channel={channel}\n            liveQueries={liveQueries}\n            perspective={perspective}\n            liveDocument={displayedDocument}\n            documentsOnPage={documentsOnPage}\n          />\n        </Suspense>\n      )}\n      {unstable_emitExperimentalRevalidateTagsLoaderEvent && channel && (\n        <Suspense>\n          <RevalidateTags channel={channel} />\n        </Suspense>\n      )}\n    </>\n  )\n}\n"],"names":["jsx","jsxs","Fragment","studioPath","Card","Flex","Container$1","Stack","Text","Inline","Box","Button","Code","Label","ErrorBoundary","TextInput","Switch","usePrefersReducedMotion","TooltipDelayGroupProvider","Tooltip","MenuButton","Menu","MenuItem","Spinner","useToast","BoundaryElementProvider","useContext","forwardRef","useCallback","useMemo","useState","useEffect","createContext","useLayoutEffect","useRef","memo","createElement","startTransition","Suspense","lazy","useUnique","getPublishedId","useActiveWorkspace","Hotkeys","useClient","useCurrentUser","useProjectId","useDataset","StateLink","useRouter","styled","PresentationContext","PresentationNavigateContext","PresentationParamsContext","MAX_TIME_TO_OVERLAYS_CONNECTION","API_VERSION","MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL","DEFAULT_TOOL_NAME","PaneRouterContext","PaneLayout","StructureToolProvider","DocumentListPane$1","useStructureTool","DocumentPane$1","DisplayedDocumentBroadcasterProvider","ResetIcon","PanelLeftIcon","RefreshIcon","ShareIcon","ChevronDownIcon","CheckmarkIcon","DesktopIcon","MobileDeviceIcon","LaunchIcon","CopyIcon","EditIcon","PublishIcon","DatabaseIcon","createPreviewSecret","withoutSecretSearchParams","hasSecretSearchParams","setSecretSearchParams","motion","MotionConfig","AnimatePresence","isEqual","definePreviewUrl","suspend","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","Error","byteToHex","i","push","toString","slice","native","randomUUID","v4","options","buf","offset","rnds","random","arr","unsafeStringify","RESPONSE_TIMEOUT","HEARTBEAT_INTERVAL","HANDSHAKE_INTERVAL","HANDSHAKE_MSG_TYPES","isHandshakeMessage","type","some","t","isLegacyHandshakeMessage","data","Array","isArray","every","key","startsWith","createChannelsControllerInternal","config","target","channels","connectTo","map","buffer","id","handler","handshakeHandler","status","interval","heartbeat","stopHandshake","channel","window","clearInterval","e","find","from","setChannelStatus","sendHandshake","messageHandler","_a","_b","_c","connectionId","args","onEvent","call","send","responseTo","handleEvents","console","error","origin","domain","to","includes","targetOrigin","isValidMessageEvent","stopHeartbeat","next","onStatusUpdate","uuid","setInterval","startHandshake","heartbeatInverval","startHeartbeat","toFlush","splice","length","forEach","flush","msg","postMessage","concat","expectResponse","maxWait","setTimeout","removeEventListener","transact","warn","eventData","clearTimeout","addEventListener","destroy","r","c","alt","ctrl","mod","test","navigator","platform","shift","parseId","rawId","segments","decodeURIComponent","split","join","parsePath","rawPath","n","o","exec","Number","u","s","_key","urlStringToPath","ErrorCard","props","children","message","onRetry","onContinueAnyway","restProps","retryButton","fontSize","mode","onClick","text","continueAnywayButton","tone","height","align","justify","Container","padding","sizing","width","space","size","weight","muted","usePresentationTool","presentation","resolveQueryStringFromParams","nextParams","allowed","params","parts","Object","entries","value","encodeQueryString","filter","reduce","obj","BackLink","ref","deskParams","state","_searchParams","preview","title","ReferenceChildLink","documentId","documentType","parentRefPath","template","PresentationPaneRouterProvider","onDeskParams","previewUrl","refs","routerState","resolvePathFromState","routerSearchParams","fromEntries","createPathWithParams","path","qs","context","index","groupIndex","siblingIndex","payload","hasGroupSiblings","groupLength","routerPanesState","ChildLink","childLinkProps","childId","_id","_type","ParameterizedLink","closeCurrentAndAfter","handleEditReference","replaceCurrent","pane","closeCurrent","duplicateCurrent","setView","viewId","setParams","inspect","setPayload","navigateIntent","intentName","intentParams","Provider","RootLayout","__template","Root","WrappedCode","DocumentListPane","devMode","ids","schemaTypeName","errorParams","setErrorParams","handleRetry","flex","overflow","radius","onCatch","direction","DeskDocumentListPane","itemId","paneKey","DocumentListPanel","refsWithParsedIds","DocumentPane","onFocusPath","paneDocumentNode","setLayoutCollapsed","handleRootCollapse","handleRootExpand","style","onExpand","onCollapse","DeskDocumentPane","DocumentPanel","ContentEditor","PanelsContext","displayName","div","Panel","defaultSize","minWidth","maxWidth","order","getPanelStyle","registerElement","unregisterElement","Resizer","ResizerInner","$disabled","PanelResizer","propId","disabled","el","current","usePanelId","activeResizer","drag","startDragging","stopDragging","isDragging","onMouseDown","event","nativeEvent","onDrag","onDragStop","blur","debounce","fn","timeout","timer","apply","itemKey","getStoredItem","JSON","parse","localStorage","getItem","getKeyForPanels","panels","panel","usePanelsStorage","set","widths","setItem","stringify","setStoredItem","get","setDebounced","getNextWidth","nextWidth","containerWidth","maxWidthPx","minWidthPx","Math","min","max","getPanelWidth","findIndex","toPrecision","getOffset","handleElement","initialOffset","initialHandleElementRect","clientX","getBoundingClientRect","left","isPanel","element","isResizer","getSortedElements","elements","values","sort","a","b","validateWidths","widthsToValidate","total","remainingWidth","toFixed","abs","PanelsWrapper","Panels","panelsEl","setElements","Map","setWidths","setActiveResizer","panelsRef","flexGrow","pointerEvents","prev","has","delete","dragRef","innerWidth","dragOffset","panelAfter","panelBefore","resizerIndex","resizerRect","startX","elementsArr","resizer","resizeElement","acc","pageX","preventDefault","stopPropagation","prevWidths","nextWidths","delta","panelsState","initialDragState","initialWidths","pivotPanel","deltaApplied","localeCompare","numeric","getNextWidths","widthsChanged","prevWidth","storage","storedWidths","validatedStoredWidths","defaultWidths","panelsWithoutWidth","remainingWidthTotal","widthsWithNulls","defaultWidth","getDefaultWidths","resizeObserver","ResizeObserver","observe","disconnect","PresentationNavigateProvider","navigate","_navigate","document","usePresentationNavigator","unstable_navigator","navigatorProvided","component","_navigatorEnabled","setNavigatorEnabled","defaultValue","setValue","useLocalState","navigatorEnabled","toggleNavigator","enabled","Component","Navigator","NavigatorComponent","navigatorDisabled","PresentationParamsProvider","PresentationProvider","name","IFrame","iframe","PreviewLocationInput","basePath","activeWorkspace","onChange","inputRef","sessionValue","setSessionValue","customValidity","setCustomValidity","handleChange","currentTarget","handleKeyDown","absoluteValue","nextValue","handleBlur","resetButton","icon","clearButton","onBlur","onClear","onKeyDownCapture","zIndex","MotionFlex","StyledSwitch","PERSPECTIVE_TITLES","previewDrafts","published","raw","PERSPECTIVE_TONES","PERSPECTIVE_ICONS","PreviewFrame","initialUrl","onPathChange","openPopup","overlayEnabled","perspective","setPerspective","toggleOverlay","loadersConnection","overlaysConnection","previewKitConnection","setMode","prefersReducedMotion","setDesktopMode","setMobileMode","loading","setLoading","timedOut","setTimedOut","refreshing","setRefreshing","somethingIsWrong","setSomethingIsWrong","iframeIsBusy","previewLocationOrigin","location","handleRefresh","src","handleContinueAnyway","setContinueAnyway","continueAnyway","showOverlaysConnectionStatus","setShowOverlaysConnectionState","previewLocationRoute","URL","pathname","search","onIFrameLoad","transition","duration","delay","shadow","position","gap","minHeight","animate","content","fallbackPlacements","placement","portal","selected","whiteSpace","paddingY","keys","marginTop","marginBottom","as","lineHeight","borderRadius","userSelect","margin","checked","button","iconRight","menu","ShareUrlMenuItems","popover","constrainSize","pressed","opacity","cursor","initial","exit","variants","errorVariants","background","inset","borderTop","boxShadow","spinnerVariants","sizes","backdropFilter","WebkitBackdropFilter","WebkitTransition","iframeVariants","onLoad","desktop","mobile","scale","idle","reloading","active","handleOpenPopup","href","CopyUrlMenuButton","rel","pushToast","client","apiVersion","currentUser","setDisabled","clipboard","closable","url","onFinally","onError","description","ClipboardItem","item","async","previewUrlSecret","newUrl","secret","Blob","resolvePreviewUrl","write","then","catch","writeText","warnedAboutCrossDatasetReference","pruneObject","useParams","initialPreviewUrl","routerNavigate","previewRef","rev","since","view","pathKey","instruction","comment","routerStateRef","nextState","nextSearchState","forceReplace","routerSearchState","searchState","replace","usePreviewUrl","toolName","previewSearchParam","workspace","workspaceName","deps","resolveUUID","useSuspendCacheKeys","secretLastExpiredAt","setSecretLastExpiredAt","expiresAt","getTime","Date","now","usePreviewUrlSecret","resolvedUrl","resultUrl","restoredUrl","referrer","referrerUrl","studioBasePath","Symbol","LoaderQueries","import","RevalidateTags","PresentationTool","_previewUrl","components","unstable_emitExperimentalRevalidateTagsLoaderEvent","tool","option","hostname","iframeRef","setChannel","liveQueries","setLiveQueries","documentsOnPage","setDocumentsOnPage","setPublished","setPreviewDrafts","sourceDocuments","documents","sourceDocument","_projectId","useDocumentsOnPage","setOverlayEnabled","projectId","dataset","setOverlaysConnection","setLoadersConnection","setPreviewKitConnection","popups","Set","source","open","add","closed","addSource","contentWindow","nextChannel","sources","sendToSource","WeakMap","destroySource","prevConnectTo","createChannelsController","isInitialNavigation","query","receivedAt","liveQuery","handleFocusPath","nextPath","handlePreviewPath","handleDeskParams","displayedDocument","setDisplayedDocument","handleKeyUp","isAltKey","handleKeydown","toUpperCase","boundaryElement","setBoundaryElement","PresentationNavigator","idRef","liveDocument"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}