"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),o=require("@sanity/icons"),i=require("@sanity/ui"),r=require("sanity/router"),s=require("rxjs"),a=require("@sanity/uuid");const c=o.ComposeIcon,l="presentation",u="Presentation",d=t.createContext(null),p={locations:[]};const m={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},x={positive:o.InfoOutlineIcon,caution:o.WarningOutlineIcon,critical:o.ErrorOutlineIcon};function h(r){const{documentId:a,options:c,schemaType:h,showPresentationTitle:v}=r,g=t.useContext(d),{message:j,locations:y,tone:I}=function(e){const{id:o,locate:i,type:r}=e,a=n.useDocumentStore(),[c,l]=t.useState(p);return t.useEffect((()=>{if(!i)return;const e=i({id:o,type:r},{documentStore:a}),t=(s.isObservable(e)?e:s.of(e)).subscribe((e=>l(e||p)));return()=>t.unsubscribe()}),[a,o,i,r]),c}({id:a,locate:c.locate,type:h.name}),T=(null==y?void 0:y.length)||0,[C,b]=t.useState(!1),P=t.useCallback((()=>b((e=>!e))),[]),S=j||(T?e.jsxs(e.Fragment,{children:["Used on ",m[T]||T," ",1===T?e.jsx(e.Fragment,{children:"page"}):e.jsx(e.Fragment,{children:"pages"})]}):null);return 0!==T||S?e.jsx(i.Card,{padding:1,radius:3,border:!0,tone:I,children:e.jsxs("div",{style:{margin:-1},children:[!y&&e.jsxs(i.Flex,{align:"flex-start",gap:3,padding:3,children:[I&&e.jsx(i.Box,{flex:"none",children:e.jsx(i.Text,{size:1,children:t.createElement(x[I])})}),e.jsx(i.Box,{flex:1,children:e.jsxs(i.Text,{size:1,weight:"medium",children:[v&&e.jsxs(e.Fragment,{children:[c.title||u," · "]}),S]})})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(i.Card,{as:"button",onClick:P,padding:3,radius:2,tone:"inherit",children:e.jsxs(i.Flex,{gap:3,children:[e.jsx(i.Box,{flex:"none",children:e.jsx(i.Text,{size:1,children:e.jsx(o.ChevronRightIcon,{style:{transform:"rotate(".concat(C?"90deg":0,")"),transition:"transform 100ms ease-in-out"}})})}),e.jsx(i.Box,{flex:1,children:e.jsxs(i.Text,{size:1,weight:"medium",children:[v&&e.jsxs(e.Fragment,{children:[c.title||u," · "]}),S]})})]})}),e.jsx(i.Stack,{hidden:!C,marginTop:1,space:1,children:y.map(((t,n)=>e.jsx(f,{active:(c.name||l)===(null==g?void 0:g.name)&&t.href===(null==g?void 0:g.params.preview),documentId:a,documentType:h.name,node:t,toolName:c.name||l},n)))})]})]})}):null}function f(n){const{documentId:s,documentType:a,node:c,active:l,toolName:u}=n,p=t.useContext(d),m=null==p?void 0:p.navigate,x=r.useIntentLink({intent:"edit",params:{id:s,type:a,mode:"presentation",presentation:u,...null==p?void 0:p.deskParams,preview:c.href}}),h=t.useCallback((()=>{null==m||m({},{preview:c.href})}),[c.href,m]);return t.createElement(i.Card,{...p?{}:x,as:p?"button":"a",key:c.href,onClick:h,padding:3,radius:2,pressed:l,tone:"inherit"},e.jsxs(i.Flex,{gap:3,children:[e.jsx(i.Box,{flex:"none",children:e.jsx(i.Text,{size:1,children:e.jsx(o.DesktopIcon,{})})}),e.jsxs(i.Stack,{flex:1,space:2,children:[e.jsx(i.Text,{size:1,weight:"medium",children:c.title}),e.jsx(i.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}const v=t.createContext(null);function g(n){var o;const{documentId:r,options:s,schemaType:a}=n,c=t.useContext(v);if(c&&c.options[0]!==s)return null;const l=(null==(o=null==c?void 0:c.options)?void 0:o.length)||0;return e.jsx(i.Stack,{marginBottom:5,space:5,children:e.jsx(i.Stack,{space:2,children:null==c?void 0:c.options.map(((t,n)=>e.jsx(h,{documentId:r,options:t,schemaType:a,showPresentationTitle:l>1},n)))})})}function j(n){const{children:o,options:i}=n,r=t.useContext(v),s=null==r?void 0:r.register,[a,c]=t.useState((()=>[])),l=t.useCallback((e=>s?s(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[s]),u=t.useRef(l);u.current=l;const d=t.useMemo((()=>({options:(null==r?void 0:r.options)||a,register:l})),[a,r,l]);return t.useEffect((()=>u.current(i)),[i]),e.jsx(v.Provider,{value:d,children:o})}const y=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:i,path:s}){const a=n.useWorkspace(),{navigateIntent:c}=r.useRouter(),l=t.useContext(d),u=t.useMemo((()=>function(e,t,o){var i;const r=e.map((e=>{var n;return{tool:e,match:null==(n=e.canHandleIntent)?void 0:n.call(e,"edit",{id:t,type:o,mode:"structure"},{})}})),s=r.filter((e=>n.isRecord(e.match)&&e.match.mode));if(s.length>0)return s[0].tool;const a=r.filter((e=>e.match));return null==(i=a[0])?void 0:i.tool}(a.tools,e,i)),[e,i,a.tools]);return{type:"action",hidden:!l||s.length>0||!u,icon:(null==u?void 0:u.icon)||o.MasterDetailIcon,title:"Open in ".concat((null==u?void 0:u.title)||"Structure"),onAction(){c("edit",{id:e,type:i,mode:"structure",path:n.pathToString(s)})},renderAsButton:!0}}});function I(e,t,o,i){const{id:r,mode:s,path:c,presentation:l,type:u,...d}=t;return"edit"===e&&r?{type:u||"*",id:n.getPublishedId(r),path:c,_searchParams:Object.entries(d)}:"create"===e?(d.preview=d.preview||"/",{type:u||"*",id:r||a.uuid(),_searchParams:Object.entries(d)}):{intent:e,params:t,payload:i}}const T=r.route.create("/",{__unsafe_disableScopedSearchParams:!0},[r.route.intents("/intent"),r.route.create("/:type",[r.route.create("/:id"),r.route.create("/:id/:path")])]),C=t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool-zt9x4nRJ.cjs")})))),b=t.lazy((()=>Promise.resolve().then((function(){return require("./BroadcastDisplayedDocument-N6jy9Rvl.cjs")})))),P=n.definePlugin((o=>{const i=o.name||l;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==y.name)),y]},form:{components:{input:function(i){const r=i.value,s=(null==r?void 0:r._id)?n.getPublishedId(null==r?void 0:r._id):void 0;return n.isDocumentSchemaType(i.schemaType)?e.jsxs(j,{options:o,children:[s&&e.jsx(g,{documentId:s,options:o,schemaType:i.schemaType}),i.renderDefault(i),e.jsx(t.Suspense,{children:e.jsx(b,{value:r})},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:o.icon||c,name:i,title:o.title,component:C,options:o,canHandleIntent:(e,t)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===i)&&(!("template"in e)||{template:!0})}(t):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===i)&&(!("mode"in e)||{mode:"presentation"===e.mode})}(t),getIntentState:I,router:T}]}})),S=t.createContext(null);const w=t.createContext(null);exports.A="2023-10-16",exports.D=l,exports.L=2048,exports.M=3e3,exports.P=d,exports.a=S,exports.b=w,exports.c=1e3,exports.d=100,exports.e=function(){const e=t.useContext(w);if(!e)throw new Error("Presentation params context is missing");return e},exports.p=P,exports.u=function(){const e=t.useContext(S);if(!e)throw new Error("Presentation navigate context is missing");return e};//# sourceMappingURL=index-UDMbkpVt.cjs.map
