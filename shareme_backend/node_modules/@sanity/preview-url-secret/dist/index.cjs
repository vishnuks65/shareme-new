"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_chunks/constants-njScg_lu.cjs");exports.urlSearchParamPreviewPathname=e.b,exports.urlSearchParamPreviewSecret=e.u,exports.validatePreviewUrl=async function(r,t,i="Cloudflare-Workers"===(e=>null==(e=globalThis.navigator)?void 0:e.userAgent)()){const o=function(r){if(!r)throw new TypeError("`client` is required");if(!r.config().token)throw new TypeError("`client` must have a `token` specified");return r.withConfig({apiVersion:e.a,useCdn:!1,perspective:"published",resultSourceMap:!1,stega:!1})}(r);let s;try{s=function(r){const t=new URL(r,"http://localhost"),i=t.searchParams.get(e.u);if(!i)throw new Error("Missing secret");let o;const s=t.searchParams.get(e.b);if(s){const{pathname:e,search:r}=new URL(s,"http://localhost");o="".concat(e).concat(r)}return{secret:i,redirectTo:o}}(t)}catch(r){return e.i&&console.error("Failed to parse preview URL",r,{previewUrl:t,client:o}),{isValid:!1}}const{isValid:n,studioUrl:a}=await async function(r,t,i){if("undefined"!=typeof EdgeRuntime&&await new Promise((e=>setTimeout(e,300))),!t||!t.trim())return{isValid:!1,studioUrl:null};const o=await r.fetch(e.f,{secret:t},{tag:e.t,...i?void 0:{cache:"no-store"}});return(null==o?void 0:o._id)&&(null==o?void 0:o._updatedAt)&&(null==o?void 0:o.secret)?{isValid:t===o.secret,studioUrl:o.studioUrl}:{isValid:!1,studioUrl:null}}(o,s.secret,i),c=n?s.redirectTo:void 0;let l;if(n)try{l=new URL(a).origin}catch(r){e.i&&console.error("Failed to parse studioUrl",r,{previewUrl:t,studioUrl:a})}return{isValid:n,redirectTo:c,studioOrigin:l}};//# sourceMappingURL=index.cjs.map
